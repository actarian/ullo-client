var LESSON=!0,app=angular.module("ullo",["ngRoute","ngMessages","ngAnimate","relativeDate","ngFileUpload"]);app.constant("APP",{CLIENT:0===window.location.href.indexOf("http://ulloclient.wslabs.it")?"http://ulloclient.wslabs.it":"http://dev.ullowebapp:8081",API:LESSON||0===window.location.href.indexOf("http://ulloclient.wslabs.it")?"http://ulloapi.wslabs.it":"https://localhost:44302",FACEBOOK_APP_ID:0===window.location.href.indexOf("http://ulloclient.wslabs.it")?"1054303094614120":"1062564893787940",assetTypeEnum:{Unknown:0,Picture:1},IOS:!!navigator.userAgent.match(/iPad|iPhone|iPod/g)}),app.config(["$httpProvider","$routeProvider","$locationProvider",function(e,t,n){e.defaults.withCredentials=!0,t.when("/test",{title:"Test",templateUrl:"templates/dishes.html",controller:"TestCtrl",controllerAs:"testCtrl"}).when("/",{title:"Stream",templateUrl:"templates/stream.html",controller:"StreamCtrl",controllerAs:"streamCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]}}).when("/stream",{title:"Stream",templateUrl:"templates/stream.html",controller:"StreamCtrl",controllerAs:"streamCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]}}).when("/splash",{title:"Splash",templateUrl:"templates/splash.html",controller:"SplashCtrl",controllerAs:"splashCtrl"}).when("/signin",{title:"Sign In",templateUrl:"templates/signin.html",controller:"SigninCtrl",controllerAs:"signinCtrl"}).when("/signup",{title:"Sign Up",templateUrl:"templates/signup.html",controller:"SignupCtrl",controllerAs:"signupCtrl"}).when("/dishes/:dishId",{title:"Dish",templateUrl:"templates/dish.html",controller:"DishCtrl",controllerAs:"dishCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/categories/:categoryId",{title:"Category",templateUrl:"templates/category.html",controller:"CategoryCtrl",controllerAs:"categoryCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/users/:userRoute",{title:"User",templateUrl:"templates/user.html",controller:"UserCtrl",controllerAs:"userCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/post",{title:"Add Post",templateUrl:"templates/post.html",controller:"PostCtrl",controllerAs:"postCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/settings",{title:"Settings",templateUrl:"templates/settings.html",controller:"SettingsCtrl",controllerAs:"settingsCtrl",resolve:{user:["Users",function(e){return e.isLoggedOrGoTo("/splash")}]},isForward:!0}).when("/404",{title:"Error 404",templateUrl:"404.html"}),t.otherwise("/stream"),n.html5Mode(!0)}]),app.run(["$rootScope","$window","APP",function(e,t,n){function o(e,t){return 0===e.indexOf("http")?e:t?n.API+e+"?media="+t:n.API+e}e.standalone=t.navigator.standalone,document.ontouchmove=function(e){e.preventDefault()},window.oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},e.getPictures=function(e,t){var n="/img/preview.png";if(!e)return n;if(e.pictures)for(var r=0;r<e.pictures.length;r++){var i=e.pictures[r];i.route&&(n=o(i.route,t),r=1e5)}else e.route&&(n=o(e.route,t));return n},e.getPicture=function(e,t){var n="/img/preview.png";return e?(e.picture&&e.picture.route?n=o(e.picture.route,t):e.route&&(n=o(e.route,t)),n):n},e.broadcast=function(t,n){e.$broadcast(t,n)}}]),app.animation(".navigation",["$rootScope","$animate",function(e,t){function n(){return!i}function o(){return r.isForward}var r=null,i=null,s={type:dynamics.bezier,points:[{x:0,y:0,cp:[{x:.509,y:.007}]},{x:1,y:1,cp:[{x:.566,y:.997}]}],duration:500};return e.$on("$routeChangeSuccess",function(e,t,n){r=n.$$route,i=t.$$route}),{enter:function(e,t){if(n())dynamics.css(e[0],{translateY:0,opacity:0,scale:1.2}),dynamics.animate(e[0],{translateY:0,opacity:1,scale:1},s);else if(o()){var r=e[0].offsetWidth;dynamics.css(e[0],{translateX:-r}),dynamics.animate(e[0],{translateX:0},s)}else{var r=e[0].offsetWidth;dynamics.css(e[0],{translateX:r}),dynamics.animate(e[0],{translateX:0},s)}t()},leave:function(e,t){if(o()){var n=e[0].offsetWidth;dynamics.css(e[0],{translateX:0}),dynamics.animate(e[0],{translateX:n},s)}else{var n=e[0].offsetWidth;dynamics.css(e[0],{translateX:0}),dynamics.animate(e[0],{translateX:-n},s)}setTimeout(t,1e3)}}}]),app.directive("onTap",["$timeout",function(e){return{restrict:"A",link:function(t,n,o,r){function i(t){n.addClass("tapped"),e(function(){n.removeClass("tapped")},500)}function s(){n.on("touchstart mousedown",i)}function a(){n.off("touchstart mousedown",i)}t.$on("$destroy",function(){a()}),s()}}}]),app.directive("animate",["$timeout",function(e){return{restrict:"A",link:function(t,n,o,r){n.addClass("animated");var i=["fadeIn"],s=["1"];for(void 0!==o.animate&&(i=o.animate.split(",")),void 0!==o.delay&&(s=o.delay.split(",")),angular.forEach(s,function(e,t){s[t]=parseInt(e)});s.length<i.length;)s.push(s[s.length-1]+50);var a=i.join(" ");for(-1!==i[0].indexOf("In")&&(n.addClass("invisible"),a+=" invisible");i.length;){var u=s.shift(),l=i.shift();e(function(){n.removeClass(a),n.addClass(l),0===i.length&&-1!==l.indexOf("Out")&&e(function(){n.addClass("invisible")},1e3)},u)}}}}]),app.directive("scrollable",["$parse","$compile","$window","$timeout","Utils",function(e,t,n,o,r){return{restrict:"A",link:function(o,i,s,a){function u(){S||U&&(S=!0,o.$apply(U).then()["finally"](function(){j=M=0,setTimeout(function(){c(),S=!1},500)}))}function l(){S||O&&(S=!0,o.$apply(O).then()["finally"](function(){var e=i[0].offsetHeight-R[0].offsetHeight;j=M=e>N?N:N+E,setTimeout(function(){c(),S=!1},500)}))}function c(){x=!1,P=!1,A=null,C=null,k()}function f(){D+=E,N-=E,M>D?u():N>M&&l()}function p(e){if(D=0,N=i[0].offsetHeight-R[0].offsetHeight,x?(M=j+A.y-C.y,f()):W&&(M+=W,W*=.75,P&&f(),Math.abs(W)<.05&&(W=0,M=j=B,P=!1,h())),M=Math.min(D,M),M=Math.max(N,M),B+=(M-B)/4,G.transform("translate3d(0,"+B.toFixed(2)+"px,0)"),G.set(R[0]),q){if(x||P||W){var t=B/(i[0].offsetHeight-R[0].offsetHeight);t=Math.max(0,Math.min(1,t)),z=(i[0].offsetHeight-J[0].offsetHeight)*t,L+=(0-L)/4;var n=Math.max(1,Math.round(t*q.rows.length));J.html(n+"/"+q.count)}else L+=(45-L)/4;_.transform("translate3d("+L.toFixed(2)+"px,"+z.toFixed(2)+"px,0)"),_.set(J[0])}}function d(){function e(t){p(t),T=window.requestAnimationFrame(e,i)}T||e()}function h(){T&&(window.cancelAnimationFrame(T),T=null)}function m(e){S||(j=M=B,W=0,C=r.getTouch(e),P=!1,$(),d())}function g(e){F=A,A=r.getTouch(e),x=!0}function v(e){A&&F&&(W+=4*(A.y-F.y)),j=M=B,x=!1,A=null,C=null,F=null,I=r.getTouch(e),k()}function y(e){if(!S){e||(e=event);var t=e.deltaY<0||e.wheelDelta>0||e.deltaY<0?1:-1;W+=5*t,P=!0,d()}}function w(){i.on("touchstart mousedown",m),i.on("wheel",H)}function b(){i.off("touchstart mousedown",m),i.off("wheel",H)}function $(){angular.element(n).on("touchmove mousemove",g),angular.element(n).on("touchend mouseup",v)}function k(){angular.element(n).off("touchmove mousemove",g),angular.element(n).off("touchend mouseup",v)}n.ondragstart=function(){return!1};var x,P,S,C,A,F,I,T,U,O,q,E=150,j=0,M=0,B=0,D=0,N=0,W=0,L=45,z=0;void 0!==s.onTop&&(U=e(s.onTop,null,!0)),void 0!==s.onBottom&&(O=e(s.onBottom,null,!0)),void 0!==s.showIndicatorFor&&(q=o.$eval(s.showIndicatorFor)),i.attr("unselectable","on").addClass("unselectable");var _,R=i.find("div"),G=new r.Style,J=null;q&&(J=angular.element('<div class="indicator"></div>'),_=new r.Style,i.append(J),t(J.contents())(o),_.transform("translate3d("+L.toFixed(2)+"px,"+z.toFixed(2)+"px,0)"),_.set(J[0]));var H=r.throttle(y,25);o.$on("$destroy",function(){b()}),w()}}}]),app.directive("ngImg",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(t,n,o,r){var i=e(o.ngImg,null,!0),s=new Image;s.onload=function(){o.$set("src",this.src),setTimeout(function(){n.addClass("loaded")},10)},s.load=function(e){n.removeClass("loaded"),this.src=e},t.$watch(i,function(e){e?s.load(e):o.$set("src",null)})}}}]),app.directive("ngImgWorker",["$parse","WebWorker",function(e,t){var n=new t("/js/workers/loader.min.js");return{restrict:"A",link:function(e,t,o,r){function i(e){function r(e){o.$set("src",e),setTimeout(function(){t.addClass("loaded")},100)}t.removeClass("loaded"),n.post({url:e}).then(function(e){r(e.url)},function(e){r(null)})}var s=e.$eval(o.ngImgWorker);s?i(s):o.$set("src",null)}}}]),app.directive("control",[function(){return{restrict:"A",replace:!0,template:function(e,t){var n=t.form||"Form",o=t.title||"Untitled",r=t.placeholder||o,i=o.replace(/[^0-9a-zA-Z]/g,"").split(" ").join(""),s=n+"."+i,a=' ng-focus="'+s+'.hasFocus=true" ng-blur="'+s+'.hasFocus=false"',u="",l=t.label?t.label:"name",c=t.key?t.key:"id",f=t.model;if(t.required){switch(u='<span ng-messages="'+(t.readonly?"":"("+n+".$submitted || "+s+".$touched) && ")+n+"."+i+'.$error" role="alert"><span ng-message="required" class="label-error animated flash"> &larr; required</span>',t.control){case"password":u+='<span ng-message="minlength" class="label-error animated flash"> &larr; at least 6 chars</span>';break;case"email":u+='<span ng-message="email" class="label-error animated flash"> &larr; incorrect</span>';break;case"number":u+='<span ng-message="number" class="label-error animated flash"> &larr; enter a valid number</span>'}void 0!==t.match&&(u+='<span ng-message="match" class="label-error animated flash"> &larr; not matching</span>'),u+="</span>"}else u=" (optional)";var p="<div "+(t.readonly?' class="readonly" ':"")+' ng-class="{ focus: '+s+".hasFocus, success: "+s+".$valid, error: "+s+".$invalid && (form.$submitted || "+s+".$touched), empty: !"+s+'.$viewValue }"><label for="'+i+'" class="control-label">'+o+u+"</label>";switch(t.control){case"checkbox":p='<div class="checkbox">',p+='<span class="checkbox-label">'+o+u+"</span>",p+='<span class="switch"><input id="'+i+'" name="'+i+'" type="checkbox" ng-model="'+f+'" '+(t.required?'required="true"':"")+' class="toggle toggle-round-flat"><label for="'+i+'"></label></span>',p+="</div>";break;case"select":var d=t.number?"item."+c+" as item."+l+" for item in "+t.source:"item."+l+" for item in "+t.source+" track by item."+c;p+='<select name="'+i+'" class="form-control" ng-model="'+f+'" ng-options="'+d+'" '+(t.number?"convert-to-number":"")+" "+(t.required?'required="true"':"")+'><option value="" disabled selected hidden>'+r+"</option></select>";break;case"autocomplete":var h=t.canCreate?t.canCreate:!1,m=t.flatten?t.flatten:!1,g=t.queryable?t.queryable:!1,v=t.onSelected?' on-selected="'+t.onSelected+'"':"";p+='<input name="'+i+'" ng-model="'+f+'" type="hidden" '+(t.required?"required":"")+">",p+='<div control-autocomplete="'+t.source+'" model="'+f+'" label="'+l+'"  key="'+c+'" can-create="'+h+'" flatten="'+m+'" queryable="'+g+'" placeholder="'+r+'" on-focus="'+s+'.hasFocus=true" on-blur="'+s+'.hasFocus=false"'+v+"></div>";break;case"textarea":p+='<textarea name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" '+(t.required?"required":"")+' rows="'+(t.rows?t.rows:"1")+'"'+a+"></textarea>";break;case"datetime-local":r==o?r="yyyy-MM-ddTHH:mm:ss":null,p+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="datetime-local"'+(t.required?" required":"")+(t.readonly?" readonly":"")+a+">";break;case"password":p+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="password" ng-minlength="6" '+(t.required?"required":"")+a+">";break;case"email":p+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="email" '+(t.required?"required":"")+a+">";break;case"number":p+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="text"'+(t.required?" required":"")+(t.readonly?" readonly":"")+a+' validate-type="number">';break;case"text":default:p+='<input name="'+i+'" class="form-control" ng-model="'+f+'"'+(t.options?' ng-model-options="'+t.options+'" ':"")+' placeholder="'+r+'" type="text"'+(t.required?" required":"")+(t.readonly?" readonly":"")+a+">"}return p+"</div>"},link:function(e,t,n,o){}}}]),app.directive("controlAutocomplete",["$parse","$window","$timeout",function(e,t,n){var o=5;return{restrict:"A",scope:{service:"=controlAutocomplete",canCreate:"=",flatten:"=",queryable:"=",model:"=",label:"@",key:"@"},template:function(e,t){var n="<div>";return n+='   <input class="form-control" ng-model="phrase" ng-model-options="{ debounce: 150 }" placeholder="'+t.placeholder+'" type="text" ng-focus="onFocus()">',n+='   <ul class="form-autocomplete" ng-show="items.length">',n+='       <li ng-repeat="item in items" ng-class="{ active: active == $index }" ng-click="onSelect(item)">',n+='           <span>{{item.NameA}}<span class="token">{{item.NameB}}</span>{{item.NameC}}</span>',n+="       </li>",n+="   </ul>",n+="</div>"},link:function(r,i,s,a){function u(){return r.model?r.flatten?r.model:r.model[C]:null}function l(e){r.items.length=0,r.count=0,r.phrase=e||null,S.val(r.phrase)}function c(){var e=null;return-1!=r.active&&r.items.length>r.active&&(e=r.items[r.active]),e}function f(e){r.canCreate&&(r.flatten?A===C&&(r.model=e):(r.model={},r.model[C]=e))}function p(){var e=c();e&&r.onSelect(e),r.$apply()}function d(){r.active--,r.active<0&&(r.active=r.items.length-1),r.$apply()}function h(){r.active++,0==r.items.length?r.active=-1:r.active>=r.items.length&&(r.active=0),r.$apply()}function m(e){r.items=e.items,r.count=e.count,angular.forEach(r.items,function(e,t){var n=e[C],o=n.toLowerCase().indexOf(r.phrase.toLowerCase());e.NameA=n.substr(0,o),e.NameB=n.substr(o,r.phrase.length),e.NameC=n.substr(o+r.phrase.length,n.length-(o+r.phrase.length))})}function g(e){var t=0,n=[];r.phrase.length>1&&angular.forEach(e.items,function(e,i){var s=e[C];-1!==s.toLowerCase().indexOf(r.phrase.toLowerCase())&&(n.length<o&&n.push(e),t++)}),m({count:t,items:n})}function v(){r.phrase=S.val(),r.active=-1,f(r.phrase),r.queryable?r.service.setPhrase(r.phrase).then(function(e){r.items=e.items,r.count=e.count},function(e){console.log("Search.queryable.error",r.phrase,e)})["finally"](function(){}):(g({count:r.service.length,items:r.service}),r.$apply())}function y(e){switch(e.keyCode){case 9:case 13:if(p(),r.items.length)return e.preventDefault?e.preventDefault():null,!1;break;case 38:d();break;case 40:h()}}function w(e){switch(e.keyCode){case 9:case 13:break;case 39:break;case 37:break;case 38:break;case 40:break;default:v.call(this)}}function b(e){return null===Utils.getClosest(e.target,"[control-autocomplete]")&&r.$apply(function(){r.onBlur()}),!0}function $(){S.on("keydown",y),S.on("keyup",w),angular.element(t).on("mouseup touchend",b)}function k(){S.off("keydown",y),S.off("keyup",w),angular.element(t).off("mouseup touchend",b)}function x(){F||($(),F=!0)}var P=e(s.onSelected),S=i.find("input"),C=r.label?r.label:"name",A=r.key?r.key:"id";r.phrase=u(),r.count=0,r.items=[],r.active=-1,r.maxItems=r.maxItems||Number.POSITIVE_INFINITY,r.onFocus=function(){void 0!==s.onFocus&&r.$parent.$eval(s.onFocus),S.val()===u()&&S.val(null)},r.onBlur=function(){void 0!==s.onBlur&&r.$parent.$eval(s.onBlur),l(u())},r.onSelect=function(e){r.queryable?r.service.setItem(e).then(function(e){P({$item:e},r.$parent,{$event:{}}),n(function(){r.flatten?r.model=e[A]:(r.model=r.model||{},angular.extend(r.model,e)),r.onBlur()},1)}):(P({$item:e},r.$parent,{$event:{}}),r.flatten?r.model=e[A]:(r.model=r.model||{},angular.extend(r.model,e)),r.onBlur())},r.$on("$destroy",function(){k()});var F=!1;r.$watch("service",function(e){e&&(e.length||r.queryable)&&x()}),r.$watchCollection("model",function(e){e&&(r.flatten&&C===A?(r.phrase=e,S.val(r.phrase)):e[C]&&(r.phrase=e[C],S.val(r.phrase)))})}}}]),app.directive("validateType",function(){return{require:"ngModel",link:function(e,t,n,o){var r=n.validateType;switch(r){case"number":o.$parsers.unshift(function(e){return o.$setValidity(r,-1!==String(e).indexOf(Number(e).toString())),e})}}}}),app.value("UserRoles",[{name:"Guest",id:1},{name:"User",id:2},{name:"Supervisor",id:3},{name:"Admin",id:4}]),app.value("UserRolesEnum",{Guest:1,User:2,Supervisor:3,Admin:4}),app.factory("User",["UserRolesEnum",function(e){function t(e){e?angular.extend(this,e):null}return t.prototype={isAdmin:function(){return this.role===e.Admin},isUser:function(e){return this.email===e.email},picture:function(e){e=e||"sm";var t;switch(e){case"sm":t=50;break;case"md":t=300}return this.facebookId?"https://graph.facebook.com/"+this.facebookId+"/picture?width="+t+"&height="+t+"&type=square":"/img/avatar-default.png"},backgroundPicture:function(e){return"background-image: url("+this.picture(e)+");"}},t}]),app.factory("Post",["$q","$http","$timeout","APP","User","Dish","Upload",function(e,t,n,o,r,i,s){function a(e){e?angular.extend(this,e):null,this.user=new r(this.user),this.dish=new i(this.dish)}return a.prototype={upload:function(e){console.log("Post.upload",this.id,e);var t=this,r=e.name.substr(0,e.name.lastIndexOf(".")),i=e.name.substr(e.name.lastIndexOf("."));console.log("onUpload",r,i);var a={model:this,id:this.id,assetType:1,name:r,extension:i,progress:0};this.uploads=this.uploads||[],this.uploads.push(a),s.upload({url:o.API+"api/assets/",data:{file:e,uploadData:JSON.stringify(a)}}).then(function(e){console.log("Success "+e.config.data.file.name+" uploaded. Response: "+e.data),t.pictures=(t.pictures||[]).concat(e.data),a.progress=100,n(function(){var e=-1;angular.forEach(t.uploads,function(t,n){t===a&&(e=n)}),-1!=e&&t.uploads.splice(e,1)},2e3)},function(e){console.log("Error status: "+e.status),a.progress=0},function(e){if(e.config.data.file){var t=Math.round(100*e.loaded/e.total);a.progress=t,console.log("progress: "+t+"% "+e.config.data.file.name)}})},voteCount:function(){return this.yes+this.no},rating:function(){var e=this.voteCount();return e>0?this.yes/e:0},ratingToString:function(){var e=this.rating();return e>0?Math.round(100*e)/10:"0.0"}},a}]),app.factory("Dish",["$q","$http","$timeout","APP","User","Upload",function(e,t,n,o,r,i){function s(e){this.extend(e)}return s.prototype={extend:function(e){e?angular.extend(this,e):null,this.user=new r(this.user),this.votes&&angular.forEach(this.votes,function(e){e.user=new r(e.user)})},like:function(n){var r=this,i=e.defer();return t.post(o.API+"/api/dishes/vote",{dishId:this.id,like:n}).then(function(e){r.extend(e.data),i.resolve(e)},function(e){i.reject(e)}),i.promise},upload:function(e){console.log("Dish.upload",this.id,e);var t=this,r=e.name.substr(0,e.name.lastIndexOf(".")),s=e.name.substr(e.name.lastIndexOf("."));console.log("onUpload",r,s);var a={model:this,id:this.id,assetType:1,name:r,extension:s,progress:0};this.uploads=this.uploads||[],this.uploads.push(a),i.upload({url:o.API+"api/assets/",data:{file:e,uploadData:JSON.stringify(a)}}).then(function(e){console.log("Success "+e.config.data.file.name+" uploaded. Response: "+e.data),t.pictures=(t.pictures||[]).concat(e.data),a.progress=100,n(function(){var e=-1;angular.forEach(t.uploads,function(t,n){t===a&&(e=n)}),-1!=e&&t.uploads.splice(e,1)},2e3)},function(e){console.log("Error status: "+e.status),a.progress=0},function(e){if(e.config.data.file){var t=Math.round(100*e.loaded/e.total);a.progress=t,console.log("progress: "+t+"% "+e.config.data.file.name)}})},voteCount:function(){return this.yes+this.no},rating:function(){var e=this.voteCount();return e>0?this.yes/e:0},ratingToString:function(){var e=this.rating();return e>0?Math.round(100*e)/10:"0.0"}},s}]),app.factory("Vector",function(){function e(e,t){this.x=e||0,this.y=t||0}return e.make=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.size=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.normalize=function(t){var n=e.size(t);return t.x/=n,t.y/=n,t},e.incidence=function(e,t){var n=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);return n},e.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},e.cross=function(e,t){return e.x*t.y-e.y*t.x},e.difference=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.prototype={size:function(){return e.size(this)},normalize:function(){return e.normalize(this)},incidence:function(t){return e.incidence(this,t)},cross:function(t){return e.cross(this,t)},towards:function(e,t){return t=t||.125,this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},friction:function(e){return this.x*=e,this.y*=e,this},copy:function(t){return new e(this.x,this.y)},toString:function(){return"{"+this.x+","+this.y+"}"}},e}),app.factory("FacebookService",["$q","APP",function(e,t){function n(){}function o(e,t){n.authResponse=null,"connected"===e.status?(n.authResponse=e.authResponse,t.resolve(e)):"not_authorized"===e.status?t.reject(e):t.reject(e)}return n.FB=function(){var t=e.defer();return void 0!==window.FB?t.resolve(window.FB):n.init().then(function(e){t.resolve(window.FB)},function(e){t.reject(e)}),t.promise},n.getFacebookMe=function(){var t=e.defer();return n.FB().then(function(e){e.api("/me",{fields:"id,name,first_name,last_name,email,gender,picture,cover,link"},function(e){!e||e.error?t.reject("Error occured"):t.resolve(e)})}),t.promise},n.getPictureMe=function(){var t=e.defer();return n.FB().then(function(e){e.api("/me/picture",{width:300,height:300,type:"square"},function(e){!e||e.error?t.reject("Error occured"):t.resolve(e)})}),t.promise},n.login=function(){var r=e.defer(),i=!1;try{i=window.navigator.standalone}catch(s){}if(i){var a="https://m.facebook.com/dialog/oauth?client_id="+t.FACEBOOK_APP_ID+"&response_type=code&redirect_uri="+t.CLIENT+"&scope=public_profile,email";return void(window.location.href=a)}return n.FB().then(function(e){e.login(function(e){o(e,r)},{scope:"public_profile,email"})}),r.promise},n.logout=function(){var t=e.defer();return n.FB().then(function(e){e.logout(function(e){t.resolve(e)})}),t.promise},n.init=function(){var n=e.defer();window.fbAsyncInit=function(){FB.init({appId:t.FACEBOOK_APP_ID,status:!0,cookie:!0,xfbml:!0,version:"v2.5"}),FB.getLoginStatus(function(e){o(e,n)})};try{!function(e,t,n){var o,r=e.getElementsByTagName(t)[0];e.getElementById(n)||(o=e.createElement(t),o.id=n,o.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(o,r))}(document,"script","facebook-jssdk")}catch(r){n.reject(r)}return n.promise},n}]),app.factory("Users",["$q","$http","$httpAsync","$location","$timeout","APP","LocalStorage","User",function(e,t,n,o,r,i,s,a){function u(){}var l=null;return u.prototype={},u.currentUser=function(){return l},u.getCurrentUser=function(){var n=e.defer();return l?n.resolve(l):t.get(i.API+"/api/users/current/").then(function(e){e&&e.data?(l=new a(e.data),n.resolve(l)):n.resolve(null)},function(e){n.reject(e)}),n.promise},u.isLogged=function(){var t=e.defer();return u.getCurrentUser().then(function(e){e&&e.isAuthenticated?t.resolve(e):t.reject()},function(e){t.reject(e)}),t.promise},u.isAdmin=function(){var t=e.defer();return u.getCurrentUser().then(function(e){e&&e.isAuthenticated&&e.isAdmin?t.resolve(e):t.reject()},function(e){t.reject(e)}),t.promise},u.isLoggedOrGoTo=function(t){var n=e.defer();return u.getCurrentUser().then(function(e){e&&e.isAuthenticated?n.resolve(e):(n.reject(),o.path(t))},function(e){n.reject(e),o.path(t)}),n.promise},u.isAdminOrGoTo=function(t){var n=e.defer();return u.getCurrentUser().then(function(e){e&&e.isAuthenticated&&e.isAdmin?n.resolve(e):(n.reject(),o.path(t))},function(e){n.reject(e),o.path(t)}),n.promise},u.signup=function(n){var o=e.defer();return t.post(i.API+"/api/users/signup/",n).then(function(e){l=new a(e.data),o.resolve(l)},function(e){o.reject(e)}),o.promise},u.signin=function(n){var o=e.defer();return t.post(i.API+"/api/users/signin/",n).then(function(e){l=new a(e.data),o.resolve(l)},function(e){o.reject(e)}),o.promise},u.signInWithFacebook=function(n){var o=e.defer();return t.post(i.API+"/api/users/signinwithfacebook/",n).then(function(e){l=new a(e.data),o.resolve(l)},function(e){o.reject(e)}),o.promise},u.signout=function(){var n=e.defer();return t.get(i.API+"/api/users/signout/").then(function(e){l=null,n.resolve(e.data)},function(e){n.reject(e)}),n.promise},u.detail=function(n){var o=e.defer();return t.get(i.API+"/api/users/route/"+n).then(function(e){o.resolve(new a(e.data))},function(e){o.reject(e)}),o.promise},u}]),app.factory("Categories",["$http","$q","APP",function(e,t,n){function o(){}return o.get=function(){var o=t.defer();return e.get(n.API+"/api/categories/").then(function(e){o.resolve(e.data)},function(e){o.reject(e)}),o.promise},o.detail=function(o){var r=t.defer();return e.get(n.API+"/api/categories/"+o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},o}]),app.factory("DishesTest",["APP","Dish",function(e,t){function n(){for(var e=[];e.length<10;)e.push({id:r,name:"dish "+r,price:3.2,yes:Math.floor(999*Math.random()),no:Math.floor(999*Math.random()),pictures:[{route:"http://lorempixel.com/750/375/food/"+(1+r%10)}],user:{userName:"User"}}),r++;return e}function o(){}var r=100;return o.uri={paging:!1},o.resolve=function(e){var o=n();angular.forEach(o,function(e){this.push(new t(e))},e)},o}]),app.factory("Posts",["$http","$q","APP","Post",function(e,t,n,o){function r(){}return r.uri={paging:n.API+"/api/stream/paged"},r.resolve=function(e,t){angular.forEach(e,function(e){this.push(new o(e))},t)},r.add=function(o){var r=t.defer();return e.post(n.API+"/api/post/",o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},r}]),app.factory("Dishes",["$http","$q","APP","Dish",function(e,t,n,o){function r(){}return r.uri={paging:n.API+"/api/dishes/paged"},r.resolve=function(e,t){angular.forEach(e,function(e){this.push(new o(e))},t)},r.detail=function(r){var i=t.defer();return e.get(n.API+"/api/dishes/"+r).then(function(e){i.resolve(new o(e.data))},function(e){i.reject(e)}),i.promise},r.add=function(o){var r=t.defer();return e.post(n.API+"/api/dishes/",o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},r.get=function(){var r=t.defer();return e.get(n.API+"/api/dishes/").then(function(e){var t=[];angular.forEach(e.data,function(e){this.push(new o(e))},t),r.resolve(t)},function(e){r.reject(e)}),r.promise},r}]),app.factory("DishesAutocomplete",["$q","$http","$timeout","APP",function(e,t,n,o){function r(){}var i=5;return r.prototype={setPhrase:function(n){var r=e.defer();return t.post(o.API+"/api/dishes/autocomplete",{phrase:n}).then(function(e){var t={items:[],count:e.data.length};angular.forEach(e.data,function(e,o){if(i>o){var r={id:e.id,name:e.name},s=e.name.toLowerCase().indexOf(n.toLowerCase()),a=n.length;r.NameA=r.name.substr(0,s),r.NameB=r.name.substr(s,a),r.NameC=r.name.substr(s+a,r.name.length-(s+a)),t.items.push(r)}}),r.resolve(t)},function(e){r.reject(e)}),r.promise},setItem:function(n){var r=e.defer();return t.get(o.API+"/api/dishes/"+n.id).then(function(e){console.log("autoComplete.setItem",e.data),r.resolve(e.data)},function(e){r.reject(e)}),r.promise}},r}]),app.factory("DataFilter",[function(){function e(e){e?angular.extend(this,e):null}return e.prototype={getSearchParams:function(e){var t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return t},getParams:function(e,t){var n,o={};for(var r in this)"dateFrom"===r||"dateTo"===r||"status"===r?(n=this[r],void 0!==n&&(o[r]=n)):"search"===r&&(o[r]=JSON.stringify(this.getSearchParams(this[r]),null,""));return o.page=e.page,o.size=e.size,o.infinite=t,o}},e}]),app.factory("DataSource",["$q","$http","$httpAsync","$timeout","$rootScope","DataFilter",function(e,t,n,o,r,i){function s(e){this.busy=!1,this.error=!1,this.size=10,this.maxPages=10,this.rows=[],this.filters={},this.service={url:"/api/items/paging",resolve:function(e,t){angular.forEach(e,function(e){this.push(e)},t)}},e?angular.extend(this,e):null,this.filters=new i(this.filters),this.service.uri.paging===!1&&(this.get=function(e,t){this.busy=!0,this.error=!1,o(function(){t?null:this.rows.length=0,this.service.resolve(this.rows),this.page=1,this.pages=2,this.count=this.rows.length,this.pagination=this.getPages(),this.busy=!1,r.$broadcast("onDataSourceUpdate",this),e.resolve(this.rows)}.bind(this),1e3)}),this.flush()}var a=Number.POSITIVE_INFINITY;return s.prototype={flush:function(){this.pages=a,this.page=1,this.count=0,this.opened=null},resolve:function(e){var t=e.headers("X-Pagination"),n=t?JSON.parse(t):null;n?(this.page=n.page,this.size=n.size,this.pages=n.pages,this.count=n.count):(this.page=0,this.size=n.size,this.pages=0,this.count=0),this.pagination=this.getPages()},get:function(e,t){this.busy=!0,this.error=!1,n.get(this.service.uri.paging,{params:this.filters.getParams(this)}).then(function(n){this.resolve(n),t?null:this.rows.length=0,this.service.resolve(n.data,this.rows),r.$broadcast("onDataSourceUpdate",this),e.resolve(this.rows)}.bind(this),function(t){console.log("error.response",t),this.error=!0,e.reject(t)}.bind(this))["finally"](function(){o(function(){this.busy=!1}.bind(this),1e3)}.bind(this))},paging:function(){var t=e.defer();return this.busy||this.page>this.pages?t.reject():(this.opened=null,this.get(t)),t.promise},refresh:function(){var t=e.defer();return this.busy?t.reject():(this.flush(),this.get(t)),t.promise},more:function(){var t=e.defer();return this.busy||this.page+1>this.pages?t.reject():(this.page++,this.get(t,!0)),t.promise},filter:function(){this.page=1,this.pages=a,this.paging()},prevPage:function(){var e=this.page-1;e>0&&e<=this.pages&&(this.page=e,this.paging())},nextPage:function(){var e=this.page+1;e>0&&e<=this.pages&&(this.page=e,this.paging())},gotoPage:function(e){e>0&&e<=this.pages&&(this.page=e,this.paging())},firstPage:function(){1!==this.page&&(this.page=1,this.paging())},lastPage:function(){this.page!==this.pages&&(this.page=this.pages,this.paging())},hasMany:function(){return this.count>0&&this.pages>this.maxPages},hasMorePagesBehind:function(){var e=Math.max(0,this.page-this.maxPages);return e>0},hasMorePagesNext:function(){var e=Math.max(0,this.page-this.maxPages)+this.maxPages;return e<this.pages},isPage:function(e){return this.page===e},hasPages:function(){return this.pages>0&&this.pages<a},getPages:function(){var e,t=[];if(this.hasPages()){var n=Math.max(0,this.page-this.maxPages),o=Math.min(this.pages,n+this.maxPages);for(e=n;o>e;)t.push({number:e+1}),e++}return t},openClose:function(e){this.opened===e?this.opened=null:this.opened=e}},s}]),app.factory("Cookie",["$q","$window",function(e,t){function n(){}return n.TIMEOUT=3e5,n._set=function(e,n,o){if(o){var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3);var i="; expires="+r.toGMTString()}else var i="";t.document.cookie=e+"="+n+i+"; path=/"},n.set=function(e,t,o){try{var r=[],i=JSON.stringify(t,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t}});r=null,n._set(e,i,o)}catch(s){console.log("Cookie.set.error serializing",e,t,s)}},n.get=function(e){for(var n=e+"=",o=t.document.cookie.split(";"),r=0;r<o.length;r++){for(var i=o[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(n)){var s=i.substring(n.length,i.length),a=null;try{a=JSON.parse(s)}catch(u){console.log("Cookie.get.error parsing",key,u)}return a}}return null},n["delete"]=function(e){n._set(e,"",-1)},n.on=function(t){function o(){if(a>u)i.reject("timeout");else{var e=n.get(t);e?i.resolve(e):(a+=s,r=setTimeout(o,s))}}var r,i=e.defer(),s=1e3,a=0,u=n.TIMEOUT;return o(),i.promise},n}]),app.factory("LocalStorage",["$q","$window","Cookie",function(e,t,n){function o(){}function r(){var e=!1;try{e="localStorage"in t&&null!==t.localStorage,e?(t.localStorage.setItem("test","1"),t.localStorage.removeItem("test")):e=!1}catch(n){e=!1}return e}return o.isSupported=r(),o.isSupported?(o.set=function(e,n){try{var o=[],r=JSON.stringify(n,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){
if(-1!==o.indexOf(t))return;o.push(t)}return t}});o=null,t.localStorage.setItem(e,r)}catch(i){console.log("LocalStorage.set.error serializing",e,n,i)}},o.get=function(e){var n=null;if(void 0!==t.localStorage[e])try{n=JSON.parse(t.localStorage[e])}catch(o){console.log("LocalStorage.get.error parsing",e,o)}return n},o["delete"]=function(e){t.localStorage.removeItem(e)},o.on=function(o){function r(e){if(clearTimeout(i),e.originalEvent.key==o)try{var t=JSON.parse(e.originalEvent.newValue);s.resolve(t)}catch(e){console.log("LocalStorage.on.error parsing",o,e),s.reject("error parsing "+o)}}var i,s=e.defer(),a=n.TIMEOUT;return angular.element(t).on("storage",r),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("LocalStorage.unsupported switching to cookies"),o.set=n.set,o.get=n.get,o["delete"]=n["delete"],o.on=n.on),o}]),app.factory("Utils",["Vector",function(e){function t(t,n){var o=new e;if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var r=null,i=t.originalEvent?t.originalEvent:t,s=i.touches.length?i.touches:i.changedTouches;s&&s.length&&(r=s[0]),r&&(o.x=r.pageX,o.y=r.pageY)}else"click"!=t.type&&"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(o.x=t.pageX,o.y=t.pageY);return n&&(o.s=e.difference(n,o)),o.type=t.type,o}function n(t,n){var o=t[0].getBoundingClientRect(),r=new e(o.left,o.top);return e.difference(r,n)}function o(e,t){var n,o;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]?(n=e,!0):!1});null!==e;){if(o=e.parentElement,null!==o&&o[n](t))return o;e=o}return null}function r(e,t,n){var o,r,i,s=null,u=0;n||(n={});var l=function(){u=n.leading===!1?0:a(),s=null,i=e.apply(o,r),s||(o=r=null)};return function(){var c=a();u||n.leading!==!1||(u=c);var f=t-(c-u);return o=this,r=arguments,0>=f||f>t?(s&&(clearTimeout(s),s=null),u=c,i=e.apply(o,r),s||(o=r=null)):s||n.trailing===!1||(s=setTimeout(l,f)),i}}function i(){}!function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var o=(new Date).getTime(),r=Math.max(0,16-(o-e)),i=window.setTimeout(function(){t(o+r)},r);return e=o+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var s=function(){var e="transform",t="webkitTransform",n=document.createElement("DIV");return"undefined"!=typeof n.style[e]?["webkit","moz","o","ms"].every(function(t){var o="-"+t+"-transform";return"undefined"!=typeof n.style[o]?(e=o,!1):!0}):e="undefined"!=typeof n.style[t]?"-webkit-transform":void 0,e}(),a=Date.now||function(){return(new Date).getTime()},u=function(){function e(){this.props={scale:1,hoverScale:1,currentScale:1}}return e.prototype={set:function(e){var t=[];angular.forEach(this,function(e,n){"props"!==n&&t.push(n+":"+e)}),e.style.cssText=t.join(";")+";"},transform:function(e){this[i.transformProperty]=e},transformOrigin:function(e,t){this[i.transformProperty+"-origin-x"]=Math.round(1e3*e)/1e3+"%",this[i.transformProperty+"-origin-y"]=Math.round(1e3*t)/1e3+"%"}},e}();return i.transformProperty=s,i.getTouch=t,i.getRelativeTouch=n,i.getClosest=o,i.throttle=r,i.Style=u,i}]),app.factory("WebWorker",["$q","$http",function($q,$http){function WebWorker(e){var t=this;this.callbacks={},this.id=0,this.worker=new Worker(e),this.worker.onmessage=function(e){t.onmessage(e)}}var isWebWorkerSupported="undefined"!=typeof Worker;return isWebWorkerSupported||(window.Worker=function(){function Worker(src){var self=this;$http.get(src,{transformResponse:function(e,t){return e}}).then(function success(response){try{eval("self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\n "+response.data+" };"),self.object=new self.o,self.object.postMessage=function(e){self.onmessage({data:e})}}catch(e){console.log("Worker error ",e)}},function(e){console.log("Worker not found")})}return Worker.prototype={onmessage:function(e){console.log("Worker not implemented")},postMessage:function(e){this.object.onmessage({data:e})}},Worker}()),WebWorker.prototype={parse:function(e){return JSON.parse(e.data)},stringify:function(e){return JSON.stringify(e)},onmessage:function(e){var t=this.parse(e),n=this.callbacks[t.id];-1!==t.status?n.resolve(t):n.reject(t),delete this.callbacks[t.id]},post:function(e){var t=$q.defer();return e.id=this.id,this.callbacks[this.id.toString()]=t,this.id++,this.worker.postMessage(this.stringify(e)),t.promise}},WebWorker.isSupported=isWebWorkerSupported,WebWorker}]),app.factory("$httpAsync",["$q","$http",function(e,t){function n(t){var o=e.defer(),r=u(t);return r.id=p.toString(),console.log("wrap",r),f[r.id]=o,p++,c.postMessage(n.stringify(r)),o.promise}function o(e){return e>=200&&300>e}function r(){return Object.create(null)}function i(e){return"string"==typeof e}function s(e){function t(e,t){e&&(o[e]=o[e]?o[e]+", "+t:t)}var n,o=r();if(i(e))for(var s=e.split("\n"),a=0;a<s.length;a++){var u=s[a];n=u.indexOf(":"),t(d(h(u.substr(0,n))),h(u.substr(n+1)))}else if(isObject(e))for(var l in e)t(d(l),h(e[l]));return o}function a(e){var t;return function(n){if(t||(t=s(e)),n){var o=t[d(n)];return void 0===o&&(o=null),o}return t}}function u(e){var n={method:"GET",withCredentials:!1,responseType:"json",headers:{},config:{}};n.withCredentials=t.defaults.withCredentials,angular.extend(n.headers,t.defaults.headers.common);var o=(e.method||n.method).toLowerCase();return t.defaults.headers[o]&&angular.extend(n.headers,t.defaults.headers[o]),console.log("defaults",t.defaults),e?e=angular.extend(n,e):n,e}var l="undefined"!=typeof Worker;if(!l)return t;var c=new Worker("/js/workers/http.min.js"),f={},p=0,d=function(e){return i(e)?e.toLowerCase():e},h=function(e){return i(e)?e.trim():e};return n.get=function(e,t){return n(angular.extend({},t||{},{method:"GET",url:e}))},n["delete"]=function(e,t){return n(angular.extend({},t||{},{method:"DELETE",url:e}))},n.head=function(e,t){return n(angular.extend({},t||{},{method:"HEAD",url:e}))},n.post=function(e,t,o){return n(angular.extend({},o||{},{method:"POST",data:t,url:e}))},n.put=function(e,t,o){return n(angular.extend({},o||{},{method:"PUT",data:t,url:e}))},n.patch=function(e,t,o){return n(angular.extend({},o||{},{method:"PATCH",data:t,url:e}))},n.parse=function(e){return JSON.parse(e.data)},n.stringify=function(e){return JSON.stringify(e)},n.isSupported=l,c.onmessage=function(e){var t=n.parse(e);console.log("onmessage",t);var r=f[t.id],i=t.status>=-1?t.status:0,s=a(t.response.headers);(o(i)?r.resolve:r.reject)({data:t.response.data,headers:s,status:t.response.status,statusText:t.response.statusText,config:t.config}),delete f[t.id]},n}]),app.controller("RootCtrl",["$scope","$location","FacebookService","Users",function(e,t,n,o){e.Users=o,e.signOut=function(){e.logoutBusy||(e.logoutBusy=!0,o.signout().then(function(){t.path("/splash")})["finally"](function(){e.logoutBusy=!1}))},e.goStream=function(){t.path("/stream")},e.goPost=function(){t.path("/post")},e.goDish=function(e){t.path("/dishes/"+e)},e.goCategory=function(e){t.path("/categories/"+e)},e.goUser=function(e){t.path("/users/"+e)},e.goSettings=function(){t.path("/settings")}}]),app.controller("SplashCtrl",["$scope","$location","$timeout","$window","FacebookService","Users",function(e,t,n,o,r,i){function s(n){e.splashBusy=!0,i.signInWithFacebook(n).then(function(e){t.path("/stream")},function(e){t.path("/signup")})["finally"](function(){e.splashBusy=!1})}e.splashBusy=!0,e.showFacebookLoginButton=!0,e.onFacebookLogin=function(){e.splashBusy=!0,r.login().then(function(e){s(e.authResponse)},function(e){console.log("onFacebookLogin",e)})["finally"](function(){e.splashBusy=!1})}}]),app.controller("SigninCtrl",["$scope","$location","Users","FacebookService",function(e,t,n,o){e.model={},e.signin=function(){e.signinFormError=null,e.signinFormBusy=!0,n.signin(e.model).then(function(e){t.path("/stream")},function(t){e.signinFormError=t.message})["finally"](function(){e.signinFormBusy=!1})}}]),app.controller("SignupCtrl",["$scope","$location","FacebookService","Users",function(e,t,n,o){n.getFacebookMe().then(function(t){console.log("SignupCtrl.getFacebookMe",t),e.model={userName:t.name,email:t.email,firstName:t.first_name,lastName:t.last_name,facebookId:t.id,facebookPicture:t.picture.data.url,facebookToken:n.authResponse.accessToken}},function(e){console.log("SignupCtrl.getFacebookMe.error",e)}),e.signup=function(){console.log("SignupCtrl.signup",e.model),e.signupFormError=null,e.signupFormBusy=!0,o.signup(e.model).then(function(e){t.path("/stream")},function(t){e.signupFormError=t.data.message})["finally"](function(){e.signupFormBusy=!1})}}]),app.controller("StreamCtrl",["$scope","$location","$timeout","DataSource","Posts","Upload",function(e,t,n,o,r,i){e.filters={search:{}},e.source=new o({service:r,filters:e.filters}),e.source.paging(),e.onUploadFileSelected=function(n,o){n&&(e.$root.pictureBase64=null,i.dataUrl(n,!0).then(function(n){e.$root.pictureBase64=n,t.path("/post")}))}}]),app.controller("PostCtrl",["$scope","$timeout","$location","Upload","Categories","Posts","DishesAutocomplete",function(e,t,n,o,r,i,s){r.get().then(function(t){e.categories=t}),e.dishesAutocomplete=new s,e.model={pictureBase64:e.$root.pictureBase64||null,dish:{categories:[]}},e.onUploadFileSelected=function(t,n){e.model.pictureBase64=null,o.dataUrl(t,!0).then(function(t){e.model.pictureBase64=t})},e.hasPicture=function(){var n=null!==e.model.pictureBase64;return e.pictureError=!0,t(function(){e.pictureError=!1},1e3),n},e.onDishSelected=function(t){console.log("onDishSelected",t),e.model.dish.id=t.id,e.model.dish.price=t.price,e.model.dish.categories=t.categories,e.model.dish.isVeganFriendly=t.isVeganFriendly},e.submitPost=function(){console.log("PostCtrl.submitPost",e.model),e.postFormBusy=!0,e.postFormError=null,t(function(){i.add(e.model).then(function(t){e.model.id=t.id,n.path("/stream")},function(t){e.postFormError=t.config.url+" "+t.status+" "+t.statusText})["finally"](function(){e.postFormBusy=!1})},1)}}]),app.controller("DishCtrl",["$scope","$routeParams","Dishes",function(e,t,n){n.detail(t.dishId).then(function(t){e.item=t})}]),app.controller("CategoryCtrl",["$scope","$routeParams","Categories","DataSource","Dishes",function(e,t,n,o,r){n.detail(t.categoryId).then(function(t){e.category=t,e.filters={search:{Category:t.name}},e.source=new o({service:r,filters:e.filters}),e.source.paging()})}]),app.controller("UserCtrl",["$scope","$routeParams","Users","DataSource","Dishes",function(e,t,n,o,r){n.detail(t.userRoute).then(function(t){e.user=t,e.filters={search:{UserName:t.userName}},e.source=new o({service:r,filters:e.filters}),e.source.paging()})}]),app.controller("SettingsCtrl",["$scope","$routeParams","Users",function(e,t,n){e.user=n.currentUser()}]),app.controller("TestCtrl",["$scope","$location","$timeout","DataSource","DishesTest",function(e,t,n,o,r){e.filters={search:{}},e.source=new o({service:r,filters:e.filters}),n(function(){e.source.paging()},1e3)}]);
//# sourceMappingURL=app.min.js.map
