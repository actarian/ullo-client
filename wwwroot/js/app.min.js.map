{"version":3,"sources":["wwwroot/js/app.js"],"names":["Vector","x","y","this","make","a","b","size","Math","sqrt","normalize","l","incidence","angle","atan2","distance","cross","difference","prototype","towards","friction","add","copy","toString","Utils","getTouch","e","previous","t","type","touch","event","originalEvent","touches","length","changedTouches","pageX","pageY","s","getRelativeTouch","element","point","rect","getBoundingClientRect","left","top","getClosest","el","selector","matchesFn","parent","some","fn","document","body","parentElement","throttle","func","wait","options","context","args","result","timeout","later","leading","getNow","apply","now","remaining","arguments","clearTimeout","trailing","setTimeout","lastTime","vendors","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","max","id","transformProperty","safariPropertyHack","style","every","prefix","undefined","Style","props","scale","hoverScale","currentScale","set","styles","angular","forEach","value","key","push","cssText","join","transform","transformOrigin","round","LESSON","app","module","constant","CLIENT","location","href","indexOf","API","FACEBOOK_APP_ID","assetTypeEnum","Unknown","Picture","IOS","navigator","userAgent","match","config","$httpProvider","$routeProvider","$locationProvider","defaults","withCredentials","when","title","templateUrl","controller","controllerAs","resolve","user","Users","isLoggedOrGoTo","isForward","otherwise","html5Mode","run","$rootScope","$window","APP","route","standalone","ontouchmove","preventDefault","oncontextmenu","stopPropagation","getPictures","model","src","pictures","i","media","getPicture","picture","broadcast","params","$broadcast","animation","$animate","isFirstView","currentRoute","isBackward","previousRoute","bezierOptions","dynamics","bezier","points","cp","duration","$on","current","$$route","enter","done","css","translateY","opacity","animate","w","offsetWidth","translateX","leave","directive","$timeout","restrict","link","scope","attributes","onTap","addClass","removeClass","addListeners","on","removeListeners","off","delays","split","delay","d","parseInt","removeClasses","shift","require","validateType","$parsers","unshift","$setValidity","String","Number","$parse","replace","template","form","placeholder","name","formKey","formFocus","required","label","readonly","control","number","source","canCreate","flatten","queryable","onSelected","rows","MAX_ITEMS","service","getPhrase","Clear","phrase","items","count","input","val","Current","active","onTyping","Enter","item","onSelect","$apply","Up","Down","Parse","data","index","toLowerCase","NameA","substr","NameB","NameC","Filter","c","Search","setPhrase","then","success","error","console","log","onKeyDown","keyCode","onKeyUp","call","onUp","target","onBlur","Init","init","find","maxItems","POSITIVE_INFINITY","onFocus","$parent","$eval","setItem","parsedItem","$item","$event","extend","$watch","newValue","$watchCollection","$compile","doTop","busy","onTop","sy","ey","undrag","doBottom","onBottom","lbottom2","offsetHeight","inner","lbottom","padding","dragging","wheeling","move","down","removeDragListeners","bounce","ltop","redraw","time","speed","abs","cy","pause","min","innerStyle","toFixed","showIndicatorFor","percent","iy","indicator","ix","html","indicatorStyle","play","loop","aKey","onDown","addDragListeners","onMove","prev","up","_onWheel","dir","deltaY","wheelDelta","onWheel","ondragstart","attr","append","contents","ngImg","image","Image","onload","$set","load","WebWorker","worker","doWork","onImageLoaded","post","url","ngImgWorker","Guest","User","Supervisor","Admin","factory","UserRolesEnum","isAdmin","role","isUser","email","facebookId","backgroundPicture","$q","$http","Dish","Upload","Post","dish","upload","file","self","lastIndexOf","extension","uploadData","assetType","progress","uploads","JSON","stringify","response","concat","has","splice","status","progressPercentage","loaded","total","voteCount","yes","no","rating","ratingToString","votes","vote","like","deferred","defer","dishId","reject","promise","FacebookService","onFacebookStatus","authResponse","FB","getFacebookMe","facebook","api","fields","getPictureMe","width","height","login","isMobile","permissionUrl","logout","fbAsyncInit","appId","cookie","xfbml","version","getLoginStatus","js","fjs","getElementsByTagName","getElementById","createElement","parentNode","insertBefore","$httpAsync","$location","LocalStorage","_currentUser","currentUser","getCurrentUser","get","isLogged","isAuthenticated","redirect","path","isAdminOrGoTo","signup","signin","signInWithFacebook","auth","signout","detail","userRoute","Categories","categoryId","getRandomItems","uniqueId","price","floor","random","userName","TestSource","uri","paging","Posts","Dishes","DishesAutocomplete","v","offset","DataFilter","getSearchParams","search","p","getParams","infinite","page","DataSource","maxPages","filters","pages","pagination","getPages","bind","flush","PAGES_MAX","opened","responseHeader","headers","responseView","parse","refresh","more","filter","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","isLocalStorageSupported","isSupported","cache","json","localStorage","onStorage","callbacks","Worker","onmessage","isWebWorkerSupported","transformResponse","h","eval","object","o","postMessage","wrap","getDefaults","isSuccess","createMap","Object","create","isString","parseHeaders","fillInParsed","parsed","j","line","lowercase","trim","isObject","headersGetter","headersObj","method","responseType","common","string","head","put","patch","getter","statusText","$scope","signOut","logoutBusy","goStream","goPost","goDish","goCategory","goUser","goSettings","signinOrSignup","splashBusy","showFacebookLoginButton","onFacebookLogin","signinFormError","signinFormBusy","message","me","firstName","first_name","lastName","last_name","facebookPicture","facebookToken","accessToken","signupFormError","signupFormBusy","onUploadFileSelected","newFiles","$root","pictureBase64","dataUrl","categories","dishesAutocomplete","hasPicture","pictureError","onDishSelected","isVeganFriendly","submitPost","postFormBusy","postFormError","$routeParams","category","Category","UserName","DishesTest"],"mappings":"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","file":"wwwroot/js/app.min.js","sourcesContent":["\r\nvar Vector = function () {\r\n    function Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n}();\r\n\r\nvar Utils = function () {\r\n    \r\n    (function () {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };            \r\n        }\r\n    }());\r\n\r\n    var transformProperty = function detectTransformProperty() {\r\n        var transformProperty = 'transform',\r\n            safariPropertyHack = 'webkitTransform';\r\n        if (typeof document.body.style[transformProperty] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function (prefix) {\r\n                var e = '-' + prefix + '-transform';\r\n                if (typeof document.body.style[e] !== 'undefined') {\r\n                    transformProperty = e;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof document.body.style[safariPropertyHack] !== 'undefined') {\r\n            transformProperty = '-webkit-transform';\r\n        } else {\r\n            transformProperty = undefined;\r\n        }\r\n        return transformProperty;\r\n    }();\r\n    \r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left,  rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    \r\n    var getNow = Date.now || function() {\r\n        return new Date().getTime();\r\n    };\r\n\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n\r\n    var Style = function() {            \r\n        function Style() {\r\n            this.props = {\r\n                scale: 1,\r\n                hoverScale: 1,\r\n                currentScale: 1,\r\n            }\r\n        }\r\n        Style.prototype = {\r\n            set: function (element) {\r\n                var styles = [];\r\n                angular.forEach(this, function (value, key) {\r\n                    if (key !== 'props')\r\n                        styles.push(key + ':' + value);\r\n                });\r\n                element.style.cssText = styles.join(';') + ';';\r\n            },\r\n            transform: function (transform) {\r\n                this[Utils.transformProperty] = transform;\r\n            },\r\n            transformOrigin: function (x, y) {\r\n                this[Utils.transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n                this[Utils.transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n            },\r\n        };        \r\n        return Style;        \r\n    }();\r\n\r\n    function Utils() {\r\n\r\n    }\r\n\r\n    Utils.transformProperty = transformProperty;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.throttle = throttle;\r\n    Utils.Style = Style;\r\n    \r\n    return Utils;\r\n\r\n}();\n/*global angular,FB */\r\n\r\nvar LESSON = true;\r\n\r\nvar app = angular.module('ullo', ['ngRoute', 'ngMessages', 'ngAnimate', 'relativeDate', 'ngFileUpload']);\r\n\r\napp.constant('APP', {\r\n    CLIENT: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? 'http://ulloclient.wslabs.it' : 'http://dev.ullowebapp:8081',\r\n    API: LESSON || window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? 'http://ulloapi.wslabs.it' : 'https://localhost:44302',\r\n    FACEBOOK_APP_ID: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? '1054303094614120' : '1062564893787940',\r\n    assetTypeEnum: {\r\n        Unknown: 0,\r\n        Picture: 1,\r\n    },\r\n    IOS: (navigator.userAgent.match(/iPad|iPhone|iPod/g) ? true : false),\r\n});\r\n\r\napp.config(['$httpProvider', '$routeProvider', '$locationProvider', function ($httpProvider, $routeProvider, $locationProvider) {\r\n\r\n    $httpProvider.defaults.withCredentials = true;\r\n    \r\n    $routeProvider.when('/test', {\r\n\r\n        title: 'Test',\r\n        templateUrl: 'templates/dishes.html',\r\n        controller: 'TestCtrl',\r\n        controllerAs: 'testCtrl',\r\n\r\n    }).when('/', {\r\n\r\n        title: 'Stream',\r\n        templateUrl: 'templates/stream.html',\r\n        controller: 'StreamCtrl',\r\n        controllerAs: 'streamCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n\r\n    }).when('/stream', {\r\n\r\n        title: 'Stream',\r\n        templateUrl: 'templates/stream.html',\r\n        controller: 'StreamCtrl',\r\n        controllerAs: 'streamCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n\r\n    }).when('/splash', {\r\n\r\n        title: 'Splash',\r\n        templateUrl: 'templates/splash.html',\r\n        controller: 'SplashCtrl',\r\n        controllerAs: 'splashCtrl',\r\n\r\n    }).when('/signin', {\r\n\r\n        title: 'Sign In',\r\n        templateUrl: 'templates/signin.html',\r\n        controller: 'SigninCtrl',\r\n        controllerAs: 'signinCtrl',\r\n\r\n    }).when('/signup', {\r\n\r\n        title: 'Sign Up',\r\n        templateUrl: 'templates/signup.html',\r\n        controller: 'SignupCtrl',\r\n        controllerAs: 'signupCtrl',\r\n\r\n    }).when('/dishes/:dishId', {\r\n\r\n        title: 'Dish',\r\n        templateUrl: 'templates/dish.html',\r\n        controller: 'DishCtrl',\r\n        controllerAs: 'dishCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/categories/:categoryId', {\r\n\r\n        title: 'Category',\r\n        templateUrl: 'templates/category.html',\r\n        controller: 'CategoryCtrl',\r\n        controllerAs: 'categoryCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/users/:userRoute', {\r\n\r\n        title: 'User',\r\n        templateUrl: 'templates/user.html',\r\n        controller: 'UserCtrl',\r\n        controllerAs: 'userCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/post', {\r\n\r\n        title: 'Add Post',\r\n        templateUrl: 'templates/post.html',\r\n        controller: 'PostCtrl',\r\n        controllerAs: 'postCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/settings', {\r\n\r\n        title: 'Settings',\r\n        templateUrl: 'templates/settings.html',\r\n        controller: 'SettingsCtrl',\r\n        controllerAs: 'settingsCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/404', {\r\n\r\n        title: 'Error 404',\r\n        templateUrl: '404.html',\r\n\r\n    });\r\n\r\n    $routeProvider.otherwise('/stream');\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(true);\r\n\r\n}]);\r\n\r\napp.run(['$rootScope', '$window', 'APP', function ($rootScope, $window, APP) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    document.ontouchmove = function (event) {\r\n        event.preventDefault();\r\n        // event.stopPropagation();\r\n        // return false;\r\n    }\r\n\r\n    window.oncontextmenu = function (event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return false;\r\n    };\r\n\r\n    /*\r\n    $rootScope.$on('$routeChangeSuccess', function($scope, nextRoute, lastRoute) {\r\n        console.log('app.$routeChangeSuccess', 'nextRoute', nextRoute, 'lastRoute', lastRoute);\r\n    });\r\n    */\r\n\r\n    function Picture(route, size) {\r\n        if (route.indexOf('http') === 0) {\r\n            return route;\r\n        } else if (size) {\r\n            return APP.API + route + '?media=' + size;\r\n        } else {\r\n            return APP.API + route;\r\n        }\r\n    }\r\n\r\n    $rootScope.getPictures = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.pictures) {\r\n            for (var i = 0; i < model.pictures.length; i++) {\r\n                var media = model.pictures[i];\r\n                if (media.route) {\r\n                    src = Picture(media.route, size);\r\n                    i = 100000;\r\n                }\r\n            }\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.getPicture = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.picture && model.picture.route) {\r\n            src = Picture(model.picture.route, size);\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    // BROADCAST LISTENER\r\n    $rootScope.broadcast = function (event, params) {\r\n        $rootScope.$broadcast(event, params);\r\n    };\r\n\r\n    // WOW ANIMATION\r\n    /*\r\n    new WOW({\r\n        boxClass: 'wow',\r\n        animateClass: 'animated',\r\n        offset: -20,\r\n        mobile: true,\r\n        live: true\r\n    }).init();\r\n    */\r\n\r\n    /*\r\n    // FONT PRELOADER\r\n    setTimeout(function () {\r\n\r\n        var fontAkzidenz400 = new FontFaceObserver(\"Akzidenz\", {\r\n            weight: 400\r\n        });\r\n        var fontAkzidenz500 = new FontFaceObserver(\"Akzidenz\", {\r\n            weight: 500\r\n        });\r\n        var fontAkzidenzCondensed = new FontFaceObserver(\"Akzidenz Condensed\", {\r\n            weight: 700\r\n        });\r\n        Promise.all([\r\n            fontAkzidenz400.check(),\r\n            fontAkzidenz500.check(null, 1000),\r\n            fontAkzidenzCondensed.check(),\r\n        ]).then(function () {\r\n            document.documentElement.className += \" fonts-loaded\";\r\n        }, function () {\r\n            document.documentElement.className += \" fonts-timeout\";\r\n        });\r\n\r\n    }, 0);\r\n    */\r\n\r\n}]);\r\n\r\n/*\r\napp.provider('user', function userProvider() {        \r\n    // In the provider function, you cannot inject any\r\n    // service or factory. This can only be done at the\r\n    // \"$get\" method.\r\n    this.$get = ['$q', '$location', 'Users', function ($q, $location, Users) {\r\n        return {\r\n            isLoggedOrGoTo: function(redirect) {\r\n                var deferred = $q.defer();\r\n                Users.isLogged().then(function (user) {\r\n                    console.log('isLogged.success', user);\r\n                    deferred.resolve(user);\r\n                }, function (error) {\r\n                    console.log('isLogged.error', error);\r\n                    deferred.reject();\r\n                    $location.path(redirect);\r\n                });\r\n                return deferred.promise;\r\n            },\r\n            isAdminOrGoTo: function(redirect) {\r\n                var deferred = $q.defer();\r\n                Users.isAdmin().then(function (user) {\r\n                    deferred.resolve(user);\r\n                }, function () {\r\n                    deferred.reject();\r\n                    $location.path(redirect);\r\n                });\r\n                return deferred.promise;\r\n            },\r\n            isLogged: function() {\r\n                return this.isLoggedOrGoTo('/splash');\r\n            },\r\n            isAdmin: function() {\r\n                return this.isAdminOrGoTo('/splash');\r\n            }\r\n        }\r\n    }];\r\n});\r\n*/\n\r\napp.animation('.navigation', ['$rootScope', '$animate', function($rootScope, $animate) {       \r\n    var previousRoute = null;\r\n    var currentRoute = null;    \r\n    var bezierOptions = {\r\n        type: dynamics.bezier,\r\n        points: [{x:0,y:0,cp:[{x:0.509,y:0.007}]},{x:1,y:1,cp:[{x:0.566,y:0.997}]}],\r\n        duration : 500,        \r\n    }    \r\n    $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        previousRoute = previous.$$route;\r\n        currentRoute = current.$$route;\r\n    });   \r\n    function isFirstView() {\r\n        return !currentRoute;\r\n    }    \r\n    function isBackward() {\r\n        return previousRoute.isForward;\r\n    }    \r\n    return {\r\n        enter: function(element, done) {                        \r\n            if (isFirstView()) {\r\n                // FIRST ENTERING ANIMATION\r\n                dynamics.css(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 0,\r\n                    scale: 1.2,\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 1,\r\n                    scale: 1,\r\n                }, bezierOptions);            \r\n            } else if (isBackward()) {\r\n                // BACKWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: -w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions); \r\n            } else {\r\n                // FORWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions); \r\n            }\r\n            done();\r\n        },    \r\n        leave: function(element, done) {\r\n            if (isBackward()) {\r\n                // BACKWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: w\r\n                }, bezierOptions); \r\n            } else {\r\n                // FORWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: -w\r\n                }, bezierOptions); \r\n            }\r\n            setTimeout(done, 1000);\r\n        }\r\n    }\r\n}]);\n/*global angular,FB,dynamics */\r\n\r\napp.directive('onTap', ['$window', '$timeout', function ($window, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            function onTap(e) {\r\n                /*\r\n                var down = Utils.getTouch(e);\r\n                var r = Utils.getRelativeTouch(element, down);\r\n                console.log('onTap', down, r);\r\n                */\r\n                element.addClass('tapped');\r\n                $timeout(function(){\r\n                    element.removeClass('tapped');\r\n                }, 500)\r\n            };\r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onTap);\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onTap);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('animate', ['$window', '$timeout', function ($window, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            element.addClass('animated');\r\n            var animate = ['fadeIn'], delays = ['1'];\r\n            if (attributes.animate !== undefined) {\r\n                animate = attributes.animate.split(',');\r\n            } \r\n            if (attributes.delay !== undefined) {\r\n                delays = attributes.delay.split(',');\r\n            }\r\n            angular.forEach(delays, function(d, i) {\r\n                delays[i] = parseInt(d);\r\n            });\r\n            while(delays.length < animate.length) {\r\n                delays.push(delays[delays.length-1] + 50);\r\n            }\r\n            var removeClasses = animate.join(' '); \r\n            if (animate[0].indexOf('In') !== -1) {\r\n                element.addClass('invisible');\r\n                removeClasses += ' invisible';\r\n            }\r\n            while(animate.length) {\r\n                var d = delays.shift();\r\n                var a = animate.shift();\r\n                $timeout(function(){\r\n                    element.removeClass(removeClasses);\r\n                    element.addClass(a);\r\n                    if (animate.length === 0 && a.indexOf('Out') !== -1) {\r\n                        $timeout(function(){\r\n                            element.addClass('invisible');\r\n                        }, 1000);\r\n                    }\r\n                }, d);\r\n            }\r\n            /* \r\n            $timeout(function() {\r\n                element.removeClass('animated');\r\n                dynamics.animate(element[0], {\r\n                    translateX: 350\r\n                }, {\r\n                    type: dynamics.spring\r\n                });\r\n                console.log('dynamics', dynamics);                \r\n            }, 5000);\r\n            */           \r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('validateType', function () {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function (scope, element, attributes, model) {\r\n            var type = attributes.validateType;\r\n            switch (type) {\r\n                case 'number':\r\n                    model.$parsers.unshift(function (value) {\r\n                        // console.log('validateType', type, value, Number(value).toString() == String(value), angular.isNumber(Number(value)));\r\n                        model.$setValidity(type, String(value).indexOf(Number(value).toString()) !== -1);\r\n                        return value;\r\n                    });\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n});\r\n\r\napp.directive('control', ['$parse', function ($parse) {\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        template: function (element, attributes) {\r\n            var form = attributes.form || 'Form';\r\n            var title = attributes.title || 'Untitled';\r\n            var placeholder = attributes.placeholder || title;\r\n            var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('');\r\n            var formKey = form + '.' + name;\r\n            var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n            var required = '';\r\n            var label = (attributes.label ? attributes.label : 'name');\r\n            var key = (attributes.key ? attributes.key : 'id');\r\n            var model = attributes.model;\r\n            if (attributes.required) {\r\n                required = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + form + '.' + name + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> &larr; required</span>';\r\n                switch (attributes.control) {\r\n                    case 'password':\r\n                        required = required + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> &larr; at least 6 chars</span>';\r\n                        break;\r\n                    case 'email':\r\n                        required = required + '<span ng-message=\"email\" class=\"label-error animated flash\"> &larr; incorrect</span>';\r\n                        break;\r\n                    case 'number':\r\n                        required = required + '<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    required = required + '<span ng-message=\"match\" class=\"label-error animated flash\"> &larr; not matching</span>';\r\n                }\r\n                required = required + '</span>';\r\n            } else {\r\n                required = ' (optional)';\r\n            }\r\n            var template = '<div ' + (attributes.readonly ? ' class=\"readonly\" ' : '' ) + ' ng-class=\"{ focus: '+formKey+'.hasFocus, success: '+formKey+'.$valid, error: '+formKey+'.$invalid && (form.$submitted || '+formKey+'.$touched), empty: !'+formKey+'.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + required + '</label>';\r\n            switch (attributes.control) {\r\n                case 'checkbox':                \r\n                    template = '<div class=\"checkbox\">';\r\n                    template += '<span class=\"checkbox-label\">' + title + required + '</span>';\r\n                    template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + (attributes.required ? 'required=\"true\"' : '') + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                    template += '</div>';\r\n                    break;\r\n                case 'select':\r\n                    var options = attributes.number\r\n                        ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source\r\n                        : 'item.' + label + ' for item in ' + attributes.source + ' track by item.' + key;\r\n                    template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + ' ' + (attributes.required ? 'required=\"true\"' : '') + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                    break;\r\n                case 'autocomplete':\r\n                    var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                    var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                    var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                    var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                    template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                    template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                    break;\r\n                case 'textarea':\r\n                    template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" ' + (attributes.required ? 'required' : '') + ' rows=\"' + (attributes.rows ? attributes.rows : '1') + '\"' + formFocus + '></textarea>';\r\n                    break;\r\n                case 'datetime-local':\r\n                    placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;                    \r\n                    // placeholder=\"yyyy-MM-ddTHH:mm:ss\" min=\"2001-01-01T00:00:00\" max=\"2013-12-31T00:00:00\" \r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n                    break;\r\n                case 'password':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"6\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n                    break;\r\n                case 'email':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n                    break;\r\n                case 'number':\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n                    break;\r\n                case 'text':\r\n                default:\r\n                    template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n                    break;\r\n            }\r\n            return template + '</div>';\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n\r\n        },\r\n    };\r\n}]);\r\n\r\napp.directive('controlAutocomplete', ['$parse', '$window', '$timeout', function ($parse, $window, $timeout) {\r\n    \r\n    var MAX_ITEMS = 5;\r\n    \r\n    return {\r\n        restrict: 'A',\r\n        scope: {\r\n            service: '=controlAutocomplete',\r\n            canCreate: '=',\r\n            flatten: '=',\r\n            queryable: '=',\r\n            model: '=',\r\n            label: '@',\r\n            key: '@',\r\n        },\r\n        template: function (element, attributes) {\r\n            var template = '<div>';\r\n            template += '   <input class=\"form-control\" ng-model=\"phrase\" ng-model-options=\"{ debounce: 150 }\" placeholder=\"' + attributes.placeholder + '\" type=\"text\" ng-focus=\"onFocus()\">';\r\n            template += '   <ul class=\"form-autocomplete\" ng-show=\"items.length\">';\r\n            template += '       <li ng-repeat=\"item in items\" ng-class=\"{ active: active == $index }\" ng-click=\"onSelect(item)\">';\r\n            template += '           <span>{{item.NameA}}<span class=\"token\">{{item.NameB}}</span>{{item.NameC}}</span>';\r\n            template += '       </li>';\r\n            template += '   </ul>';\r\n            template += '</div>';\r\n            return template;\r\n        },\r\n        link: function (scope, element, attributes, model) {\r\n            \r\n            var onSelected = $parse(attributes.onSelected);\r\n            \r\n            // console.log ('onSelected', onSelected);\r\n            \r\n            var input = element.find('input');            \r\n            var label = (scope.label ? scope.label : 'name');\r\n            var key = (scope.key ? scope.key : 'id');\r\n\r\n            function getPhrase() {\r\n                if (scope.model) {\r\n                    return scope.flatten ? scope.model : scope.model[label];   \r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            scope.phrase = getPhrase();\r\n            scope.count = 0;\r\n            scope.items = [];\r\n            scope.active = -1;\r\n            scope.maxItems = scope.maxItems || Number.POSITIVE_INFINITY;\r\n\r\n            function Clear(phrase) {\r\n                scope.items.length = 0;\r\n                scope.count = 0;\r\n                scope.phrase = phrase || null;\r\n                input.val(scope.phrase);\r\n            }\r\n\r\n            function Current() {\r\n                var current = null;\r\n                if (scope.active != -1 && scope.items.length > scope.active) {\r\n                    current = scope.items[scope.active];\r\n                }\r\n                return current;\r\n            }\r\n\r\n            scope.onFocus = function () {\r\n                if (attributes.onFocus !== undefined) {\r\n                    scope.$parent.$eval(attributes.onFocus);\r\n                }\r\n                if (input.val() === getPhrase()) {\r\n                    input.val(null);\r\n                }\r\n            };\r\n\r\n            scope.onBlur = function () {\r\n                if (attributes.onBlur !== undefined) {\r\n                    scope.$parent.$eval(attributes.onBlur);\r\n                }\r\n                Clear(getPhrase());\r\n            };\r\n\r\n            scope.onSelect = function (item) {\r\n                if (scope.queryable) {\r\n                    scope.service.setItem(item).then(function (parsedItem) {\r\n                        onSelected({ $item : parsedItem }, scope.$parent, { $event: {} });\r\n                        $timeout(function () {\r\n                            if (scope.flatten) {\r\n                                scope.model = parsedItem[key];\r\n                            } else {\r\n                                scope.model = scope.model || {};\r\n                                angular.extend(scope.model, parsedItem);\r\n                            }\r\n                            scope.onBlur();\r\n                        }, 1);\r\n                    });\r\n                } else {                    \r\n                    onSelected({ $item : item }, scope.$parent, { $event: {} });\r\n                    if (scope.flatten) {\r\n                        scope.model = item[key];\r\n                    } else {\r\n                        scope.model = scope.model || {};                                \r\n                        angular.extend(scope.model, item);\r\n                    }\r\n                    scope.onBlur();\r\n                }\r\n            };\r\n            \r\n            function onTyping(phrase) {\r\n                if (scope.canCreate) {                \r\n                    if (scope.flatten) {\r\n                        if (key === label) {\r\n                            scope.model = phrase;\r\n                        }\r\n                    } else {\r\n                        scope.model = {};\r\n                        scope.model[label] = phrase;\r\n                    }            \r\n                }\r\n                // console.log(scope.model);\r\n            };\r\n\r\n            function Enter() {\r\n                var item = Current();\r\n                if (item) {\r\n                    scope.onSelect(item);\r\n                }\r\n                scope.$apply();\r\n            }\r\n\r\n            function Up() {\r\n                scope.active--;\r\n                if (scope.active < 0) {\r\n                    scope.active = scope.items.length - 1;\r\n                }\r\n                scope.$apply();\r\n            }\r\n\r\n            function Down() {\r\n                scope.active++;\r\n                if (scope.items.length == 0) {\r\n                    scope.active = -1;\r\n                } else if (scope.active >= scope.items.length) {\r\n                    scope.active = 0;\r\n                }\r\n                scope.$apply();\r\n            }\r\n\r\n            function Parse(data) {\r\n                scope.items = data.items;\r\n                scope.count = data.count;\r\n                angular.forEach(scope.items, function (value, index) {\r\n                    var name = value[label]; \r\n                    var i = name.toLowerCase().indexOf(scope.phrase.toLowerCase());\r\n                    value.NameA = name.substr(0, i);\r\n                    value.NameB = name.substr(i, scope.phrase.length);\r\n                    value.NameC = name.substr(i + scope.phrase.length, name.length - (i + scope.phrase.length));\r\n                });                \r\n            }\r\n\r\n            function Filter(data) {\r\n                var c = 0, i = [];\r\n                if (scope.phrase.length > 1) {\r\n                    angular.forEach(data.items, function (value, index) {\r\n                        var name = value[label]; \r\n                        if (name.toLowerCase().indexOf(scope.phrase.toLowerCase()) !== -1) {\r\n                            if (i.length < MAX_ITEMS) {\r\n                                i.push(value);\r\n                            }\r\n                            c++;\r\n                        }\r\n                    });\r\n                }\r\n                Parse({\r\n                    count: c,\r\n                    items: i\r\n                });\r\n            }\r\n\r\n            function Search() {\r\n                scope.phrase = input.val();\r\n                scope.active = -1;\r\n                onTyping(scope.phrase);\r\n                if (scope.queryable) {\r\n                    scope.service.setPhrase(scope.phrase).then(function (success) {\r\n                        scope.items = success.items;\r\n                        scope.count = success.count;\r\n                    }, function (error) {\r\n                        console.log('Search.queryable.error', scope.phrase, error);\r\n                    }).finally(function () {\r\n\r\n                    });\r\n                } else {\r\n                    Filter({\r\n                        count: scope.service.length,\r\n                        items: scope.service\r\n                    });\r\n                    scope.$apply();\r\n                }\r\n            }\r\n\r\n            function onKeyDown(e) {\r\n                switch (e.keyCode) {\r\n                    case 9: // Tab\r\n                    case 13: // Enter                        \r\n                        Enter();\r\n                        if (scope.items.length) {\r\n                            e.preventDefault ? e.preventDefault() : null;\r\n                            return false;\r\n                        }\r\n                        break;\r\n                    case 38:\r\n                        // Up\r\n                        Up();\r\n                        break;\r\n                    case 40:\r\n                        // Down\r\n                        Down();\r\n                        break;\r\n                }\r\n            }\r\n            function onKeyUp(e) {\r\n                switch (e.keyCode) {\r\n                    case 9: // Tab\r\n                    case 13: // Enter     \r\n                        break;\r\n                    case 39:\r\n                        // Right\r\n                        break;\r\n                    case 37:\r\n                        // Left\r\n                        break;\r\n                    case 38:\r\n                        // Up\r\n                        break;\r\n                    case 40:\r\n                        // Down\r\n                        break;\r\n                    default:\r\n                        // Text\r\n                        Search.call(this);\r\n                        break;\r\n                }\r\n            }\r\n            function onUp(e) {\r\n                if (Utils.getClosest(e.target, '[control-autocomplete]') === null) {\r\n                    scope.$apply(function () {\r\n                        // console.log('onUp');\r\n                        scope.onBlur();\r\n                    });\r\n                }\r\n                return true;\r\n            }\r\n            \r\n            function addListeners() {\r\n                input.on('keydown', onKeyDown);\r\n                input.on('keyup', onKeyUp);\r\n                angular.element($window).on('mouseup touchend', onUp);\r\n            };\r\n            function removeListeners() {\r\n                input.off('keydown', onKeyDown);\r\n                input.off('keyup', onKeyUp);\r\n                angular.element($window).off('mouseup touchend', onUp);\r\n\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n\r\n            var init = false;\r\n            function Init() {\r\n                if (!init) {\r\n                    addListeners();\r\n                    init = true;\r\n                }\r\n            }\r\n\r\n            scope.$watch('service', function (newValue) {\r\n                if (newValue && (newValue.length || scope.queryable)) {\r\n                    Init();\r\n                }\r\n            });\r\n            \r\n            scope.$watchCollection('model', function (newValue) {\r\n                // console.log('controlAutocomplete.$watchCollection.model', newValue);\r\n                if (newValue) {\r\n                    if (scope.flatten && label === key) {\r\n                        scope.phrase = newValue;\r\n                        input.val(scope.phrase);    \r\n                    } else if (newValue[label]) {\r\n                        scope.phrase = newValue[label];\r\n                        input.val(scope.phrase); \r\n                    }\r\n                }\r\n            });\r\n\r\n        },\r\n    };\r\n}]);\r\n\r\napp.directive('scrollable', ['$parse', '$compile', '$window', '$timeout', function ($parse, $compile, $window, $timeout) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            window.ondragstart = function() { return false; }; \r\n            \r\n            // CONSTS;\r\n            var padding = 150;\r\n            \r\n            // FLAGS;            \r\n            var dragging, wheeling, busy;\r\n            \r\n            // MOUSE;\r\n            var down, move, prev, up;\r\n            \r\n            // COORDS;\r\n            var sy = 0, ey = 0, cy = 0, ltop = 0, lbottom = 0, speed = 0, ix = 45, iy = 0;\r\n            \r\n            // ANIMATION KEY;\r\n            var aKey;\r\n            \r\n            var onTop, onBottom, showIndicatorFor;\r\n            if (attributes.onTop !== undefined) {\r\n                onTop = $parse(attributes.onTop, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            if (attributes.onBottom !== undefined) {\r\n                onBottom = $parse(attributes.onBottom, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            if (attributes.showIndicatorFor !== undefined) {\r\n                showIndicatorFor = scope.$eval(attributes.showIndicatorFor); // $parse(attributes.showIndicatorFor, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            }\r\n            // console.log('showIndicatorFor', showIndicatorFor);\r\n            \r\n            // ELEMENTS & STYLESHEETS;\r\n            element.attr('unselectable', 'on').addClass('unselectable');\r\n            var inner = element.find('div');\r\n            var innerStyle = new Utils.Style();\r\n            var indicator = null, indicatorStyle;\r\n            if (showIndicatorFor) {\r\n                indicator = angular.element('<div class=\"indicator\"></div>');\r\n                indicatorStyle = new Utils.Style();\r\n                element.append(indicator);   \r\n                $compile(indicator.contents())(scope);\r\n                indicatorStyle.transform('translate3d('+ix.toFixed(2)+'px,'+iy.toFixed(2)+'px,0)');\r\n                indicatorStyle.set(indicator[0]);\r\n            }            \r\n            \r\n            function doTop() {\r\n                if (busy) {\r\n                    return;\r\n                }\r\n                if (!onTop) { \r\n                    return; \r\n                }                \r\n                busy = true;\r\n                scope.$apply(onTop).then().finally(function(){\r\n                    sy = ey = 0;\r\n                    setTimeout(function() {\r\n                        undrag ();\r\n                        busy = false;\r\n                    }, 500);\r\n                });\r\n            }\r\n            \r\n            function doBottom() {\r\n                if (busy) {\r\n                    return;\r\n                }\r\n                if (!onBottom) { \r\n                    return; \r\n                }                \r\n                busy = true;\r\n                scope.$apply(onBottom).then().finally(function(){\r\n                    var lbottom2 = element[0].offsetHeight - inner[0].offsetHeight;\r\n                    if (lbottom2 > lbottom) {                     \r\n                        sy = ey = lbottom;   \r\n                    } else {\r\n                        sy = ey = lbottom + padding;\r\n                    }\r\n                    setTimeout(function() {\r\n                        undrag ();\r\n                        busy = false;\r\n                    }, 500);\r\n                });\r\n            }\r\n            \r\n            function undrag() {\r\n                // console.log('undrag');\r\n                dragging = false;\r\n                wheeling = false;\r\n                move = null;\r\n                down = null;\r\n                removeDragListeners();       \r\n            }\r\n            \r\n            function bounce() {\r\n                ltop += padding;\r\n                lbottom -= padding;\r\n                if (ey > ltop) {\r\n                    doTop();\r\n                } else if (ey < lbottom) {\r\n                    doBottom();\r\n                }\r\n            }\r\n            \r\n            function redraw(time) {\r\n                // if (!busy) {\r\n                    ltop = 0;\r\n                    lbottom = element[0].offsetHeight - inner[0].offsetHeight;                    \r\n                    if (dragging) {\r\n                        ey = sy + move.y - down.y;\r\n                        bounce();                        \r\n                    } else if (speed) {\r\n                        ey += speed;\r\n                        speed *= .75;\r\n                        if (wheeling) {\r\n                            bounce();\r\n                        }\r\n                        if (Math.abs(speed) < 0.05) {\r\n                            speed = 0;                                         \r\n                            ey = sy = cy;\r\n                            wheeling = false;\r\n                            pause();\r\n                        }                                                \r\n                    }\r\n                // }\r\n                ey = Math.min(ltop, ey);\r\n                ey = Math.max(lbottom, ey);\r\n                cy += (ey - cy) / 4;\r\n                innerStyle.transform('translate3d(0,'+cy.toFixed(2)+'px,0)');\r\n                innerStyle.set(inner[0]);\r\n                if (showIndicatorFor) {\r\n                    if (dragging || wheeling || speed) {\r\n                        var percent = cy / ( element[0].offsetHeight - inner[0].offsetHeight );\r\n                        percent = Math.max(0, Math.min(1, percent));\r\n                        iy = (element[0].offsetHeight - indicator[0].offsetHeight) * (percent);                        \r\n                        ix += (0-ix) / 4;                        \r\n                        // var count = Math.round(inner[0].offsetHeight / 315);\r\n                        var i = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n                        indicator.html(i + '/' + showIndicatorFor.count);\r\n                        // indicator.html((percent * 100).toFixed(2).toString());\r\n                    } else {\r\n                        ix += (45-ix) / 4;\r\n                    }\r\n                    indicatorStyle.transform('translate3d('+ix.toFixed(2)+'px,'+iy.toFixed(2)+'px,0)');\r\n                    indicatorStyle.set(indicator[0]);\r\n                }\r\n            }\r\n\r\n            function play() {\r\n                function loop(time) {\r\n                    redraw(time);\r\n                    aKey = window.requestAnimationFrame(loop, element);\r\n                }\r\n                if (!aKey) {\r\n                    loop();\r\n                }\r\n            }\r\n\r\n            function pause() {\r\n                if (aKey) {\r\n                    window.cancelAnimationFrame(aKey);\r\n                    aKey = null;\r\n                    // console.log('Animation.paused');\r\n                }\r\n            }\r\n            \r\n            function onDown(e) {\r\n                if (!busy) {\r\n                    sy = ey = cy;\r\n                    speed = 0;\r\n                    down = Utils.getTouch(e);\r\n                    wheeling = false;\r\n                    // console.log(down);\r\n                    addDragListeners();\r\n                    play();\r\n                }\r\n            }\r\n            \r\n            function onMove(e) {\r\n                prev = move;\r\n                move = Utils.getTouch(e);\r\n                dragging = true;\r\n                // console.log(move);\r\n            }\r\n            \r\n            function onUp(e) {\r\n                if (move && prev) {\r\n                    speed += (move.y - prev.y) * 4;\r\n                }\r\n                sy = ey = cy;\r\n                dragging = false;\r\n                move = null;\r\n                down = null;\r\n                prev = null;\r\n                up = Utils.getTouch(e);\r\n                // console.log(up);\r\n                removeDragListeners();                \r\n            }\r\n            \r\n            function _onWheel(e) {\r\n                if (!busy) {          \r\n                    if (!e) e = event;\r\n                    var dir = (((e.deltaY <0 || e.wheelDelta>0) || e.deltaY < 0) ? 1 : -1)                \r\n                    /*\r\n                    var evt = window.event || e;\r\n                    var delta = evt.detail ? evt.detail * -120 : evt.wheelDelta\r\n                    speed += delta;\r\n                    */\r\n                    speed += dir * 5;\r\n                    wheeling = true;\r\n                    play();\r\n                }\r\n            }\r\n            \r\n            var onWheel = Utils.throttle(_onWheel, 25);\r\n            \r\n            function addListeners() {\r\n                element.on('touchstart mousedown', onDown);\r\n                element.on('wheel', onWheel);\r\n                // element.addEventListener('DOMMouseScroll',handleScroll,false); // for Firefox\r\n                // element.addEventListener('mousewheel',    handleScroll,false); // for everyone else\r\n            };\r\n            function removeListeners() {\r\n                element.off('touchstart mousedown', onDown);\r\n                element.off('wheel', onWheel);\r\n            };\r\n            function addDragListeners() {\r\n                angular.element($window).on('touchmove mousemove', onMove);\r\n                angular.element($window).on('touchend mouseup', onUp);\r\n            };\r\n            function removeDragListeners() {\r\n                angular.element($window).off('touchmove mousemove', onMove);\r\n                angular.element($window).off('touchend mouseup', onUp);\r\n            };\r\n            scope.$on('$destroy', function () {\r\n                removeListeners();\r\n            });\r\n\r\n            addListeners();\r\n\r\n        },\r\n    };\r\n}]);\r\n\r\napp.directive('ngImg', ['$parse', '$timeout', function ($parse, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {            \r\n            /**\r\n            * documentMode is an IE-only property\r\n            * http://msdn.microsoft.com/en-us/library/ie/cc196988(v=vs.85).aspx\r\n            */\r\n            // var msie = document.documentMode;\r\n            // on IE, if \"ng:src\" directive declaration is used and \"src\" attribute doesn't exist\r\n            // then calling element.setAttribute('src', 'foo') doesn't do anything, so we need\r\n            // to set the property as well to achieve the desired effect.\r\n            // we use attr[attrName] value since $set can sanitize the url.\r\n            // if (msie) element.prop('src', attributes['src']);          \r\n            var src = $parse(attributes.ngImg, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n            var image = new Image();\r\n            image.onload = function() {\r\n                attributes.$set('src', this.src);\r\n                setTimeout(function() {                  \r\n                    element.addClass('loaded');  \r\n                }, 10);                \r\n            }  \r\n            image.load = function(src) {\r\n                element.removeClass('loaded');\r\n                this.src = src;\r\n            }\r\n            scope.$watch(src, function (newValue) {\r\n                // console.log('ngImg', newValue);\r\n                if (!newValue) {\r\n                    attributes.$set('src', null);\r\n                } else {                    \r\n                    image.load(newValue);\r\n                }                \r\n            });\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('ngImgWorker', ['$parse', 'WebWorker', function ($parse, WebWorker) {\r\n    \r\n    /*\r\n    var load;\r\n    if (WebWorker.isSupported) {\r\n        var worker = new WebWorker('/js/workers/loader.js');        \r\n        load = function(src, callback) {\r\n            worker.post({url: src}).then(function(data) {\r\n                callback(data.url);\r\n            }, function(error) {\r\n                callback(null);\r\n            });            \r\n        };\r\n    } else {\r\n        load = function(src, callback) {\r\n            // console.log('ngImgWorker', src);\r\n            var image = new Image();\r\n            image.onload = function() {\r\n                callback(src);\r\n            };\r\n            image.src = src;\r\n        };\r\n    }\r\n    */\r\n    \r\n    var worker = new WebWorker('/js/workers/loader.js');        \r\n    \r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attributes, model) {\r\n            function doWork(src) {\r\n                element.removeClass('loaded');\r\n                function onImageLoaded(src) {\r\n                    // console.log('ngImgWorker.onLoad', src);\r\n                    attributes.$set('src', src);\r\n                    setTimeout(function () {\r\n                        element.addClass('loaded');\r\n                    }, 100);\r\n                }\r\n                worker.post({url: src}).then(function(data) {\r\n                    onImageLoaded(data.url);\r\n                }, function(error) {\r\n                    onImageLoaded(null);\r\n                });   \r\n                /*\r\n                load(src, function (success) {\r\n                    // console.log('ngImgWorker.onLoad', src);\r\n                    attributes.$set('src', src);\r\n                    setTimeout(function () {\r\n                        element.addClass('loaded');\r\n                    }, 100);\r\n                });\r\n                */\r\n            }            \r\n            var src = scope.$eval(attributes.ngImgWorker);\r\n            if (!src) {\r\n                attributes.$set('src', null);\r\n            } else {\r\n                doWork(src);\r\n            }          \r\n        }\r\n    };\r\n    \r\n}]);\r\n\n/*global angular,FB */\r\n\r\napp.value('UserRoles', [{\r\n    name: 'Guest', id: 1\r\n}, {\r\n    name: 'User', id: 2\r\n}, {\r\n    name: 'Supervisor', id: 3\r\n}, {\r\n    name: 'Admin', id: 4\r\n}]);\r\n\r\napp.value('UserRolesEnum', {\r\n    'Guest': 1,\r\n    'User': 2,\r\n    'Supervisor': 3,\r\n    'Admin': 4,\r\n});\r\n\r\napp.factory('User', ['UserRolesEnum', function (UserRolesEnum) {\r\n    function User(data) {\r\n        // Extend instance with data\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    User.prototype = {\r\n        // If user instance is in role Administrator\r\n        isAdmin: function () {\r\n            return this.role === UserRolesEnum.Admin;\r\n        },\r\n        // If user parameters equals user instance\r\n        isUser: function (user) {\r\n            return this.email === user.email;\r\n        },\r\n        picture: function (size) {\r\n          size = size || 'sm';\r\n          var w;\r\n          switch(size) {\r\n              case 'sm':\r\n                w = 50;\r\n              break;\r\n              case 'md':\r\n                w = 300;\r\n              break;\r\n              default:              \r\n          }\r\n          return this.facebookId ? 'https://graph.facebook.com/'+ this.facebookId +'/picture?width=' + w + '&height=' + w + '&type=square' : '/img/avatar-default.png';             \r\n            // return this.facebookPicture ? this.facebookPicture : '/img/avatar-default.png';     \r\n        },\r\n        backgroundPicture: function(size) {\r\n            return 'background-image: url(' + this.picture(size) + ');';   \r\n        },\r\n    };\r\n    return User;\r\n}]);\r\n\r\napp.factory('Post', ['$q', '$http', '$timeout', 'APP', 'User', 'Dish', 'Upload', function($q, $http, $timeout, APP, User, Dish, Upload) {\r\n\r\n\tfunction Post(data) {\r\n        data ? angular.extend(this, data) : null;\r\n        this.user = new User(this.user);\r\n        this.dish = new Dish(this.dish);\r\n    }\r\n    Post.prototype = {\r\n\t\tupload: function(file) {\r\n            console.log('Post.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function (response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function (response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function (event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Post;\r\n\r\n}]);\r\n\r\napp.factory('Dish', ['$q', '$http', '$timeout', 'APP', 'User', 'Upload', function($q, $http, $timeout, APP, User, Upload) {\r\n\r\n\tfunction Dish(data) {\r\n        this.extend(data);\r\n    }\r\n    Dish.prototype = {\r\n        extend: function(data) {\r\n            data ? angular.extend(this, data) : null;\r\n            this.user = new User(this.user);\r\n            if (this.votes) {\r\n                angular.forEach(this.votes, function(vote) {\r\n                    vote.user = new User(vote.user);   \r\n                });\r\n            }\r\n        },\r\n\t\tlike: function(like) {\r\n            var self = this;\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/vote', { dishId: this.id, like: like }).then(function success(response) {\r\n                self.extend(response.data);\r\n                deferred.resolve(response);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n\t\t},\r\n\t\tupload: function(file) {\r\n            console.log('Dish.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function success(response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function error(response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function progress(event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Dish;\r\n\r\n}]);\r\n\n/*global angular,FB */\r\n\r\napp.factory('FacebookService', ['$q', 'APP', function ($q, APP) {\r\n\r\n    function FacebookService() {\r\n\r\n    }\r\n\r\n    function onFacebookStatus(response, deferred) {\r\n        FacebookService.authResponse = null;\r\n        if (response.status === 'connected') {\r\n            FacebookService.authResponse = response.authResponse;\r\n            deferred.resolve(response);\r\n        } else if (response.status === 'not_authorized') {\r\n            deferred.reject(response);\r\n        } else {\r\n            deferred.reject(response);\r\n        }\r\n    }\r\n\r\n    FacebookService.FB = function () {\r\n        var deferred = $q.defer();\r\n        if (window['FB'] !== undefined) {\r\n            deferred.resolve(window['FB']);\r\n        } else {\r\n            FacebookService.init().then(function (success) {\r\n                deferred.resolve(window['FB']);\r\n            }, function (error) {\r\n                deferred.reject(error);\r\n            })\r\n        }\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.getFacebookMe = function () {\r\n        var deferred = $q.defer();\r\n        FacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me', { fields: 'id,name,first_name,last_name,email,gender,picture,cover,link' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.getPictureMe = function () {\r\n        var deferred = $q.defer();\r\n        FacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me/picture', { width: 300, height: 300, type: 'square' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.login = function () {\r\n        var deferred = $q.defer();\r\n        var isMobile = false;\r\n        try {\r\n            isMobile = window.navigator.standalone; // (window.location.href == top.location.href && window.location.href.indexOf(\"/mobile/\") !== -1);\r\n        } catch (e) { }\r\n        if (!isMobile) {\r\n            FacebookService.FB().then(function (facebook) {\r\n                facebook.login(function (response) {\r\n                    onFacebookStatus(response, deferred);\r\n                }, {\r\n                        scope: 'public_profile,email' // publish_stream,\r\n                    });\r\n            });\r\n        } else {\r\n            var permissionUrl = \"https://m.facebook.com/dialog/oauth?client_id=\" + APP.FACEBOOK_APP_ID + \"&response_type=code&redirect_uri=\" + APP.CLIENT + \"&scope=\" + 'public_profile,email';\r\n            window.location.href = permissionUrl;\r\n            return;\r\n        }\r\n        /*        \r\n        FacebookService.FB().then(function(facebook) {         \r\n            facebook.login(function(response) {    \r\n                onFacebookStatus(response, deferred);\r\n            }, {\r\n                scope: 'public_profile,email' // publish_stream, \r\n                , redirect_uri: APP.CLIENT \r\n            });\r\n        });\r\n        */\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.logout = function () {\r\n        var deferred = $q.defer();\r\n        FacebookService.FB().then(function (facebook) {\r\n            facebook.logout(function (response) {\r\n                deferred.resolve(response);\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.init = function () {\r\n        var deferred = $q.defer();\r\n        window.fbAsyncInit = function () {\r\n            FB.init({\r\n                appId: APP.FACEBOOK_APP_ID,\r\n                status: true,\r\n                cookie: true,\r\n                xfbml: true,\r\n                version: 'v2.5'\r\n            });\r\n            FB.getLoginStatus(function (response) {\r\n                onFacebookStatus(response, deferred);\r\n            });\r\n        };\r\n\r\n        try {\r\n            (function (d, s, id) {\r\n                var js, fjs = d.getElementsByTagName(s)[0];\r\n                if (d.getElementById(id)) { return; }\r\n                js = d.createElement(s); js.id = id;\r\n                js.src = \"//connect.facebook.net/en_US/sdk.js\";\r\n                fjs.parentNode.insertBefore(js, fjs);\r\n            } (document, 'script', 'facebook-jssdk'));\r\n        } catch (e) {\r\n            deferred.reject(e);\r\n        }\r\n        return deferred.promise;\r\n    }\r\n\r\n    return FacebookService;\r\n\r\n}]);\r\n\r\n/** USERS SERVICE **/\r\napp.factory('Users', ['$q', '$http', '$httpAsync', '$location', '$timeout', 'APP', 'LocalStorage', 'User', function ($q, $http, $httpAsync, $location, $timeout, APP, LocalStorage, User) {\r\n\r\n    // PRIVATE VARIABLE FOR CURRENT USER\r\n    var _currentUser = null;\r\n\r\n    function Users() {\r\n    }\r\n\r\n    Users.prototype = {\r\n    };\r\n\r\n    // STATIC CLASS METHODS\r\n    Users.currentUser = function () {\r\n        return _currentUser;\r\n    };\r\n\r\n    Users.getCurrentUser = function () {\r\n        var deferred = $q.defer();\r\n        if (_currentUser) {\r\n            deferred.resolve(_currentUser);\r\n        } else {\r\n            $http.get(APP.API + '/api/users/current/').then(function success(response) {\r\n                if (response && response.data) {\r\n                    _currentUser = new User(response.data);\r\n                    deferred.resolve(_currentUser);\r\n                } else {\r\n                    deferred.resolve(null); // deferred.reject(null);\r\n                }\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n        }\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isLogged = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            user && user.isAuthenticated ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isAdmin = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            user && user.isAuthenticated && user.isAdmin ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isLoggedOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n    \r\n    Users.isAdminOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated && user.isAdmin) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    },\r\n\r\n    /** LOGIN METHODS **/\r\n    Users.signup = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signup/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signin = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signin/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signInWithFacebook = function (auth) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signinwithfacebook/', auth).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signout = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/signout/').then(function success(response) {\r\n            _currentUser = null;\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.detail = function (userRoute) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/route/' + userRoute).then(function success(response) {\r\n            deferred.resolve(new User(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Users;\r\n}]);\r\n\r\napp.factory('Categories', ['$http', '$q', 'APP', function ($http, $q, APP) {\r\n\r\n    function Categories() {\r\n    }\r\n\r\n    Categories.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/').then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Categories.detail = function (categoryId) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/' + categoryId).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Categories;\r\n}]);\r\n\r\napp.factory('DishesTest', ['APP', 'Dish', function (APP, Dish) {\r\n\r\n    var uniqueId = 100;\r\n\r\n    function getRandomItems() {\r\n        var items = [];\r\n        while (items.length < 10) {\r\n            items.push({\r\n                id: uniqueId,\r\n                name: 'dish ' + uniqueId,\r\n                price: 3.20,\r\n                yes: Math.floor(Math.random() * 999),\r\n                no: Math.floor(Math.random() * 999),\r\n                pictures: [{\r\n                    route: 'http://lorempixel.com/750/375/food/' + (1 + uniqueId % 10), // 'http://placehold.it/750x375',\r\n                }],\r\n                user: {\r\n                    userName: 'User',\r\n                }\r\n            });\r\n            uniqueId++;\r\n        }\r\n        return items;\r\n    }\r\n\r\n    function TestSource() {\r\n    }\r\n    TestSource.uri = {\r\n        paging: false,\r\n    };\r\n    TestSource.resolve = function (rows) {\r\n        var items = getRandomItems();\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n\r\n    return TestSource;\r\n}]);\r\n\r\napp.factory('Posts', ['$http', '$q', 'APP', 'Post', function ($http, $q, APP, Post) {\r\n\r\n    function Posts() {\r\n    }\r\n    Posts.uri = {\r\n        paging: APP.API + '/api/stream/paged',\r\n    };\r\n    Posts.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Post(item));\r\n        }, rows);\r\n    };\r\n\r\n    Posts.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/post/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Posts;\r\n}]);\r\n\r\napp.factory('Dishes', ['$http', '$q', 'APP', 'Dish', function ($http, $q, APP, Dish) {\r\n\r\n    function Dishes() {\r\n    }\r\n    Dishes.uri = {\r\n        paging: APP.API + '/api/dishes/paged',\r\n    };\r\n    Dishes.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n\r\n    Dishes.detail = function (id) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/' + id).then(function success(response) {\r\n            deferred.resolve(new Dish(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Dishes.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/dishes/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Dishes.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/').then(function success(response) {\r\n            var rows = [];\r\n            angular.forEach(response.data, function (item) {\r\n                this.push(new Dish(item));\r\n            }, rows);\r\n            deferred.resolve(rows);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Dishes;\r\n}]);\r\n\r\napp.factory('DishesAutocomplete', ['$q', '$http', '$timeout', 'APP', function ($q, $http, $timeout, APP) {\r\n\r\n    var MAX_ITEMS = 5;\r\n\r\n    function DishesAutocomplete() {\r\n    }\r\n\r\n    DishesAutocomplete.prototype = {\r\n        setPhrase: function (phrase) {\r\n            // console.log('DishesAutocomplete.setPhrase', phrase);\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/autocomplete', { phrase: phrase }).then(function success(response) {\r\n                var data = {\r\n                    items: [],\r\n                    count: response.data.length,\r\n                };\r\n                angular.forEach(response.data, function (v, i) {\r\n                    if (i < MAX_ITEMS) {\r\n                        var value = {\r\n                            id: v.id,\r\n                            name: v.name,\r\n                        };\r\n                        var offset = v.name.toLowerCase().indexOf(phrase.toLowerCase());\r\n                        var length = phrase.length;\r\n                        value.NameA = value.name.substr(0, offset);\r\n                        value.NameB = value.name.substr(offset, length);\r\n                        value.NameC = value.name.substr(offset + length, value.name.length - (offset + length));\r\n                        data.items.push(value);\r\n                    }\r\n                });\r\n                deferred.resolve(data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n        setItem: function (item) {\r\n            var deferred = $q.defer();\r\n            $http.get(APP.API + '/api/dishes/' + item.id).then(function success(response) {\r\n                console.log('autoComplete.setItem', response.data);\r\n                deferred.resolve(response.data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n    };\r\n\r\n    return DishesAutocomplete;\r\n\r\n}]);\r\n\r\napp.factory('DataFilter', [function () {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getSearchParams: function (search) {\r\n            var a = [];\r\n            if (search) {\r\n                for (var p in search) {\r\n                    a.push({ name: p, value: search[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source, infinite) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                if (p === 'dateFrom' ||\r\n                    p === 'dateTo' ||\r\n                    p === 'status') {\r\n                    value = this[p];\r\n                    if (value !== undefined) {\r\n                        post[p] = value;\r\n                    }\r\n                } else if (p === 'search') {\r\n                    post[p] = JSON.stringify(this.getSearchParams(this[p]), null, '');\r\n                }\r\n            }\r\n            post.page = source.page;\r\n            post.size = source.size;\r\n            post.infinite = infinite;\r\n            return post;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$httpAsync', '$timeout', '$rootScope', 'DataFilter', function ($q, $http, $httpAsync, $timeout, $rootScope, DataFilter) {\r\n\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n\r\n    function DataSource(data) {\r\n        this.busy = false;\r\n        this.error = false;\r\n        this.size = 10;\r\n        this.maxPages = 10;\r\n        this.rows = [];\r\n        this.filters = {};\r\n        this.service = {\r\n            url: '/api/items/paging',\r\n            resolve: function (items, rows) {\r\n                angular.forEach(items, function (item) {\r\n                    this.push(item);\r\n                }, rows);\r\n            },\r\n        };\r\n        data ? angular.extend(this, data) : null;\r\n        this.filters = new DataFilter(this.filters);\r\n        // FAKE SERVICE FOR TEST !!!\r\n        if (this.service.uri.paging === false) {\r\n            this.get = function (deferred, infinite) {\r\n                this.busy = true;\r\n                this.error = false;\r\n                $timeout(function () {\r\n                    infinite ? null : this.rows.length = 0;\r\n                    this.service.resolve(this.rows);\r\n                    this.page = 1;\r\n                    this.pages = 2;\r\n                    this.count = this.rows.length;\r\n                    this.pagination = this.getPages();\r\n                    this.busy = false;\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    deferred.resolve(this.rows);    \r\n                    // console.log('DataSource.get');                    \r\n                }.bind(this), 1000);\r\n            };\r\n        }\r\n        this.flush();\r\n    }\r\n    DataSource.prototype = {\r\n        flush: function () {\r\n            this.pages = PAGES_MAX;\r\n            this.page = 1;\r\n            this.count = 0;\r\n            this.opened = null;\r\n        },\r\n        resolve: function (response) {\r\n            var responseHeader = response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            // console.log('response', response, 'responseHeader', responseHeader, 'responseView', responseView);\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.pages = responseView.pages;\r\n                this.count = responseView.count;\r\n            } else {\r\n                this.page = 0;\r\n                this.size = responseView.size;\r\n                this.pages = 0;\r\n                this.count = 0;\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        get: function (deferred, infinite) {\r\n            this.busy = true;\r\n            this.error = false;\r\n            $httpAsync.get(this.service.uri.paging, { params: this.filters.getParams(this) }).then(function success(response) {\r\n                this.resolve(response);\r\n                infinite ? null : this.rows.length = 0;\r\n                this.service.resolve(response.data, this.rows);\r\n                $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                deferred.resolve(this.rows);\r\n            }.bind(this), function error(response) {\r\n                console.log('error.response', response);\r\n                this.error = true;\r\n                deferred.reject(response);\r\n            }.bind(this))\r\n                .finally(function () {\r\n                    // console.log('DataSource.get');\r\n                    $timeout(function () {\r\n                        this.busy = false;\r\n                    }.bind(this), 1000);\r\n                }.bind(this));\r\n        },\r\n        paging: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.paging');\r\n                this.opened = null;\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        refresh: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.refresh');\r\n                this.flush();\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        more: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page + 1 > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.more');\r\n                this.page++;\r\n                this.get(deferred, true);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            this.page = 1;\r\n            this.pages = PAGES_MAX;\r\n            this.paging();\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.count > 0 && this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        }\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\n/** LOCALSTORAGE SERVICE **/\r\napp.factory('LocalStorage', ['$http', '$q', '$window', function ($http, $q, $window) {\r\n    function LocalStorage() {\r\n    }\r\n\r\n    function isLocalStorageSupported() {\r\n        try {\r\n            return 'localStorage' in window && window['localStorage'] !== null;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (!LocalStorage.isSupported) {\r\n        console.log('LocalStorage.unsupported');\r\n    }\r\n\r\n    /** STATIC CLASS METHODS **/\r\n    LocalStorage.set = function (key, data) {\r\n        if (!this.isSupported) {\r\n            return;\r\n        }\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(data, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            $window.localStorage.setItem(key, json);;\r\n        } catch (e) {\r\n            console.log('LocalStorage.set.error serializing', key, data, e);\r\n        }\r\n    };\r\n\r\n    LocalStorage.get = function (key) {\r\n        if (!this.isSupported) {\r\n            return;\r\n        }\r\n        var data = null;\r\n        if ($window.localStorage[key] !== undefined) {\r\n            try {\r\n                data = JSON.parse($window.localStorage[key]);\r\n            } catch (e) {\r\n                console.log('LocalStorage.get.error parsing', key, e);\r\n            }\r\n        }\r\n        return data;\r\n    };\r\n\r\n    // Register on storage event\r\n    LocalStorage.onStorage = function () {\r\n        console.log('LocalStorage.onStorage', arguments);\r\n    };\r\n    angular.element($window).on('storage', LocalStorage.onStorage);\r\n\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('WebWorker', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        window.Worker = function () {\r\n            function Worker(src) {\r\n                var self = this;\r\n                $http.get(src, { transformResponse: function (d, h) { return d } }).then(function success(response) {\r\n                    try {\r\n                        eval('self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\\n ' + response.data + ' };');\r\n                        self.object = new self.o();\r\n                        self.object.postMessage = function (e) {\r\n                            self.onmessage({data:e});\r\n                        }                            \r\n                    } catch(e) {\r\n                        console.log(\"Worker error \", e);    \r\n                    }\r\n                }, function error(response) {\r\n                    console.log(\"Worker not found\");\r\n                });\r\n            }\r\n            Worker.prototype = {\r\n                onmessage: function (e) {\r\n                    console.log('Worker not implemented');\r\n                },\r\n                postMessage: function (e) {\r\n                    this.object.onmessage({ data: e });\r\n                }\r\n            }\r\n            return Worker;\r\n        } ();\r\n    }\r\n    function WebWorker(src) {\r\n        var self = this;\r\n        this.callbacks = {};\r\n        this.id = 0;\r\n        this.worker = new Worker(src);\r\n        this.worker.onmessage = function (e) {\r\n            self.onmessage(e);\r\n        };\r\n    }\r\n    WebWorker.prototype = {\r\n        parse: function (e) {\r\n            return JSON.parse(e.data);\r\n        },\r\n        stringify: function (data) {\r\n            return JSON.stringify(data);\r\n        },\r\n        onmessage: function (e) {\r\n            var data = this.parse(e);\r\n            var deferred = this.callbacks[data.id];\r\n            if (data.status !== -1) {\r\n                deferred.resolve(data);\r\n            } else {\r\n                deferred.reject(data);\r\n            }\r\n            delete this.callbacks[data.id];\r\n        },\r\n        post: function (data) {\r\n            var deferred = $q.defer();\r\n            data.id = this.id;\r\n            this.callbacks[this.id.toString()] = deferred;\r\n            this.id++;\r\n            this.worker.postMessage(this.stringify(data));\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    WebWorker.isSupported = isWebWorkerSupported;\r\n    return WebWorker;\r\n}]);\r\n\r\napp.factory('$httpAsync', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        return $http;\r\n    }\r\n    var worker = new Worker('/js/workers/http.js');\r\n    var callbacks = {};\r\n    var id = 0;\r\n    var lowercase = function (string) { return isString(string) ? string.toLowerCase() : string; };\r\n    var trim = function (value) {\r\n        return isString(value) ? value.trim() : value;\r\n    };    \r\n    function $httpAsync(options) {\r\n        var deferred = $q.defer();\r\n        var wrap = getDefaults(options);\r\n        wrap.id = id.toString(); \r\n        console.log('wrap', wrap);\r\n        /*\r\n        var xsrfValue = urlIsSameOrigin(config.url)\r\n            ? $$cookieReader()[config.xsrfCookieName || defaults.xsrfCookieName]\r\n            : undefined;\r\n        if (xsrfValue) {\r\n          reqHeaders[(config.xsrfHeaderName || defaults.xsrfHeaderName)] = xsrfValue;\r\n        }\r\n        $httpBackend(config.method, url, reqData, done, reqHeaders, config.timeout,\r\n            config.withCredentials, config.responseType);\r\n        */\r\n        callbacks[wrap.id] = deferred;\r\n        id++;\r\n        worker.postMessage($httpAsync.stringify(wrap));        \r\n        return deferred.promise;\r\n    }\r\n    $httpAsync.get = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'GET',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.delete = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'DELETE',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.head = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'HEAD',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.post = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'POST',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.put = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PUT',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.patch = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PATCH',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.parse = function (e) {\r\n        return JSON.parse(e.data);\r\n    };\r\n    $httpAsync.stringify = function (data) {\r\n        return JSON.stringify(data);\r\n    };    \r\n    $httpAsync.isSupported = isWebWorkerSupported;\r\n    worker.onmessage = function (e) {\r\n        var wrap = $httpAsync.parse(e);\r\n        console.log('onmessage', wrap);\r\n        var deferred = callbacks[wrap.id];\r\n        var status = wrap.status >= -1 ? wrap.status : 0;\r\n        var getter = headersGetter(wrap.response.headers);\r\n        (isSuccess(status) ? deferred.resolve : deferred.reject)({\r\n            data: wrap.response.data, // !!!! JSON.parse(wrap.response.data),\r\n            headers: getter,\r\n            status: wrap.response.status,\r\n            statusText: wrap.response.statusText,\r\n            config: wrap.config,\r\n        });\r\n        delete callbacks[wrap.id];\r\n    }\r\n    return $httpAsync;    \r\n    function isSuccess(status) {\r\n        return 200 <= status && status < 300;\r\n    }\r\n    function createMap() {\r\n        return Object.create(null);\r\n    }\r\n    function isString(value) { return typeof value === 'string'; }\r\n    function parseHeaders(headers) {\r\n        var parsed = createMap(), i;\r\n        function fillInParsed(key, val) {\r\n            if (key) {\r\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\r\n            }\r\n        }\r\n        if (isString(headers)) {\r\n            var a = headers.split('\\n');\r\n            for (var j = 0; j < a.length; j++) {\r\n                var line = a[j];\r\n                i = line.indexOf(':');\r\n                fillInParsed(lowercase(trim(line.substr(0, i))), trim(line.substr(i + 1)));\r\n            }\r\n        } else if (isObject(headers)) {\r\n            for (var p in headers) {\r\n                fillInParsed(lowercase(p), trim(headers[p]));\r\n            }\r\n        }\r\n        return parsed;\r\n    }\r\n    function headersGetter(headers) {\r\n        var headersObj;\r\n        return function (name) {\r\n            if (!headersObj) headersObj = parseHeaders(headers);\r\n            if (name) {\r\n                var value = headersObj[lowercase(name)];\r\n                if (value === void 0) {\r\n                    value = null;\r\n                }\r\n                return value;\r\n            }\r\n            return headersObj;\r\n        };\r\n    }\r\n    function getDefaults(options) {\r\n        var defaults = {\r\n            method: 'GET',\r\n            withCredentials: false,\r\n            responseType: 'json',\r\n            headers: {},\r\n            config: {}\r\n        }\r\n        defaults.withCredentials = $http.defaults.withCredentials;        \r\n        angular.extend(defaults.headers, $http.defaults.headers.common);  \r\n        var method = (options.method || defaults.method).toLowerCase();\r\n        if ($http.defaults.headers[method]) {\r\n            angular.extend(defaults.headers, $http.defaults.headers[method]);\r\n        }                       \r\n        console.log('defaults', $http.defaults);\r\n        // defaults = angular.extend(defaults, $http.defaults);        \r\n        /*\r\n    method{string}:                     HTTP method (e.g. 'GET', 'POST', etc)\r\n    url:{string}:                       Absolute or relative URL of the resource that is being requested.\r\n    params:{Object.<string|Object>}:    Map of strings or objects which will be serialized with the paramSerializer and appended as GET parameters.\r\n    \r\n    data:{string|Object}:               Data to be sent as the request message data.\r\n    headers:{Object}:                   Map of strings or functions which return strings representing HTTP headers to send to the server. If the return value of a function is null, the header will not be sent. Functions accept a config object as an argument.\r\n    \r\n    xsrfHeaderName:{string}:            Name of HTTP header to populate with the XSRF token.\r\n    xsrfCookieName:{string}:            Name of cookie containing the XSRF token.\r\n    transformRequest:{function(data, headersGetter)|Array.<function(data, headersGetter)>}:         transform function or an array of such functions. The transform function takes the http request body and headers and returns its transformed (typically serialized) version. See Overriding the Default Transformations\r\n    \r\n    transformResponse:{function(data, headersGetter, status)|Array.<function(data, headersGetter, status)>}:    transform function or an array of such functions. The transform function takes the http response body, headers and status and returns its transformed (typically deserialized) version. See Overriding the Default TransformationjqLiks\r\n    \r\n    paramSerializer:{string|function(Object<string,string>):string}:        A function used to prepare the string representation of request parameters (specified as an object). If specified as string, it is interpreted as function registered with the $injector, which means you can create your own serializer by registering it as a service. The default serializer is the $httpParamSerializer; alternatively, you can use the $httpParamSerializerJQLike\r\n    \r\n    cache:{boolean|Cache}:              If true, a default $http cache will be used to cache the GET request, otherwise if a cache instance built with $cacheFactory, this cache will be used for caching.\r\n    \r\n    timeout:{number|Promise}:           timeout in milliseconds, or promise that should abort the request when resolved.\r\n    withCredentials:{boolean}:          whether to set the withCredentials flag on the XHR object. See requests with credentials for more information.\r\n    \r\n    responseType:{string}:              see XMLHttpRequest.responseType.\r\n        */\r\n        options ? options = angular.extend(defaults, options) : defaults;\r\n        return options;\r\n    }  \r\n}]);\n/*global angular,FB */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\r\n    \r\n    $scope.Users = Users;\r\n\r\n    $scope.signOut = function () {\r\n        if ($scope.logoutBusy) {\r\n            return;\r\n        }\r\n        $scope.logoutBusy = true;\r\n        Users.signout().then(function () {\r\n            /*\r\n            FacebookService.logout().then(function(success) {\r\n            }, function(error) {\r\n            }).finally(function() {\r\n                $scope.logoutBusy = false;\r\n                $location.path('/splash');\r\n            });\r\n            */\r\n            $location.path('/splash');\r\n        }).finally(function() {\r\n            $scope.logoutBusy = false;\r\n        });\r\n    };\r\n    \r\n    $scope.goStream = function () {\r\n        $location.path('/stream');\r\n    };\r\n\r\n    $scope.goPost = function () {\r\n        $location.path('/post');\r\n    };\r\n\r\n    $scope.goDish = function (dishId) {\r\n        $location.path('/dishes/' + dishId);\r\n    };\r\n        \r\n    $scope.goCategory = function (categoryId) {\r\n        $location.path('/categories/' + categoryId);\r\n    };\r\n    \r\n    $scope.goUser = function (userRoute) {\r\n        $location.path('/users/' + userRoute);\r\n    };\r\n    \r\n    $scope.goSettings = function () {\r\n        $location.path('/settings');\r\n    };\r\n    \r\n    /**\r\n    $scope.goBack = function () {\r\n        if ($scope.previousPath) {\r\n            $location.path($scope.previousPath);\r\n        }\r\n    };    \r\n    $scope.$root.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        $scope.previousPath = previous.$$route.originalPath;\r\n    });   \r\n    */\r\n    \r\n}]);\r\n\r\napp.controller('SplashCtrl', ['$scope', '$location', '$timeout', '$window', 'FacebookService', 'Users', function ($scope, $location, $timeout, $window, FacebookService, Users) {\r\n\r\n    $scope.splashBusy = true;\r\n    $scope.showFacebookLoginButton = true;\r\n    \r\n    /*            \r\n    Users.getCurrentUser().then(function(success) {\r\n        $location.path('/stream');\r\n        \r\n    }, function(error) {     \r\n        \r\n        FacebookService.init().then(function(success) {\r\n            signinOrSignup(success.authResponse);\r\n        }, function(error) {\r\n        \r\n            $timeout(function() {\r\n                $scope.showFacebookLoginButton = true;\r\n            }, 1000);\r\n                \r\n        }).finally(function() {\r\n            $timeout(function(){\r\n                $scope.splashBusy = false;  \r\n            }, 100);\r\n        });\r\n            \r\n    }).finally(function(){\r\n        $timeout(function(){\r\n            $scope.splashBusy = false;        \r\n        }, 1000);        \r\n    });\r\n    */\r\n    \r\n    function signinOrSignup(auth) {\r\n        $scope.splashBusy = true;\r\n        Users.signInWithFacebook(auth).then(function(success) {\r\n            $location.path('/stream');\r\n        }, function(error) {\r\n            $location.path('/signup');\r\n        }).finally(function() {\r\n            $scope.splashBusy = false;\r\n        });\r\n    }\r\n\r\n    $scope.onFacebookLogin = function() {\r\n        $scope.splashBusy = true;\r\n        FacebookService.login().then(function(success) {\r\n            signinOrSignup(success.authResponse);\r\n        }, function(error) {\r\n            console.log('onFacebookLogin', error);\r\n        }).finally(function() {            \r\n            $scope.splashBusy = false;\r\n        });\r\n    };\r\n    \r\n    /*\r\n    FacebookService.init().then(function(success) {\r\n        // signinOrSignup(success.authResponse);\r\n    }, function(error) {\r\n        // $scope.showFacebookLoginButton = true;\r\n    }).finally(function() {\r\n        $timeout(function(){\r\n            $scope.splashBusy = false;  \r\n        }, 100);\r\n    });\r\n    */\r\n    \r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', 'Users', 'FacebookService', function ($scope, $location, Users, FacebookService) {\r\n\r\n    $scope.model = {};\r\n\r\n    $scope.signin = function () {\r\n        $scope.signinFormError = null;\r\n        $scope.signinFormBusy = true;\r\n        Users.signin($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signinFormError = error.message;\r\n        }).finally(function () {\r\n            $scope.signinFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\r\n\r\n    FacebookService.getFacebookMe().then(function(me) {\r\n        console.log('SignupCtrl.getFacebookMe', me);\r\n        $scope.model = {\r\n            userName : me.name,\r\n            email : me.email,\r\n            firstName : me.first_name,\r\n            lastName : me.last_name,\r\n            facebookId : me.id,\r\n            facebookPicture : me.picture.data.url,\r\n            facebookToken : FacebookService.authResponse.accessToken,\r\n        };\r\n    }, function(error) {\r\n        console.log('SignupCtrl.getFacebookMe.error', error);\r\n    });\r\n\r\n    $scope.signup = function () {\r\n        console.log('SignupCtrl.signup', $scope.model);\r\n        $scope.signupFormError = null;\r\n        $scope.signupFormBusy = true;\r\n        Users.signup($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signupFormError = error.data.message;\r\n        }).finally(function () {\r\n            $scope.signupFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('StreamCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'Posts', 'Upload', function ($scope, $location, $timeout, DataSource, Posts, Upload) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n    \r\n    $scope.source = new DataSource({\r\n        service: Posts,\r\n        filters: $scope.filters\r\n    });\r\n    \r\n    $scope.source.paging();\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {       \r\n        if (!file) {\r\n            return;\r\n        } \r\n        $scope.$root.pictureBase64 = null;        \r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.$root.pictureBase64 = url;\r\n            $location.path('/post');\r\n        });\r\n    };\r\n    \r\n}]);\r\n\r\napp.controller('PostCtrl', ['$scope', '$timeout', '$location', 'Upload', 'Categories', 'Posts', 'DishesAutocomplete', function ($scope, $timeout, $location, Upload, Categories, Posts, DishesAutocomplete) {\r\n\r\n    Categories.get().then(function(categories) {\r\n        $scope.categories = categories;\r\n    })\r\n\r\n    $scope.dishesAutocomplete = new DishesAutocomplete();    \r\n\r\n    $scope.model = {\r\n        pictureBase64: $scope.$root.pictureBase64 || null,\r\n        dish: {\r\n            categories: [],            \r\n        }\r\n    };\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {        \r\n        $scope.model.pictureBase64 = null;        \r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.model.pictureBase64 = url;\r\n        });\r\n    };\r\n    \r\n    $scope.hasPicture = function () {\r\n        var has = $scope.model.pictureBase64 !== null;\r\n        $scope.pictureError = true;\r\n        $timeout(function () {\r\n            $scope.pictureError = false;\r\n        }, 1000);\r\n        return has;\r\n    };\r\n        \r\n    $scope.onDishSelected = function(item) {\r\n        console.log('onDishSelected', item);\r\n        $scope.model.dish.id = item.id;\r\n        $scope.model.dish.price = item.price;\r\n        $scope.model.dish.categories = item.categories;\r\n        $scope.model.dish.isVeganFriendly = item.isVeganFriendly;\r\n    };\r\n    \r\n    $scope.submitPost = function () {\r\n        console.log('PostCtrl.submitPost', $scope.model);\r\n        $scope.postFormBusy = true;\r\n        $scope.postFormError = null;\r\n        $timeout(function () {\r\n            Posts.add($scope.model).then(function(post) {\r\n                $scope.model.id = post.id;\r\n                $location.path('/stream');\r\n            }, function(error) {\r\n                $scope.postFormError = error.config.url + ' ' + error.status + ' ' + error.statusText;\r\n            }).finally(function(){\r\n                $scope.postFormBusy = false;\r\n            });\r\n        }, 1); \r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DishCtrl', ['$scope', '$routeParams', 'Dishes', function ($scope, $routeParams, Dishes) {\r\n\r\n    Dishes.detail($routeParams.dishId).then(function(item) {\r\n       $scope.item = item;\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('CategoryCtrl', ['$scope', '$routeParams', 'Categories', 'DataSource', 'Dishes', function ($scope, $routeParams, Categories, DataSource, Dishes) {\r\n\r\n    Categories.detail($routeParams.categoryId).then(function(category) {\r\n       $scope.category = category;\r\n       \r\n       $scope.filters = {\r\n            search: {\r\n                Category: category.name\r\n            }\r\n        };\r\n        \r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n        \r\n        $scope.source.paging();\r\n\r\n    });\r\n    \r\n}]);\r\n\r\napp.controller('UserCtrl', ['$scope', '$routeParams', 'Users', 'DataSource', 'Dishes', function ($scope, $routeParams, Users, DataSource, Dishes) {\r\n\r\n    Users.detail($routeParams.userRoute).then(function(user) {\r\n       $scope.user = user;\r\n       \r\n       $scope.filters = {\r\n            search: {\r\n                UserName: user.userName\r\n            }\r\n        };\r\n        \r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n        \r\n        $scope.source.paging();\r\n\r\n    });\r\n    \r\n}]);\r\n\r\napp.controller('SettingsCtrl', ['$scope', '$routeParams', 'Users', function ($scope, $routeParams, Users) {\r\n\r\n    $scope.user = Users.currentUser();\r\n    \r\n}]);\r\n\r\napp.controller('TestCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'DishesTest', function ($scope, $location, $timeout, DataSource, DishesTest) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n    \r\n    $scope.source = new DataSource({\r\n        service: DishesTest,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $timeout(function() {            \r\n        $scope.source.paging();\r\n    }, 1000);\r\n\r\n}]);"],"sourceRoot":"/source/"}