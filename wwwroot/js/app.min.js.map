{"version":3,"sources":["wwwroot/js/app.js"],"names":["LESSON","CONFIG","CLIENT","window","location","href","indexOf","API","FACEBOOK_APP_ID","assetTypeEnum","Unknown","Picture","IOS","navigator","userAgent","match","app","angular","module","constant","config","$httpProvider","$routeProvider","$locationProvider","defaults","withCredentials","when","title","templateUrl","controller","controllerAs","resolve","user","Users","isLoggedOrGoTo","isForward","otherwise","html5Mode","run","$rootScope","$window","APP","route","size","standalone","document","ontouchmove","event","preventDefault","oncontextmenu","stopPropagation","getPictures","model","src","pictures","i","length","media","getPicture","picture","broadcast","params","$broadcast","animation","$animate","isFirstView","currentRoute","isBackward","previousRoute","bezierOptions","type","dynamics","bezier","points","x","y","cp","duration","$on","current","previous","$$route","enter","element","done","css","translateY","opacity","scale","animate","w","offsetWidth","translateX","leave","setTimeout","$scope","$location","$q","FacebookService","signOut","logoutBusy","all","signout","logout","then","data","path","error","console","log","goStream","goPost","goDish","dishId","goCategory","categoryId","goUser","userRoute","goSettings","$timeout","signinOrSignup","auth","splashBusy","signInWithFacebook","success","getLoginStatus","authResponse","showFacebookLoginButton","onFacebookLogin","login","signin","signinFormError","signinFormBusy","message","getFacebookMe","me","userName","name","email","firstName","first_name","lastName","last_name","facebookId","id","facebookPicture","url","facebookToken","accessToken","signup","signupFormError","signupFormBusy","DataSource","Posts","Upload","filters","search","source","service","paging","onUploadFileSelected","file","newFiles","$root","pictureBase64","dataUrl","Categories","DishesAutocomplete","get","categories","dishesAutocomplete","dish","hasPicture","has","pictureError","onDishSelected","item","price","isVeganFriendly","submitPost","postFormBusy","postFormError","add","post","status","statusText","$routeParams","Dishes","detail","category","Category","UserName","currentUser","DishesTest","directive","restrict","link","scope","attributes","onTap","e","addClass","removeClass","addListeners","on","removeListeners","off","delays","undefined","split","delay","forEach","d","parseInt","push","removeClasses","join","shift","a","$parse","$compile","Utils","doTop","busy","onTop","$apply","sy","ey","undrag","doBottom","onBottom","lbottom2","offsetHeight","inner","lbottom","padding","dragging","wheeling","move","down","removeDragListeners","bounce","ltop","redraw","time","speed","Math","abs","cy","pause","min","max","innerStyle","transform","toFixed","set","showIndicatorFor","percent","iy","indicator","ix","round","rows","html","count","indicatorStyle","play","loop","aKey","requestAnimationFrame","cancelAnimationFrame","onDown","getTouch","addDragListeners","onMove","prev","onUp","up","_onWheel","dir","deltaY","wheelDelta","onWheel","ondragstart","$eval","attr","find","Style","append","contents","throttle","ngImg","image","Image","onload","$set","this","load","$watch","newValue","WebWorker","worker","doWork","onImageLoaded","ngImgWorker","replace","template","form","placeholder","formKey","formFocus","required","label","key","readonly","control","options","number","canCreate","flatten","queryable","onSelected","MAX_ITEMS","getPhrase","Clear","phrase","items","input","val","Current","active","onTyping","Enter","onSelect","Up","Down","Parse","value","index","toLowerCase","NameA","substr","NameB","NameC","Filter","c","Search","setPhrase","onKeyDown","keyCode","onKeyUp","call","getClosest","target","onBlur","Init","init","maxItems","Number","POSITIVE_INFINITY","onFocus","$parent","setItem","parsedItem","$item","$event","extend","$watchCollection","require","validateType","$parsers","unshift","$setValidity","String","toString","Guest","User","Supervisor","Admin","factory","UserRolesEnum","prototype","isAdmin","role","isUser","backgroundPicture","$http","Dish","Post","upload","self","lastIndexOf","extension","uploadData","assetType","progress","uploads","JSON","stringify","response","concat","splice","progressPercentage","loaded","total","voteCount","yes","no","rating","ratingToString","votes","vote","like","deferred","defer","reject","promise","onFacebookStatus","FB","facebook","api","fields","getPictureMe","width","height","deletePermissions","fbAsyncInit","appId","cookie","xfbml","version","s","js","fjs","getElementsByTagName","getElementById","createElement","parentNode","insertBefore","$httpAsync","LocalStorage","_currentUser","getCurrentUser","isLogged","isAuthenticated","redirect","isAdminOrGoTo","getRandomItems","uniqueId","floor","random","TestSource","uri","v","offset","DataFilter","getSearchParams","p","getParams","infinite","page","maxPages","pages","pagination","getPages","bind","flush","PAGES_MAX","opened","responseHeader","headers","responseView","parse","refresh","more","filter","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","Cookie","TIMEOUT","_set","days","date","Date","setTime","getTime","expires","toGMTString","cache","json","cookieName","ca","charAt","substring","checkCookie","elapsed","timeout","interval","isLocalStorageSupported","supported","localStorage","removeItem","isSupported","storageEvent","clearTimeout","originalEvent","Vector","make","b","sqrt","normalize","l","incidence","angle","atan2","distance","cross","difference","towards","friction","copy","t","touch","touches","changedTouches","pageX","pageY","getRelativeTouch","point","rect","getBoundingClientRect","left","top","el","selector","matchesFn","parent","some","fn","body","parentElement","func","wait","context","args","result","later","leading","getNow","apply","now","remaining","arguments","trailing","lastTime","vendors","callback","currTime","timeToCall","transformProperty","safariPropertyHack","div","style","every","prefix","props","hoverScale","currentScale","styles","cssText","transformOrigin","callbacks","Worker","onmessage","isWebWorkerSupported","transformResponse","h","eval","object","o","postMessage","wrap","getDefaults","isSuccess","createMap","Object","create","isString","parseHeaders","fillInParsed","parsed","j","line","lowercase","trim","isObject","headersGetter","headersObj","method","responseType","common","string","head","put","patch","getter"],"mappings":"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","file":"wwwroot/js/app.min.js","sourcesContent":["/*global angular,FB */\r\n\r\nvar LESSON = true;\r\nvar CONFIG = {\r\n    CLIENT: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? 'http://ulloclient.wslabs.it' : 'http://dev.ullowebapp:8081',\r\n    API: (LESSON || window.location.href.indexOf('http://ulloclient.wslabs.it') === 0) ? 'http://ulloapi.wslabs.it' : 'https://localhost:44302',\r\n    FACEBOOK_APP_ID: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? '1054303094614120' : '1062564893787940',\r\n    assetTypeEnum: {\r\n        Unknown: 0,\r\n        Picture: 1,\r\n    },\r\n    IOS: (navigator.userAgent.match(/iPad|iPhone|iPod/g) ? true : false),\r\n};\r\n\r\nvar app = angular.module('ullo', ['ngRoute', 'ngMessages', 'ngAnimate', 'relativeDate', 'ngFileUpload']);\r\n\r\napp.constant('APP', CONFIG);\r\n\r\napp.config(['$httpProvider', '$routeProvider', '$locationProvider', function ($httpProvider, $routeProvider, $locationProvider) {\r\n\r\n    $httpProvider.defaults.withCredentials = true;\r\n\r\n\t// SECURE ROUTING\r\n    $routeProvider.when('/stream', {\r\n        title: 'Stream',\r\n        templateUrl: 'templates/stream.html',\r\n        controller: 'StreamCtrl',\r\n        controllerAs: 'streamCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n\r\n    }).when('/dishes/:dishId', {\r\n        title: 'Dish',\r\n        templateUrl: 'templates/dish.html',\r\n        controller: 'DishCtrl',\r\n        controllerAs: 'dishCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/categories/:categoryId', {\r\n        title: 'Category',\r\n        templateUrl: 'templates/category.html',\r\n        controller: 'CategoryCtrl',\r\n        controllerAs: 'categoryCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/users/:userRoute', {\r\n        title: 'User',\r\n        templateUrl: 'templates/user.html',\r\n        controller: 'UserCtrl',\r\n        controllerAs: 'userCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/post', {\r\n        title: 'Add Post',\r\n        templateUrl: 'templates/post.html',\r\n        controller: 'PostCtrl',\r\n        controllerAs: 'postCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/settings', {\r\n        title: 'Settings',\r\n        templateUrl: 'templates/settings.html',\r\n        controller: 'SettingsCtrl',\r\n        controllerAs: 'settingsCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n\t// UNSECURE ROUTING\r\n    }).when('/splash', {\r\n        title: 'Splash',\r\n        templateUrl: 'templates/splash.html',\r\n        controller: 'SplashCtrl',\r\n        controllerAs: 'splashCtrl',\r\n\r\n    }).when('/signin', {\r\n        title: 'Sign In',\r\n        templateUrl: 'templates/signin.html',\r\n        controller: 'SigninCtrl',\r\n        controllerAs: 'signinCtrl',\r\n\r\n    }).when('/signup', {\r\n        title: 'Sign Up',\r\n        templateUrl: 'templates/signup.html',\r\n        controller: 'SignupCtrl',\r\n        controllerAs: 'signupCtrl',\r\n\r\n    }).when('/test', {\r\n        title: 'Test',\r\n        templateUrl: 'templates/dishes.html',\r\n        controller: 'TestCtrl',\r\n        controllerAs: 'testCtrl',\r\n\r\n    }).when('/404', {\r\n\r\n        title: 'Error 404',\r\n        templateUrl: '404.html',\r\n\r\n    });\r\n\r\n    $routeProvider.otherwise('/stream');\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(true);\r\n\r\n}]);\r\n\r\napp.run(['$rootScope', '$window', 'APP', function ($rootScope, $window, APP) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    document.ontouchmove = function (event) {\r\n        event.preventDefault();\r\n    }\r\n\r\n    window.oncontextmenu = function (event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return false;\r\n    };\r\n\r\n    function Picture(route, size) {\r\n        if (route.indexOf('http') === 0) {\r\n            return route;\r\n        } else if (size) {\r\n            return APP.API + route + '?media=' + size;\r\n        } else {\r\n            return APP.API + route;\r\n        }\r\n    }\r\n\r\n    $rootScope.getPictures = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.pictures) {\r\n            for (var i = 0; i < model.pictures.length; i++) {\r\n                var media = model.pictures[i];\r\n                if (media.route) {\r\n                    src = Picture(media.route, size);\r\n                    i = 100000;\r\n                }\r\n            }\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.getPicture = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.picture && model.picture.route) {\r\n            src = Picture(model.picture.route, size);\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.broadcast = function (event, params) {\r\n        $rootScope.$broadcast(event, params);\r\n    };\r\n\r\n}]);\r\n\n\r\napp.animation('.navigation', ['$rootScope', '$animate', function($rootScope, $animate) {\r\n    var previousRoute = null;\r\n    var currentRoute = null;\r\n    var bezierOptions = {\r\n        type: dynamics.bezier,\r\n        points: [{ x: 0, y: 0, cp: [{ x: 0.509, y: 0.007 }] }, { x: 1, y: 1, cp: [{ x: 0.566, y: 0.997 }] }],\r\n        duration: 500,\r\n    }\r\n    $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        previousRoute = previous.$$route;\r\n        currentRoute = current.$$route;\r\n    });\r\n    function isFirstView() {\r\n        return !currentRoute;\r\n    }\r\n    function isBackward() {\r\n        return previousRoute && previousRoute.isForward;\r\n    }\r\n    return {\r\n        enter: function(element, done) {\r\n            if (isFirstView()) {\r\n                // FIRST ENTERING ANIMATION\r\n                dynamics.css(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 0,\r\n                    scale: 1.2,\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 1,\r\n                    scale: 1,\r\n                }, bezierOptions);\r\n            } else if (isBackward()) {\r\n                // BACKWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: -w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions);\r\n            } else {\r\n                // FORWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions);\r\n            }\r\n            done();\r\n        },\r\n        leave: function(element, done) {\r\n            if (isBackward()) {\r\n                // BACKWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: w\r\n                }, bezierOptions);\r\n            } else {\r\n                // FORWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: -w\r\n                }, bezierOptions);\r\n            }\r\n            setTimeout(done, 1000);\r\n        }\r\n    }\r\n}]);\r\n\n/*global angular,FB */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', '$q', 'FacebookService', 'Users', function ($scope, $location, $q, FacebookService, Users) {\r\n\r\n    $scope.Users = Users;\r\n\r\n    $scope.signOut = function () {\r\n        if ($scope.logoutBusy) {\r\n            return;\r\n        }\r\n\t\t$scope.logoutBusy = true;\r\n\t\t$q.all([\r\n\t\t\tUsers.signout(),\r\n\t\t\tFacebookService.logout()\r\n\t\t]).then(function(data) {\r\n\t\t\t$location.path('/splash');\r\n\t\t}, function(error) {\r\n\t\t\tconsole.log('signOut.error', error);\r\n\t\t}).finally(function() {\r\n\t\t\t$scope.logoutBusy = false;\r\n\t\t});\r\n    };\r\n\r\n    $scope.goStream = function () {\r\n        $location.path('/stream');\r\n    };\r\n\r\n    $scope.goPost = function () {\r\n        $location.path('/post');\r\n    };\r\n\r\n    $scope.goDish = function (dishId) {\r\n        $location.path('/dishes/' + dishId);\r\n    };\r\n\r\n    $scope.goCategory = function (categoryId) {\r\n        $location.path('/categories/' + categoryId);\r\n    };\r\n\r\n    $scope.goUser = function (userRoute) {\r\n        $location.path('/users/' + userRoute);\r\n    };\r\n\r\n    $scope.goSettings = function () {\r\n        $location.path('/settings');\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SplashCtrl', ['$scope', '$location', '$timeout', '$window', 'FacebookService', 'Users', function ($scope, $location, $timeout, $window, FacebookService, Users) {\r\n\r\n    $scope.splashBusy = true;\r\n\r\n\t$timeout(function() {\r\n\t\tFacebookService.getLoginStatus().then(function(success) {\r\n\t\t\tconsole.log('SplashCtrl.getLoginStatus.success', success.authResponse);\r\n\t\t\tsigninOrSignup(success.authResponse);\r\n\r\n\t\t}, function(error) {\r\n\t\t\tconsole.log('SplashCtrl.getLoginStatus.error', error);\r\n\t\t\t$scope.showFacebookLoginButton = true;\r\n\r\n\t\t}).finally(function() {\r\n\t\t\t$scope.splashBusy = false;\r\n\t\t});\r\n\t}, 1000);\r\n\r\n    function signinOrSignup(auth) {\r\n        $scope.splashBusy = true;\r\n        Users.signInWithFacebook(auth).then(function(success) {\r\n            $location.path('/stream');\r\n        }, function(error) {\r\n            $location.path('/signup');\r\n        }).finally(function() {\r\n            $scope.splashBusy = false;\r\n        });\r\n    }\r\n\r\n    $scope.onFacebookLogin = function() {\r\n        $scope.splashBusy = true;\r\n        FacebookService.login().then(function(success) {\r\n            signinOrSignup(success.authResponse);\r\n        }, function(error) {\r\n            console.log('onFacebookLogin', error);\r\n        }).finally(function() {\r\n            $scope.splashBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', 'Users', 'FacebookService', function ($scope, $location, Users, FacebookService) {\r\n\r\n    $scope.model = {};\r\n\r\n    $scope.signin = function () {\r\n        $scope.signinFormError = null;\r\n        $scope.signinFormBusy = true;\r\n        Users.signin($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signinFormError = error.message;\r\n        }).finally(function () {\r\n            $scope.signinFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\r\n\r\n    FacebookService.getFacebookMe().then(function(me) {\r\n        console.log('SignupCtrl.getFacebookMe', me);\r\n        $scope.model = {\r\n            userName : me.name,\r\n            email : me.email,\r\n            firstName : me.first_name,\r\n            lastName : me.last_name,\r\n            facebookId : me.id,\r\n            facebookPicture : me.picture.data.url,\r\n            facebookToken : FacebookService.authResponse.accessToken,\r\n        };\r\n    }, function(error) {\r\n        console.log('SignupCtrl.getFacebookMe.error', error);\r\n    });\r\n\r\n    $scope.signup = function () {\r\n        console.log('SignupCtrl.signup', $scope.model);\r\n        $scope.signupFormError = null;\r\n        $scope.signupFormBusy = true;\r\n        Users.signup($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signupFormError = error.data.message;\r\n        }).finally(function () {\r\n            $scope.signupFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('StreamCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'Posts', 'Upload', function ($scope, $location, $timeout, DataSource, Posts, Upload) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n\r\n    $scope.source = new DataSource({\r\n        service: Posts,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $scope.source.paging();\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {\r\n        if (!file) {\r\n            return;\r\n        }\r\n        $scope.$root.pictureBase64 = null;\r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.$root.pictureBase64 = url;\r\n            $location.path('/post');\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('PostCtrl', ['$scope', '$timeout', '$location', 'Upload', 'Categories', 'Posts', 'DishesAutocomplete', function ($scope, $timeout, $location, Upload, Categories, Posts, DishesAutocomplete) {\r\n\r\n    Categories.get().then(function(categories) {\r\n        $scope.categories = categories;\r\n    })\r\n\r\n    $scope.dishesAutocomplete = new DishesAutocomplete();\r\n\r\n    $scope.model = {\r\n        pictureBase64: $scope.$root.pictureBase64 || null,\r\n        dish: {\r\n            categories: [],\r\n        }\r\n    };\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {\r\n        $scope.model.pictureBase64 = null;\r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.model.pictureBase64 = url;\r\n        });\r\n    };\r\n\r\n    $scope.hasPicture = function () {\r\n        var has = $scope.model.pictureBase64 !== null;\r\n        $scope.pictureError = true;\r\n        $timeout(function () {\r\n            $scope.pictureError = false;\r\n        }, 1000);\r\n        return has;\r\n    };\r\n\r\n    $scope.onDishSelected = function(item) {\r\n        console.log('onDishSelected', item);\r\n        $scope.model.dish.id = item.id;\r\n        $scope.model.dish.price = item.price;\r\n        $scope.model.dish.categories = item.categories;\r\n        $scope.model.dish.isVeganFriendly = item.isVeganFriendly;\r\n    };\r\n\r\n    $scope.submitPost = function () {\r\n        console.log('PostCtrl.submitPost', $scope.model);\r\n        $scope.postFormBusy = true;\r\n        $scope.postFormError = null;\r\n        $timeout(function () {\r\n            Posts.add($scope.model).then(function(post) {\r\n                $scope.model.id = post.id;\r\n                $location.path('/stream');\r\n            }, function(error) {\r\n                $scope.postFormError = error.config.url + ' ' + error.status + ' ' + error.statusText;\r\n            }).finally(function(){\r\n                $scope.postFormBusy = false;\r\n            });\r\n        }, 1);\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DishCtrl', ['$scope', '$routeParams', 'Dishes', function ($scope, $routeParams, Dishes) {\r\n\r\n    Dishes.detail($routeParams.dishId).then(function(item) {\r\n       $scope.item = item;\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('CategoryCtrl', ['$scope', '$routeParams', 'Categories', 'DataSource', 'Dishes', function ($scope, $routeParams, Categories, DataSource, Dishes) {\r\n\r\n    Categories.detail($routeParams.categoryId).then(function(category) {\r\n       $scope.category = category;\r\n\r\n       $scope.filters = {\r\n            search: {\r\n                Category: category.name\r\n            }\r\n        };\r\n\r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n\r\n        $scope.source.paging();\r\n\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('UserCtrl', ['$scope', '$routeParams', 'Users', 'DataSource', 'Dishes', function ($scope, $routeParams, Users, DataSource, Dishes) {\r\n\r\n    Users.detail($routeParams.userRoute).then(function(user) {\r\n       $scope.user = user;\r\n\r\n       $scope.filters = {\r\n            search: {\r\n                UserName: user.userName\r\n            }\r\n        };\r\n\r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n\r\n        $scope.source.paging();\r\n\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('SettingsCtrl', ['$scope', '$routeParams', 'Users', function ($scope, $routeParams, Users) {\r\n\r\n    $scope.user = Users.currentUser();\r\n\r\n}]);\r\n\r\napp.controller('TestCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'DishesTest', function ($scope, $location, $timeout, DataSource, DishesTest) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n\r\n    $scope.source = new DataSource({\r\n        service: DishesTest,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $timeout(function() {\r\n        $scope.source.paging();\r\n    }, 1000);\r\n\r\n}]);\r\n\n/*global angular,FB,dynamics*/\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name onTap\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'tapped' on element and removes it after a timeout of 500 ms\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <button type=\"button\" on-tap>Tap me!</button>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .tapped {\r\n            background: red;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('onTap', ['$timeout', function($timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         function onTap(e) {\r\n            element.addClass('tapped');\r\n            $timeout(function() {\r\n               element.removeClass('tapped');\r\n            }, 500)\r\n         };\r\n         function addListeners() {\r\n            element.on('touchstart mousedown', onTap);\r\n         };\r\n         function removeListeners() {\r\n            element.off('touchstart mousedown', onTap);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         addListeners();\r\n      }\r\n   }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name animate\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'animated' on element\r\n   *\r\n   * @param {string} [animate=fadeIn] a comma separated animate.css class names\r\n   * @param {string} [delay=1] a comma separated durations list in milliseconds\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div type=\"button\" animate=\"fadeInUp\" delay=\"1000\">\r\n            I'm an animated div.\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('animate', ['$timeout', function($timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         element.addClass('animated');\r\n         var animate = ['fadeIn'], delays = ['1'];\r\n         if (attributes.animate !== undefined) {\r\n            animate = attributes.animate.split(',');\r\n         }\r\n         if (attributes.delay !== undefined) {\r\n            delays = attributes.delay.split(',');\r\n         }\r\n         angular.forEach(delays, function(d, i) {\r\n            delays[i] = parseInt(d);\r\n         });\r\n         while (delays.length < animate.length) {\r\n            delays.push(delays[delays.length - 1] + 50);\r\n         }\r\n         var removeClasses = animate.join(' ');\r\n         if (animate[0].indexOf('In') !== -1) {\r\n            element.addClass('invisible');\r\n            removeClasses += ' invisible';\r\n         }\r\n         while (animate.length) {\r\n            var d = delays.shift();\r\n            var a = animate.shift();\r\n            $timeout(function() {\r\n               element.removeClass(removeClasses);\r\n               element.addClass(a);\r\n               if (animate.length === 0 && a.indexOf('Out') !== -1) {\r\n                  $timeout(function() {\r\n                     element.addClass('invisible');\r\n                  }, 1000);\r\n               }\r\n            }, d);\r\n         }\r\n      }\r\n   }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name scrollable\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Scrollable div 3d accellerated with touch functionality and callbacks for infinite scroll\r\n   *\r\n   * @param {promise} [on-top] optional callback function that execute when reaching top\r\n   * @param {promise} [on-bottom] optional callback function that execute when reaching bottom\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div ng-controller=\"TestCtrl\">\r\n            <section class=\"scrollable content\" scrollable on-top=\"$root.doRefresh()\">\r\n               <div class=\"inner\">\r\n                  <ul>\r\n                     <li ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]\">item <span ng-bind=\"item\"></span></li>\r\n                  </ul>\r\n               </div>\r\n            </section>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.controller('TestCtrl', ['$scope', '$q', function($scope, $q) {\r\n            $scope.doRefresh = function() {\r\n               var deferred = $q.defer();\r\n               if ($scope.busy) {\r\n                  deferred.reject();\r\n               } else {\r\n                  $scope.busy = true;\r\n                  $timeout(function() {\r\n                     $scope.busy = false;\r\n                     deferred.resolve();\r\n                  }, 500);\r\n               }\r\n               return deferred.promise;\r\n            };\r\n         }]);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .scrollable.content {\r\n            height: 200px!important;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('scrollable', ['$parse', '$compile', '$window', '$timeout', 'Utils', function($parse, $compile, $window, $timeout, Utils) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         $window.ondragstart = function() { return false; };\r\n         // CONSTS;\r\n         var padding = 150;\r\n         // FLAGS;\r\n         var dragging, wheeling, busy;\r\n         // MOUSE;\r\n         var down, move, prev, up;\r\n         // COORDS;\r\n         var sy = 0, ey = 0, cy = 0, ltop = 0, lbottom = 0, speed = 0, ix = 45, iy = 0;\r\n         // ANIMATION KEY;\r\n         var aKey;\r\n         var onTop, onBottom, showIndicatorFor;\r\n         if (attributes.onTop !== undefined) {\r\n            onTop = $parse(attributes.onTop, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         if (attributes.onBottom !== undefined) {\r\n            onBottom = $parse(attributes.onBottom, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         if (attributes.showIndicatorFor !== undefined) {\r\n            showIndicatorFor = scope.$eval(attributes.showIndicatorFor); // $parse(attributes.showIndicatorFor, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         // console.log('showIndicatorFor', showIndicatorFor);\r\n         // ELEMENTS & STYLESHEETS;\r\n         element.attr('unselectable', 'on').addClass('unselectable');\r\n         var inner = element.find('div');\r\n         var innerStyle = new Utils.Style();\r\n         var indicator = null, indicatorStyle;\r\n         if (showIndicatorFor) {\r\n            indicator = angular.element('<div class=\"indicator\"></div>');\r\n            indicatorStyle = new Utils.Style();\r\n            element.append(indicator);\r\n            $compile(indicator.contents())(scope);\r\n            indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n            indicatorStyle.set(indicator[0]);\r\n         }\r\n         function doTop() {\r\n            if (busy) {\r\n               return;\r\n            }\r\n            if (!onTop) {\r\n               return;\r\n            }\r\n            busy = true;\r\n            scope.$apply(onTop).then().finally(function() {\r\n               sy = ey = 0;\r\n               setTimeout(function() {\r\n                  undrag();\r\n                  busy = false;\r\n               }, 500);\r\n            });\r\n         }\r\n         function doBottom() {\r\n            if (busy) {\r\n               return;\r\n            }\r\n            if (!onBottom) {\r\n               return;\r\n            }\r\n            busy = true;\r\n            scope.$apply(onBottom).then().finally(function() {\r\n               var lbottom2 = element[0].offsetHeight - inner[0].offsetHeight;\r\n               if (lbottom2 > lbottom) {\r\n                  sy = ey = lbottom;\r\n               } else {\r\n                  sy = ey = lbottom + padding;\r\n               }\r\n               setTimeout(function() {\r\n                  undrag();\r\n                  busy = false;\r\n               }, 500);\r\n            });\r\n         }\r\n         function undrag() {\r\n            // console.log('undrag');\r\n            dragging = false;\r\n            wheeling = false;\r\n            move = null;\r\n            down = null;\r\n            removeDragListeners();\r\n         }\r\n         function bounce() {\r\n            ltop += padding;\r\n            lbottom -= padding;\r\n            if (ey > ltop) {\r\n               doTop();\r\n            } else if (ey < lbottom) {\r\n               doBottom();\r\n            }\r\n         }\r\n         function redraw(time) {\r\n            // if (!busy) {\r\n            ltop = 0;\r\n            lbottom = element[0].offsetHeight - inner[0].offsetHeight;\r\n            if (dragging) {\r\n               ey = sy + move.y - down.y;\r\n               bounce();\r\n            } else if (speed) {\r\n               ey += speed;\r\n               speed *= .75;\r\n               if (wheeling) {\r\n                  bounce();\r\n               }\r\n               if (Math.abs(speed) < 0.05) {\r\n                  speed = 0;\r\n                  ey = sy = cy;\r\n                  wheeling = false;\r\n                  pause();\r\n               }\r\n            }\r\n            // }\r\n            ey = Math.min(ltop, ey);\r\n            ey = Math.max(lbottom, ey);\r\n            cy += (ey - cy) / 4;\r\n            innerStyle.transform('translate3d(0,' + cy.toFixed(2) + 'px,0)');\r\n            innerStyle.set(inner[0]);\r\n            if (showIndicatorFor) {\r\n               if (dragging || wheeling || speed) {\r\n                  var percent = cy / (element[0].offsetHeight - inner[0].offsetHeight);\r\n                  percent = Math.max(0, Math.min(1, percent));\r\n                  iy = (element[0].offsetHeight - indicator[0].offsetHeight) * (percent);\r\n                  ix += (0 - ix) / 4;\r\n                  // var count = Math.round(inner[0].offsetHeight / 315);\r\n                  var i = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n                  indicator.html(i + '/' + showIndicatorFor.count);\r\n                  // indicator.html((percent * 100).toFixed(2).toString());\r\n               } else {\r\n                  ix += (45 - ix) / 4;\r\n               }\r\n               indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n               indicatorStyle.set(indicator[0]);\r\n            }\r\n         }\r\n         function play() {\r\n            function loop(time) {\r\n               redraw(time);\r\n               aKey = window.requestAnimationFrame(loop, element);\r\n            }\r\n            if (!aKey) {\r\n               loop();\r\n            }\r\n         }\r\n         function pause() {\r\n            if (aKey) {\r\n               window.cancelAnimationFrame(aKey);\r\n               aKey = null;\r\n               // console.log('Animation.paused');\r\n            }\r\n         }\r\n         function onDown(e) {\r\n            if (!busy) {\r\n               sy = ey = cy;\r\n               speed = 0;\r\n               down = Utils.getTouch(e);\r\n               wheeling = false;\r\n               // console.log(down);\r\n               addDragListeners();\r\n               play();\r\n            }\r\n         }\r\n         function onMove(e) {\r\n            prev = move;\r\n            move = Utils.getTouch(e);\r\n            dragging = true;\r\n            // console.log(move);\r\n         }\r\n         function onUp(e) {\r\n            if (move && prev) {\r\n               speed += (move.y - prev.y) * 4;\r\n            }\r\n            sy = ey = cy;\r\n            dragging = false;\r\n            move = null;\r\n            down = null;\r\n            prev = null;\r\n            up = Utils.getTouch(e);\r\n            // console.log(up);\r\n            removeDragListeners();\r\n         }\r\n         function _onWheel(e) {\r\n            if (!busy) {\r\n               if (!e) e = event;\r\n               var dir = (((e.deltaY < 0 || e.wheelDelta > 0) || e.deltaY < 0) ? 1 : -1)\r\n               /*\r\n               var evt = window.event || e;\r\n               var delta = evt.detail ? evt.detail * -120 : evt.wheelDelta\r\n               speed += delta;\r\n               */\r\n               speed += dir * 5;\r\n               wheeling = true;\r\n               play();\r\n            }\r\n         }\r\n         var onWheel = Utils.throttle(_onWheel, 25);\r\n         function addListeners() {\r\n            element.on('touchstart mousedown', onDown);\r\n            element.on('wheel', onWheel);\r\n            // element.addEventListener('DOMMouseScroll',handleScroll,false); // for Firefox\r\n            // element.addEventListener('mousewheel',    handleScroll,false); // for everyone else\r\n         };\r\n         function removeListeners() {\r\n            element.off('touchstart mousedown', onDown);\r\n            element.off('wheel', onWheel);\r\n         };\r\n         function addDragListeners() {\r\n            angular.element($window).on('touchmove mousemove', onMove);\r\n            angular.element($window).on('touchend mouseup', onUp);\r\n         };\r\n         function removeDragListeners() {\r\n            angular.element($window).off('touchmove mousemove', onMove);\r\n            angular.element($window).off('touchend mouseup', onUp);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         addListeners();\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImg\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img=\"'/img/nature-01.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('ngImg', ['$parse', '$timeout', function($parse, $timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         var src = $parse(attributes.ngImg, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         var image = new Image();\r\n         image.onload = function() {\r\n            attributes.$set('src', this.src);\r\n            setTimeout(function() {\r\n               element.addClass('loaded');\r\n            }, 10);\r\n         }\r\n         image.load = function(src) {\r\n            element.removeClass('loaded');\r\n            this.src = src;\r\n         }\r\n         scope.$watch(src, function(newValue) {\r\n            if (!newValue) {\r\n               attributes.$set('src', null);\r\n            } else {\r\n               image.load(newValue);\r\n            }\r\n         });\r\n      }\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImgWorker\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * As ngImg but using webworker. Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img-worker=\"'/img/nature-02.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n\t</example>\r\n*/\r\napp.directive('ngImgWorker', ['$parse', 'WebWorker', function($parse, WebWorker) {\r\n   var worker = new WebWorker('/js/workers/loader.min.js');\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         function doWork(src) {\r\n            element.removeClass('loaded');\r\n            function onImageLoaded(src) {\r\n               attributes.$set('src', src);\r\n               setTimeout(function() {\r\n                  element.addClass('loaded');\r\n               }, 100);\r\n            }\r\n            worker.post({ url: src }).then(function(data) {\r\n               onImageLoaded(data.url);\r\n            }, function(error) {\r\n               onImageLoaded(null);\r\n            });\r\n         }\r\n         var src = scope.$eval(attributes.ngImgWorker);\r\n         if (!src) {\r\n            attributes.$set('src', null);\r\n         } else {\r\n            doWork(src);\r\n         }\r\n      }\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name control\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Dinamic form control generator through templates with extended validation\r\n   *\r\n   * @param {string} model the target model of control\r\n   * @param {string} [control=text] the type of control, available types (text, password, email, number, checkbox, textarea, datetime-local, select, autocomplete)\r\n   * @param {string} [form=Form] the name of the form\r\n   * @param {string} [title=Untitled] the title of the control\r\n   * @param {string} [placeholder=title] the placeholder of the control\r\n   * @param {string} [source=null] datasource of select as array\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   * @param {string} [required=false] if the control is required\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"select\" title=\"category\" placeholder=\"select a category\" model=\"model.category\" source=\"[{name:'Main',id:1}, {name:'Second',id:2}]\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"number\" title=\"dish price\" placeholder=\"type the price of the dish\" model=\"model.dish.price\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"checkbox\" title=\"is vegan friendly\" placeholder=\"please check if the dish is vegan friendly\" model=\"model.dish.isVeganFriendly\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('control', [function() {\r\n   return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      template: function(element, attributes) {\r\n         var form = attributes.form || 'Form';\r\n         var title = attributes.title || 'Untitled';\r\n         var placeholder = attributes.placeholder || title;\r\n         var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('');\r\n         var formKey = form + '.' + name;\r\n         var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n         var required = '';\r\n         var label = (attributes.label ? attributes.label : 'name');\r\n         var key = (attributes.key ? attributes.key : 'id');\r\n         var model = attributes.model;\r\n         if (attributes.required) {\r\n            required = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + form + '.' + name + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> &larr; required</span>';\r\n            switch (attributes.control) {\r\n               case 'password':\r\n                  required = required + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> &larr; at least 6 chars</span>';\r\n                  break;\r\n               case 'email':\r\n                  required = required + '<span ng-message=\"email\" class=\"label-error animated flash\"> &larr; incorrect</span>';\r\n                  break;\r\n               case 'number':\r\n                  required = required + '<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>';\r\n                  break;\r\n            }\r\n            if (attributes.match !== undefined) {\r\n               required = required + '<span ng-message=\"match\" class=\"label-error animated flash\"> &larr; not matching</span>';\r\n            }\r\n            required = required + '</span>';\r\n         } else {\r\n            required = ' (optional)';\r\n         }\r\n         var template = '<div ' + (attributes.readonly ? ' class=\"readonly\" ' : '') + ' ng-class=\"{ focus: ' + formKey + '.hasFocus, success: ' + formKey + '.$valid, error: ' + formKey + '.$invalid && (form.$submitted || ' + formKey + '.$touched), empty: !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + required + '</label>';\r\n         switch (attributes.control) {\r\n            case 'checkbox':\r\n               template = '<div class=\"checkbox\">';\r\n               template += '<span class=\"checkbox-label\">' + title + required + '</span>';\r\n               template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + (attributes.required ? 'required=\"true\"' : '') + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n               template += '</div>';\r\n               break;\r\n            case 'select':\r\n               var options = attributes.number\r\n                  ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source\r\n                  : 'item.' + label + ' for item in ' + attributes.source + ' track by item.' + key;\r\n               template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + ' ' + (attributes.required ? 'required=\"true\"' : '') + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n               break;\r\n            case 'autocomplete':\r\n               var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n               var flatten = (attributes.flatten ? attributes.flatten : false);\r\n               var queryable = (attributes.queryable ? attributes.queryable : false);\r\n               var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n               template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n               template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n               break;\r\n            case 'textarea':\r\n               template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" ' + (attributes.required ? 'required' : '') + ' rows=\"' + (attributes.rows ? attributes.rows : '1') + '\"' + formFocus + '></textarea>';\r\n               break;\r\n            case 'datetime-local':\r\n               placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n               break;\r\n            case 'password':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"6\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n               break;\r\n            case 'email':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n               break;\r\n            case 'number':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n               break;\r\n            case 'text':\r\n            default:\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n               break;\r\n         }\r\n         return template + '</div>';\r\n      },\r\n      link: function(scope, element, attributes, model) {\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name controlAutocomplete\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom control type with autocomplete functionality. (use the shortcut version with control directive)\r\n   *\r\n   * @param {service} controlAutocomplete the datasource service\r\n   * @param {model} model the target model of control\r\n   * @param {boolean} [canCreate=false] setted on true the control can add new entities\r\n   * @param {boolean} [flatten=false] set to true to flat the value to the model\r\n   * @param {boolean} [queryable=false] set to true if is a queryable service\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12 empty focus\">\r\n                     <label for=\"dishname\" class=\"control-label\">dish name<span ng-messages=\"(myForm.$submitted || myForm.dishname.$touched) &amp;&amp; myForm.dishname.$error\" role=\"alert\" class=\"ng-inactive\"></span></label>\r\n                     <input name=\"dishname\" ng-model=\"model.name\" type=\"hidden\" required=\"\">\r\n                     <div control-autocomplete=\"dishesAutocomplete\" model=\"model.name\" label=\"name\" key=\"name\" can-create=\"true\" flatten=\"true\" queryable=\"false\" placeholder=\"type the name of the dish\" on-focus=\"myForm.dishname.hasFocus=true\" on-blur=\"myForm.dishname.hasFocus=false\" on-selected=\"onDishSelected($item)\" class=\"ng-isolate-scope\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.run(['$rootScope', '$q', function($rootScope, $q) {\r\n            $rootScope.dishesAutocomplete = ;\r\n            $rootScope.onDishSelected = function($item) {\r\n               alert($item);\r\n            };\r\n         }]);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('controlAutocomplete', ['$parse', '$window', '$timeout', function($parse, $window, $timeout) {\r\n   var MAX_ITEMS = 5;\r\n   return {\r\n      restrict: 'A',\r\n      scope: {\r\n         service: '=controlAutocomplete',\r\n         canCreate: '=',\r\n         flatten: '=',\r\n         queryable: '=',\r\n         model: '=',\r\n         label: '@',\r\n         key: '@',\r\n      },\r\n      template: function(element, attributes) {\r\n         var template = '<div>';\r\n         template += '   <input class=\"form-control\" ng-model=\"phrase\" ng-model-options=\"{ debounce: 150 }\" placeholder=\"' + attributes.placeholder + '\" type=\"text\" ng-focus=\"onFocus()\">';\r\n         template += '   <ul class=\"form-autocomplete\" ng-show=\"items.length\">';\r\n         template += '       <li ng-repeat=\"item in items\" ng-class=\"{ active: active == $index }\" ng-click=\"onSelect(item)\">';\r\n         template += '           <span>{{item.NameA}}<span class=\"token\">{{item.NameB}}</span>{{item.NameC}}</span>';\r\n         template += '       </li>';\r\n         template += '   </ul>';\r\n         template += '</div>';\r\n         return template;\r\n      },\r\n      link: function(scope, element, attributes, model) {\r\n         var onSelected = $parse(attributes.onSelected);\r\n         var input = element.find('input');\r\n         var label = (scope.label ? scope.label : 'name');\r\n         var key = (scope.key ? scope.key : 'id');\r\n         function getPhrase() {\r\n            if (scope.model) {\r\n               return scope.flatten ? scope.model : scope.model[label];\r\n            } else {\r\n               return null;\r\n            }\r\n         }\r\n         scope.phrase = getPhrase();\r\n         scope.count = 0;\r\n         scope.items = [];\r\n         scope.active = -1;\r\n         scope.maxItems = scope.maxItems || Number.POSITIVE_INFINITY;\r\n         function Clear(phrase) {\r\n            scope.items.length = 0;\r\n            scope.count = 0;\r\n            scope.phrase = phrase || null;\r\n            input.val(scope.phrase);\r\n         }\r\n         function Current() {\r\n            var current = null;\r\n            if (scope.active != -1 && scope.items.length > scope.active) {\r\n               current = scope.items[scope.active];\r\n            }\r\n            return current;\r\n         }\r\n         scope.onFocus = function() {\r\n            if (attributes.onFocus !== undefined) {\r\n               scope.$parent.$eval(attributes.onFocus);\r\n            }\r\n            if (input.val() === getPhrase()) {\r\n               input.val(null);\r\n            }\r\n         };\r\n         scope.onBlur = function() {\r\n            if (attributes.onBlur !== undefined) {\r\n               scope.$parent.$eval(attributes.onBlur);\r\n            }\r\n            Clear(getPhrase());\r\n         };\r\n         scope.onSelect = function(item) {\r\n            if (scope.queryable) {\r\n               scope.service.setItem(item).then(function(parsedItem) {\r\n                  onSelected({ $item: parsedItem }, scope.$parent, { $event: {} });\r\n                  $timeout(function() {\r\n                     if (scope.flatten) {\r\n                        scope.model = parsedItem[key];\r\n                     } else {\r\n                        scope.model = scope.model || {};\r\n                        angular.extend(scope.model, parsedItem);\r\n                     }\r\n                     scope.onBlur();\r\n                  }, 1);\r\n               });\r\n            } else {\r\n               onSelected({ $item: item }, scope.$parent, { $event: {} });\r\n               if (scope.flatten) {\r\n                  scope.model = item[key];\r\n               } else {\r\n                  scope.model = scope.model || {};\r\n                  angular.extend(scope.model, item);\r\n               }\r\n               scope.onBlur();\r\n            }\r\n         };\r\n         function onTyping(phrase) {\r\n            if (scope.canCreate) {\r\n               if (scope.flatten) {\r\n                  if (key === label) {\r\n                     scope.model = phrase;\r\n                  }\r\n               } else {\r\n                  scope.model = {};\r\n                  scope.model[label] = phrase;\r\n               }\r\n            }\r\n         };\r\n         function Enter() {\r\n            var item = Current();\r\n            if (item) {\r\n               scope.onSelect(item);\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Up() {\r\n            scope.active--;\r\n            if (scope.active < 0) {\r\n               scope.active = scope.items.length - 1;\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Down() {\r\n            scope.active++;\r\n            if (scope.items.length == 0) {\r\n               scope.active = -1;\r\n            } else if (scope.active >= scope.items.length) {\r\n               scope.active = 0;\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Parse(data) {\r\n            scope.items = data.items;\r\n            scope.count = data.count;\r\n            angular.forEach(scope.items, function(value, index) {\r\n               var name = value[label];\r\n               var i = name.toLowerCase().indexOf(scope.phrase.toLowerCase());\r\n               value.NameA = name.substr(0, i);\r\n               value.NameB = name.substr(i, scope.phrase.length);\r\n               value.NameC = name.substr(i + scope.phrase.length, name.length - (i + scope.phrase.length));\r\n            });\r\n         }\r\n         function Filter(data) {\r\n            var c = 0, i = [];\r\n            if (scope.phrase.length > 1) {\r\n               angular.forEach(data.items, function(value, index) {\r\n                  var name = value[label];\r\n                  if (name.toLowerCase().indexOf(scope.phrase.toLowerCase()) !== -1) {\r\n                     if (i.length < MAX_ITEMS) {\r\n                        i.push(value);\r\n                     }\r\n                     c++;\r\n                  }\r\n               });\r\n            }\r\n            Parse({\r\n               count: c,\r\n               items: i\r\n            });\r\n         }\r\n         function Search() {\r\n            scope.phrase = input.val();\r\n            scope.active = -1;\r\n            onTyping(scope.phrase);\r\n            if (scope.queryable) {\r\n               scope.service.setPhrase(scope.phrase).then(function(success) {\r\n                  scope.items = success.items;\r\n                  scope.count = success.count;\r\n               }, function(error) {\r\n                  console.log('Search.queryable.error', scope.phrase, error);\r\n               }).finally(function() {\r\n\r\n               });\r\n            } else {\r\n               Filter({\r\n                  count: scope.service.length,\r\n                  items: scope.service\r\n               });\r\n               scope.$apply();\r\n            }\r\n         }\r\n         function onKeyDown(e) {\r\n            switch (e.keyCode) {\r\n               case 9: // Tab\r\n               case 13: // Enter\r\n                  Enter();\r\n                  if (scope.items.length) {\r\n                     e.preventDefault ? e.preventDefault() : null;\r\n                     return false;\r\n                  }\r\n                  break;\r\n               case 38: // Up\r\n                  Up();\r\n                  break;\r\n               case 40: // Down\r\n                  Down();\r\n                  break;\r\n            }\r\n         }\r\n         function onKeyUp(e) {\r\n            switch (e.keyCode) {\r\n               case 9: // Tab\r\n               case 13: // Enter\r\n                  break;\r\n               case 39: // Right\r\n                  break;\r\n               case 37: // Left\r\n                  break;\r\n               case 38: // Up\r\n                  break;\r\n               case 40: // Down\r\n                  break;\r\n               default: // Text\r\n                  Search.call(this);\r\n                  break;\r\n            }\r\n         }\r\n         function onUp(e) {\r\n            if (Utils.getClosest(e.target, '[control-autocomplete]') === null) {\r\n               scope.$apply(function() {\r\n                  scope.onBlur();\r\n               });\r\n            }\r\n            return true;\r\n         }\r\n         function addListeners() {\r\n            input.on('keydown', onKeyDown);\r\n            input.on('keyup', onKeyUp);\r\n            angular.element($window).on('mouseup touchend', onUp);\r\n         };\r\n         function removeListeners() {\r\n            input.off('keydown', onKeyDown);\r\n            input.off('keyup', onKeyUp);\r\n            angular.element($window).off('mouseup touchend', onUp);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         var init = false;\r\n         function Init() {\r\n            if (!init) {\r\n               addListeners();\r\n               init = true;\r\n            }\r\n         }\r\n         scope.$watch('service', function(newValue) {\r\n            if (newValue && (newValue.length || scope.queryable)) {\r\n               Init();\r\n            }\r\n         });\r\n         scope.$watchCollection('model', function(newValue) {\r\n            if (newValue) {\r\n               if (scope.flatten && label === key) {\r\n                  scope.phrase = newValue;\r\n                  input.val(scope.phrase);\r\n               } else if (newValue[label]) {\r\n                  scope.phrase = newValue[label];\r\n                  input.val(scope.phrase);\r\n               }\r\n            }\r\n         });\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name validateType\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom validation type for ngModel\r\n   *\r\n   * @param {string} [validateType=number] the type of custom validation\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n\t\t<file name=\"index.html\">\r\n\t\t\t<form name=\"myForm\">\r\n\t\t\t\t<input name=\"myValue\" type=\"text\" ng-model=\"model\" validate-type=\"number\" />\r\n\t\t\t\t<span ng-messages=\"(myForm.$submitted || myForm.$touched) && myForm.myValue.$error\" role=\"alert\">\r\n\t\t\t\t\t<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>\r\n\t\t\t\t</span>\r\n\t\t\t</form>\r\n\t\t</file>\r\n\t\t<file name=\"script.js\">\r\n\t\t\tangular.module('examples', ['wsUtils']);\r\n\t\t</file>\r\n\t</example>\r\n*/\r\napp.directive('validateType', function() {\r\n   return {\r\n      require: 'ngModel',\r\n      link: function(scope, element, attributes, model) {\r\n         var type = attributes.validateType;\r\n         switch (type) {\r\n            case 'number':\r\n               model.$parsers.unshift(function(value) {\r\n                  model.$setValidity(type, String(value).indexOf(Number(value).toString()) !== -1);\r\n                  return value;\r\n               });\r\n               break;\r\n         }\r\n      }\r\n   };\r\n});\r\n\n/*global angular,FB */\r\n\r\napp.value('UserRoles', [{\r\n    name: 'Guest', id: 1\r\n}, {\r\n    name: 'User', id: 2\r\n}, {\r\n    name: 'Supervisor', id: 3\r\n}, {\r\n    name: 'Admin', id: 4\r\n}]);\r\n\r\napp.value('UserRolesEnum', {\r\n    'Guest': 1,\r\n    'User': 2,\r\n    'Supervisor': 3,\r\n    'Admin': 4,\r\n});\r\n\r\napp.factory('User', ['UserRolesEnum', function (UserRolesEnum) {\r\n    function User(data) {\r\n        // Extend instance with data\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    User.prototype = {\r\n        // If user instance is in role Administrator\r\n        isAdmin: function () {\r\n            return this.role === UserRolesEnum.Admin;\r\n        },\r\n        // If user parameters equals user instance\r\n        isUser: function (user) {\r\n            return this.email === user.email;\r\n        },\r\n        picture: function (size) {\r\n          size = size || 'sm';\r\n          var w;\r\n          switch(size) {\r\n              case 'sm':\r\n                w = 50;\r\n              break;\r\n              case 'md':\r\n                w = 300;\r\n              break;\r\n              default:\r\n          }\r\n          return this.facebookId ? 'https://graph.facebook.com/'+ this.facebookId +'/picture?width=' + w + '&height=' + w + '&type=square' : '/img/avatar-default.png';\r\n        },\r\n        backgroundPicture: function(size) {\r\n            return 'background-image: url(' + this.picture(size) + ');';\r\n        },\r\n    };\r\n    return User;\r\n}]);\r\n\r\napp.factory('Post', ['$q', '$http', '$timeout', 'APP', 'User', 'Dish', 'Upload', function($q, $http, $timeout, APP, User, Dish, Upload) {\r\n\r\n\tfunction Post(data) {\r\n        data ? angular.extend(this, data) : null;\r\n        this.user = new User(this.user);\r\n        this.dish = new Dish(this.dish);\r\n    }\r\n    Post.prototype = {\r\n\t\tupload: function(file) {\r\n            console.log('Post.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function (response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function (response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function (event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Post;\r\n\r\n}]);\r\n\r\napp.factory('Dish', ['$q', '$http', '$timeout', 'APP', 'User', 'Upload', function($q, $http, $timeout, APP, User, Upload) {\r\n\r\n\tfunction Dish(data) {\r\n        this.extend(data);\r\n    }\r\n    Dish.prototype = {\r\n        extend: function(data) {\r\n            data ? angular.extend(this, data) : null;\r\n            this.user = new User(this.user);\r\n            if (this.votes) {\r\n                angular.forEach(this.votes, function(vote) {\r\n                    vote.user = new User(vote.user);\r\n                });\r\n            }\r\n        },\r\n\t\tlike: function(like) {\r\n            var self = this;\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/vote', { dishId: this.id, like: like }).then(function success(response) {\r\n                self.extend(response.data);\r\n                deferred.resolve(response);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n\t\t},\r\n\t\tupload: function(file) {\r\n            console.log('Dish.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function success(response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function error(response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function progress(event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Dish;\r\n\r\n}]);\r\n\n\n/*global angular,FB */\r\n\r\napp.factory('FacebookService', ['$q', 'APP', function ($q, APP) {\r\n\r\n    function FacebookService() {\r\n\r\n    }\r\n\r\n    FacebookService.FB = function () {\r\n        var deferred = $q.defer();\r\n        if (window['FB'] !== undefined) {\r\n            deferred.resolve(window['FB']);\r\n        } else {\r\n            FacebookService.init().then(function (success) {\r\n                deferred.resolve(window['FB']);\r\n            }, function (error) {\r\n                deferred.reject(error);\r\n            })\r\n        }\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.getFacebookMe = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me', { fields: 'id,name,first_name,last_name,email,gender,picture,cover,link' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.getPictureMe = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me/picture', { width: 300, height: 300, type: 'square' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.getLoginStatus = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.getLoginStatus(function (response) {\r\n                onFacebookStatus(response, deferred);\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.login = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n            facebook.login(function (response) {\r\n                onFacebookStatus(response, deferred);\r\n            }, {\r\n                scope: 'public_profile,email' // publish_stream,\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.logout = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n\t\t\tfacebook.logout(function (response) {\r\n\t\t\t\tdeferred.resolve(response);\r\n\t\t\t});\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.deletePermissions = function () {\r\n        var deferred = $q.defer();\r\n\t\tFacebookService.FB().then(function (facebook) {\r\n\t\t\tfacebook.api('/me/permissions', 'delete', function (response) {\r\n\t\t\t\tdeferred.resolve(response);\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.init = function () {\r\n        var deferred = $q.defer();\r\n        window.fbAsyncInit = function () {\r\n            FB.init({\r\n                appId: APP.FACEBOOK_APP_ID,\r\n                status: true,\r\n                cookie: true,\r\n                xfbml: true,\r\n                version: 'v2.5'\r\n            });\r\n            deferred.resolve(FB);\r\n        };\r\n        try {\r\n            (function (d, s, id) {\r\n                var js, fjs = d.getElementsByTagName(s)[0];\r\n                if (d.getElementById(id)) { return; }\r\n                js = d.createElement(s); js.id = id;\r\n                js.src = \"//connect.facebook.net/en_US/sdk.js\";\r\n                fjs.parentNode.insertBefore(js, fjs);\r\n            }(document, 'script', 'facebook-jssdk'));\r\n        } catch (e) {\r\n            deferred.reject(e);\r\n        }\r\n        return deferred.promise;\r\n    };\r\n\r\n    function onFacebookStatus(response, deferred) {\r\n        FacebookService.authResponse = null;\r\n        if (response.status === 'connected') {\r\n            FacebookService.authResponse = response.authResponse;\r\n            deferred.resolve(response);\r\n        } else if (response.status === 'not_authorized') {\r\n            deferred.reject(response);\r\n        } else {\r\n            deferred.reject(response);\r\n        }\r\n    };\r\n\r\n    return FacebookService;\r\n\r\n}]);\r\n\r\napp.factory('Users', ['$q', '$http', '$httpAsync', '$location', '$timeout', 'APP', 'LocalStorage', 'User', function ($q, $http, $httpAsync, $location, $timeout, APP, LocalStorage, User) {\r\n\r\n    // PRIVATE VARIABLE FOR CURRENT USER\r\n    var _currentUser = null;\r\n\r\n    function Users() {\r\n    }\r\n\r\n    Users.prototype = {\r\n    };\r\n\r\n    // STATIC CLASS METHODS\r\n    Users.currentUser = function () {\r\n        return _currentUser;\r\n    };\r\n\r\n    Users.getCurrentUser = function () {\r\n        var deferred = $q.defer();\r\n        if (_currentUser) {\r\n            deferred.resolve(_currentUser);\r\n        } else {\r\n            $http.get(APP.API + '/api/users/current/').then(function success(response) {\r\n                if (response && response.data) {\r\n                    _currentUser = new User(response.data);\r\n                    deferred.resolve(_currentUser);\r\n                } else {\r\n                    deferred.resolve(null); // deferred.reject(null);\r\n                }\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n        }\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isLogged = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            user && user.isAuthenticated ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isAdmin = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            user && user.isAuthenticated && user.isAdmin ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isLoggedOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isAdminOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated && user.isAdmin) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    },\r\n\r\n    /** LOGIN METHODS **/\r\n    Users.signup = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signup/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signin = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signin/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signInWithFacebook = function (auth) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signinwithfacebook/', auth).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signout = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/signout/').then(function success(response) {\r\n            _currentUser = null;\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.detail = function (userRoute) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/route/' + userRoute).then(function success(response) {\r\n            deferred.resolve(new User(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Users;\r\n}]);\r\n\r\napp.factory('Categories', ['$http', '$q', 'APP', function ($http, $q, APP) {\r\n\r\n    function Categories() {\r\n    }\r\n\r\n    Categories.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/').then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Categories.detail = function (categoryId) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/' + categoryId).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Categories;\r\n}]);\r\n\r\napp.factory('DishesTest', ['APP', 'Dish', function (APP, Dish) {\r\n\r\n    var uniqueId = 100;\r\n\r\n    function getRandomItems() {\r\n        var items = [];\r\n        while (items.length < 10) {\r\n            items.push({\r\n                id: uniqueId,\r\n                name: 'dish ' + uniqueId,\r\n                price: 3.20,\r\n                yes: Math.floor(Math.random() * 999),\r\n                no: Math.floor(Math.random() * 999),\r\n                pictures: [{\r\n                    route: 'http://lorempixel.com/750/375/food/' + (1 + uniqueId % 10), // 'http://placehold.it/750x375',\r\n                }],\r\n                user: {\r\n                    userName: 'User',\r\n                }\r\n            });\r\n            uniqueId++;\r\n        }\r\n        return items;\r\n    }\r\n\r\n    function TestSource() {\r\n    }\r\n    TestSource.uri = {\r\n        paging: false,\r\n    };\r\n    TestSource.resolve = function (rows) {\r\n        var items = getRandomItems();\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n\r\n    return TestSource;\r\n}]);\r\n\r\napp.factory('Posts', ['$http', '$q', 'APP', 'Post', function ($http, $q, APP, Post) {\r\n\r\n    function Posts() {\r\n    }\r\n    Posts.uri = {\r\n        paging: APP.API + '/api/stream/paged',\r\n    };\r\n    Posts.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Post(item));\r\n        }, rows);\r\n    };\r\n\r\n    Posts.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/post/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Posts;\r\n}]);\r\n\r\napp.factory('Dishes', ['$http', '$q', 'APP', 'Dish', function ($http, $q, APP, Dish) {\r\n\r\n    function Dishes() {\r\n    }\r\n    Dishes.uri = {\r\n        paging: APP.API + '/api/dishes/paged',\r\n    };\r\n    Dishes.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n\r\n    Dishes.detail = function (id) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/' + id).then(function success(response) {\r\n            deferred.resolve(new Dish(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Dishes.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/dishes/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Dishes.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/').then(function success(response) {\r\n            var rows = [];\r\n            angular.forEach(response.data, function (item) {\r\n                this.push(new Dish(item));\r\n            }, rows);\r\n            deferred.resolve(rows);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Dishes;\r\n}]);\r\n\r\napp.factory('DishesAutocomplete', ['$q', '$http', '$timeout', 'APP', function ($q, $http, $timeout, APP) {\r\n\r\n    var MAX_ITEMS = 5;\r\n\r\n    function DishesAutocomplete() {\r\n    }\r\n\r\n    DishesAutocomplete.prototype = {\r\n        setPhrase: function (phrase) {\r\n            // console.log('DishesAutocomplete.setPhrase', phrase);\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/autocomplete', { phrase: phrase }).then(function success(response) {\r\n                var data = {\r\n                    items: [],\r\n                    count: response.data.length,\r\n                };\r\n                angular.forEach(response.data, function (v, i) {\r\n                    if (i < MAX_ITEMS) {\r\n                        var value = {\r\n                            id: v.id,\r\n                            name: v.name,\r\n                        };\r\n                        var offset = v.name.toLowerCase().indexOf(phrase.toLowerCase());\r\n                        var length = phrase.length;\r\n                        value.NameA = value.name.substr(0, offset);\r\n                        value.NameB = value.name.substr(offset, length);\r\n                        value.NameC = value.name.substr(offset + length, value.name.length - (offset + length));\r\n                        data.items.push(value);\r\n                    }\r\n                });\r\n                deferred.resolve(data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n        setItem: function (item) {\r\n            var deferred = $q.defer();\r\n            $http.get(APP.API + '/api/dishes/' + item.id).then(function success(response) {\r\n                console.log('autoComplete.setItem', response.data);\r\n                deferred.resolve(response.data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n    };\r\n\r\n    return DishesAutocomplete;\r\n\r\n}]);\r\n\r\napp.factory('DataFilter', [function () {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getSearchParams: function (search) {\r\n            var a = [];\r\n            if (search) {\r\n                for (var p in search) {\r\n                    a.push({ name: p, value: search[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source, infinite) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                if (p === 'dateFrom' ||\r\n                    p === 'dateTo' ||\r\n                    p === 'status') {\r\n                    value = this[p];\r\n                    if (value !== undefined) {\r\n                        post[p] = value;\r\n                    }\r\n                } else if (p === 'search') {\r\n                    post[p] = JSON.stringify(this.getSearchParams(this[p]), null, '');\r\n                }\r\n            }\r\n            post.page = source.page;\r\n            post.size = source.size;\r\n            post.infinite = infinite;\r\n            return post;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$httpAsync', '$timeout', '$rootScope', 'DataFilter', function ($q, $http, $httpAsync, $timeout, $rootScope, DataFilter) {\r\n\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n\r\n    function DataSource(data) {\r\n        this.busy = false;\r\n        this.error = false;\r\n        this.size = 10;\r\n        this.maxPages = 10;\r\n        this.rows = [];\r\n        this.filters = {};\r\n        this.service = {\r\n            url: '/api/items/paging',\r\n            resolve: function (items, rows) {\r\n                angular.forEach(items, function (item) {\r\n                    this.push(item);\r\n                }, rows);\r\n            },\r\n        };\r\n        data ? angular.extend(this, data) : null;\r\n        this.filters = new DataFilter(this.filters);\r\n        // FAKE SERVICE FOR TEST !!!\r\n        if (this.service.uri.paging === false) {\r\n            this.get = function (deferred, infinite) {\r\n                this.busy = true;\r\n                this.error = false;\r\n                $timeout(function () {\r\n                    infinite ? null : this.rows.length = 0;\r\n                    this.service.resolve(this.rows);\r\n                    this.page = 1;\r\n                    this.pages = 2;\r\n                    this.count = this.rows.length;\r\n                    this.pagination = this.getPages();\r\n                    this.busy = false;\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    deferred.resolve(this.rows);\r\n                    // console.log('DataSource.get');\r\n                }.bind(this), 1000);\r\n            };\r\n        }\r\n        this.flush();\r\n    }\r\n    DataSource.prototype = {\r\n        flush: function () {\r\n            this.pages = PAGES_MAX;\r\n            this.page = 1;\r\n            this.count = 0;\r\n            this.opened = null;\r\n        },\r\n        resolve: function (response) {\r\n            var responseHeader = response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            // console.log('response', response, 'responseHeader', responseHeader, 'responseView', responseView);\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.pages = responseView.pages;\r\n                this.count = responseView.count;\r\n            } else {\r\n                this.page = 0;\r\n                this.size = responseView.size;\r\n                this.pages = 0;\r\n                this.count = 0;\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        get: function (deferred, infinite) {\r\n            this.busy = true;\r\n            this.error = false;\r\n            $httpAsync.get(this.service.uri.paging, { params: this.filters.getParams(this) }).then(function success(response) {\r\n                this.resolve(response);\r\n                infinite ? null : this.rows.length = 0;\r\n                this.service.resolve(response.data, this.rows);\r\n                $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                deferred.resolve(this.rows);\r\n            }.bind(this), function error(response) {\r\n                console.log('error.response', response);\r\n                this.error = true;\r\n                deferred.reject(response);\r\n            }.bind(this))\r\n                .finally(function () {\r\n                    // console.log('DataSource.get');\r\n                    $timeout(function () {\r\n                        this.busy = false;\r\n                    }.bind(this), 1000);\r\n                }.bind(this));\r\n        },\r\n        paging: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.paging');\r\n                this.opened = null;\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        refresh: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.refresh');\r\n                this.flush();\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        more: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page + 1 > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.more');\r\n                this.page++;\r\n                this.get(deferred, true);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            this.page = 1;\r\n            this.pages = PAGES_MAX;\r\n            this.paging();\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.count > 0 && this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        }\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\r\n    function Cookie() {\r\n    }\r\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\r\n    Cookie._set = function (name, value, days) {\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n            var expires = \"; expires=\" + date.toGMTString();\r\n        } else {\r\n            var expires = \"\";\r\n        }\r\n        $window.document.cookie = name + \"=\" + value + expires + \"; path=/\";\r\n    }\r\n    Cookie.set = function (name, value, days) {\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(value, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            Cookie._set(name, json, days);\r\n        } catch (e) {\r\n            console.log('Cookie.set.error serializing', name, value, e);\r\n        }\r\n    };\r\n    Cookie.get = function (name) {\r\n        var cookieName = name + \"=\";\r\n        var ca = $window.document.cookie.split(';');\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) == ' ') {\r\n                c = c.substring(1, c.length);\r\n            }\r\n            if (c.indexOf(cookieName) == 0) {\r\n                var value = c.substring(cookieName.length, c.length);\r\n                var data = null;\r\n                try {\r\n                    data = JSON.parse(value);\r\n                } catch (e) {\r\n                    console.log('Cookie.get.error parsing', key, e);\r\n                };\r\n                return data;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    Cookie.delete = function (name) {\r\n        Cookie._set(name, \"\", -1);\r\n    };\r\n    Cookie.on = function (name) {\r\n        var deferred = $q.defer();\r\n        var i, interval = 1000, elapsed = 0, timeout = Cookie.TIMEOUT;\r\n        function checkCookie() {\r\n            if (elapsed > timeout) {\r\n                deferred.reject('timeout');\r\n            } else {\r\n                var c = Cookie.get(name);\r\n                if (c) {\r\n                    deferred.resolve(c);\r\n                } else {\r\n                    elapsed += interval;\r\n                    i = setTimeout(checkCookie, interval);\r\n                }\r\n            }\r\n        }\r\n        checkCookie();\r\n        return deferred.promise;\r\n    };\r\n    return Cookie;\r\n}]);\r\n\r\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function LocalStorage() {\r\n    }\r\n    function isLocalStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'localStorage' in $window && $window['localStorage'] !== null;\r\n            if (supported) {\r\n                $window.localStorage.setItem('test', '1');\r\n                $window.localStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (LocalStorage.isSupported) {\r\n        LocalStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.localStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('LocalStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        LocalStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.localStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.localStorage[name]);\r\n                } catch (e) {\r\n                    console.log('LocalStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        LocalStorage.delete = function (name) {\r\n            $window.localStorage.removeItem(name);\r\n        };\r\n        LocalStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('LocalStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key == name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('LocalStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('LocalStorage.unsupported switching to cookies');\r\n        LocalStorage.set = Cookie.set;\r\n        LocalStorage.get = Cookie.get;\r\n        LocalStorage.delete = Cookie.delete;\r\n        LocalStorage.on = Cookie.on;\r\n    }\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('Vector', function() {\r\n\tfunction Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\r\napp.factory('Utils', ['Vector', function (Vector) {\r\n    (function () {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n\r\n    var transformProperty = function detectTransformProperty() {\r\n        var transformProperty = 'transform',\r\n            safariPropertyHack = 'webkitTransform';\r\n\t\tvar div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transformProperty] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\r\n                var e = '-' + prefix + '-transform';\r\n                if (typeof div.style[e] !== 'undefined') {\r\n                    transformProperty = e;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[safariPropertyHack] !== 'undefined') {\r\n            transformProperty = '-webkit-transform';\r\n        } else {\r\n            transformProperty = undefined;\r\n        }\r\n        return transformProperty;\r\n    } ();\r\n\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left,  rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    var getNow = Date.now || function() {\r\n        return new Date().getTime();\r\n    };\r\n\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n\r\n    var Style = function() {\r\n        function Style() {\r\n            this.props = {\r\n                scale: 1,\r\n                hoverScale: 1,\r\n                currentScale: 1,\r\n            }\r\n        }\r\n        Style.prototype = {\r\n            set: function (element) {\r\n                var styles = [];\r\n                angular.forEach(this, function (value, key) {\r\n                    if (key !== 'props')\r\n                        styles.push(key + ':' + value);\r\n                });\r\n                element.style.cssText = styles.join(';') + ';';\r\n            },\r\n            transform: function (transform) {\r\n                this[Utils.transformProperty] = transform;\r\n            },\r\n            transformOrigin: function (x, y) {\r\n                this[Utils.transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n                this[Utils.transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n            },\r\n        };\r\n        return Style;\r\n    }();\r\n\r\n    function Utils() {\r\n    }\r\n\r\n\tUtils.transformProperty = transformProperty;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.throttle = throttle;\r\n    Utils.Style = Style;\r\n\r\n    return Utils;\r\n}]);\r\n\n/*global angular*/\r\n\r\napp.factory('WebWorker', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        window.Worker = function () {\r\n            function Worker(src) {\r\n                var self = this;\r\n                $http.get(src, { transformResponse: function (d, h) { return d } }).then(function success(response) {\r\n                    try {\r\n                        eval('self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\\n ' + response.data + ' };');\r\n                        self.object = new self.o();\r\n                        self.object.postMessage = function (e) {\r\n                            self.onmessage({data:e});\r\n                        }\r\n                    } catch(e) {\r\n                        console.log(\"Worker error \", e);\r\n                    }\r\n                }, function error(response) {\r\n                    console.log(\"Worker not found\");\r\n                });\r\n            }\r\n            Worker.prototype = {\r\n                onmessage: function (e) {\r\n                    console.log('Worker not implemented');\r\n                },\r\n                postMessage: function (e) {\r\n                    this.object.onmessage({ data: e });\r\n                }\r\n            }\r\n            return Worker;\r\n        } ();\r\n    }\r\n    function WebWorker(src) {\r\n        var self = this;\r\n        this.callbacks = {};\r\n        this.id = 0;\r\n        this.worker = new Worker(src);\r\n        this.worker.onmessage = function (e) {\r\n            self.onmessage(e);\r\n        };\r\n    }\r\n    WebWorker.prototype = {\r\n        parse: function (e) {\r\n            return JSON.parse(e.data);\r\n        },\r\n        stringify: function (data) {\r\n            return JSON.stringify(data);\r\n        },\r\n        onmessage: function (e) {\r\n            var data = this.parse(e);\r\n            var deferred = this.callbacks[data.id];\r\n            if (data.status !== -1) {\r\n                deferred.resolve(data);\r\n            } else {\r\n                deferred.reject(data);\r\n            }\r\n            delete this.callbacks[data.id];\r\n        },\r\n        post: function (data) {\r\n            var deferred = $q.defer();\r\n            data.id = this.id;\r\n            this.callbacks[this.id.toString()] = deferred;\r\n            this.id++;\r\n            this.worker.postMessage(this.stringify(data));\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    WebWorker.isSupported = isWebWorkerSupported;\r\n    return WebWorker;\r\n}]);\r\n\r\napp.factory('$httpAsync', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        return $http;\r\n    }\r\n    var worker = new Worker('/js/workers/http.min.js');\r\n    var callbacks = {};\r\n    var id = 0;\r\n    var lowercase = function (string) { return isString(string) ? string.toLowerCase() : string; };\r\n    var trim = function (value) {\r\n        return isString(value) ? value.trim() : value;\r\n    };\r\n    function $httpAsync(options) {\r\n        var deferred = $q.defer();\r\n        var wrap = getDefaults(options);\r\n        wrap.id = id.toString();\r\n        console.log('wrap', wrap);\r\n        callbacks[wrap.id] = deferred;\r\n        id++;\r\n        worker.postMessage($httpAsync.stringify(wrap));\r\n        return deferred.promise;\r\n    }\r\n    $httpAsync.get = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'GET',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.delete = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'DELETE',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.head = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'HEAD',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.post = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'POST',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.put = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PUT',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.patch = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PATCH',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.parse = function (e) {\r\n        return JSON.parse(e.data);\r\n    };\r\n    $httpAsync.stringify = function (data) {\r\n        return JSON.stringify(data);\r\n    };\r\n    $httpAsync.isSupported = isWebWorkerSupported;\r\n    worker.onmessage = function (e) {\r\n        var wrap = $httpAsync.parse(e);\r\n        console.log('onmessage', wrap);\r\n        var deferred = callbacks[wrap.id];\r\n        var status = wrap.status >= -1 ? wrap.status : 0;\r\n        var getter = headersGetter(wrap.response.headers);\r\n        (isSuccess(status) ? deferred.resolve : deferred.reject)({\r\n            data: wrap.response.data, // !!!! JSON.parse(wrap.response.data),\r\n            headers: getter,\r\n            status: wrap.response.status,\r\n            statusText: wrap.response.statusText,\r\n            config: wrap.config,\r\n        });\r\n        delete callbacks[wrap.id];\r\n    }\r\n    return $httpAsync;\r\n    function isSuccess(status) {\r\n        return 200 <= status && status < 300;\r\n    }\r\n    function createMap() {\r\n        return Object.create(null);\r\n    }\r\n    function isString(value) { return typeof value === 'string'; }\r\n    function parseHeaders(headers) {\r\n        var parsed = createMap(), i;\r\n        function fillInParsed(key, val) {\r\n            if (key) {\r\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\r\n            }\r\n        }\r\n        if (isString(headers)) {\r\n            var a = headers.split('\\n');\r\n            for (var j = 0; j < a.length; j++) {\r\n                var line = a[j];\r\n                i = line.indexOf(':');\r\n                fillInParsed(lowercase(trim(line.substr(0, i))), trim(line.substr(i + 1)));\r\n            }\r\n        } else if (isObject(headers)) {\r\n            for (var p in headers) {\r\n                fillInParsed(lowercase(p), trim(headers[p]));\r\n            }\r\n        }\r\n        return parsed;\r\n    }\r\n    function headersGetter(headers) {\r\n        var headersObj;\r\n        return function (name) {\r\n            if (!headersObj) headersObj = parseHeaders(headers);\r\n            if (name) {\r\n                var value = headersObj[lowercase(name)];\r\n                if (value === void 0) {\r\n                    value = null;\r\n                }\r\n                return value;\r\n            }\r\n            return headersObj;\r\n        };\r\n    }\r\n    function getDefaults(options) {\r\n        var defaults = {\r\n            method: 'GET',\r\n            withCredentials: false,\r\n            responseType: 'json',\r\n            headers: {},\r\n            config: {}\r\n        }\r\n        defaults.withCredentials = $http.defaults.withCredentials;\r\n        angular.extend(defaults.headers, $http.defaults.headers.common);\r\n        var method = (options.method || defaults.method).toLowerCase();\r\n        if ($http.defaults.headers[method]) {\r\n            angular.extend(defaults.headers, $http.defaults.headers[method]);\r\n        }\r\n        console.log('defaults', $http.defaults);\r\n        // defaults = angular.extend(defaults, $http.defaults);\r\n        /*\r\n    method{string}:                     HTTP method (e.g. 'GET', 'POST', etc)\r\n    url:{string}:                       Absolute or relative URL of the resource that is being requested.\r\n    params:{Object.<string|Object>}:    Map of strings or objects which will be serialized with the paramSerializer and appended as GET parameters.\r\n\r\n    data:{string|Object}:               Data to be sent as the request message data.\r\n    headers:{Object}:                   Map of strings or functions which return strings representing HTTP headers to send to the server. If the return value of a function is null, the header will not be sent. Functions accept a config object as an argument.\r\n\r\n    xsrfHeaderName:{string}:            Name of HTTP header to populate with the XSRF token.\r\n    xsrfCookieName:{string}:            Name of cookie containing the XSRF token.\r\n    transformRequest:{function(data, headersGetter)|Array.<function(data, headersGetter)>}:         transform function or an array of such functions. The transform function takes the http request body and headers and returns its transformed (typically serialized) version. See Overriding the Default Transformations\r\n\r\n    transformResponse:{function(data, headersGetter, status)|Array.<function(data, headersGetter, status)>}:    transform function or an array of such functions. The transform function takes the http response body, headers and status and returns its transformed (typically deserialized) version. See Overriding the Default TransformationjqLiks\r\n\r\n    paramSerializer:{string|function(Object<string,string>):string}:        A function used to prepare the string representation of request parameters (specified as an object). If specified as string, it is interpreted as function registered with the $injector, which means you can create your own serializer by registering it as a service. The default serializer is the $httpParamSerializer; alternatively, you can use the $httpParamSerializerJQLike\r\n\r\n    cache:{boolean|Cache}:              If true, a default $http cache will be used to cache the GET request, otherwise if a cache instance built with $cacheFactory, this cache will be used for caching.\r\n\r\n    timeout:{number|Promise}:           timeout in milliseconds, or promise that should abort the request when resolved.\r\n    withCredentials:{boolean}:          whether to set the withCredentials flag on the XHR object. See requests with credentials for more information.\r\n\r\n    responseType:{string}:              see XMLHttpRequest.responseType.\r\n        */\r\n        options ? options = angular.extend(defaults, options) : defaults;\r\n        return options;\r\n    }\r\n}]);\r\n"],"sourceRoot":"/source/"}