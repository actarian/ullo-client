{"version":3,"sources":["wwwroot/js/app.js"],"names":["LESSON","app","angular","module","constant","CLIENT","window","location","href","indexOf","API","FACEBOOK_APP_ID","assetTypeEnum","Unknown","Picture","IOS","navigator","userAgent","match","config","$httpProvider","$routeProvider","$locationProvider","defaults","withCredentials","when","title","templateUrl","controller","controllerAs","resolve","user","Users","isLoggedOrGoTo","isForward","otherwise","html5Mode","run","$rootScope","$window","APP","route","size","standalone","document","ontouchmove","event","preventDefault","oncontextmenu","stopPropagation","getPictures","model","src","pictures","i","length","media","getPicture","picture","broadcast","params","$broadcast","animation","$animate","isFirstView","currentRoute","isBackward","previousRoute","bezierOptions","type","dynamics","bezier","points","x","y","cp","duration","$on","current","previous","$$route","enter","element","done","css","translateY","opacity","scale","animate","w","offsetWidth","translateX","leave","setTimeout","directive","$timeout","restrict","link","scope","attributes","onTap","e","addClass","removeClass","addListeners","on","removeListeners","off","delays","undefined","split","delay","forEach","d","parseInt","push","removeClasses","join","shift","a","$parse","$compile","Utils","doTop","busy","onTop","$apply","then","sy","ey","undrag","doBottom","onBottom","lbottom2","offsetHeight","inner","lbottom","padding","dragging","wheeling","move","down","removeDragListeners","bounce","ltop","redraw","time","speed","Math","abs","cy","pause","min","max","innerStyle","transform","toFixed","set","showIndicatorFor","percent","iy","indicator","ix","round","rows","html","count","indicatorStyle","play","loop","aKey","requestAnimationFrame","cancelAnimationFrame","onDown","getTouch","addDragListeners","onMove","prev","onUp","up","_onWheel","dir","deltaY","wheelDelta","onWheel","ondragstart","$eval","attr","find","Style","append","contents","throttle","ngImg","image","Image","onload","$set","this","load","$watch","newValue","WebWorker","worker","doWork","onImageLoaded","post","url","data","error","ngImgWorker","replace","template","form","placeholder","name","formKey","formFocus","required","label","key","readonly","control","options","number","source","canCreate","flatten","queryable","onSelected","MAX_ITEMS","service","getPhrase","Clear","phrase","items","input","val","Current","active","onTyping","Enter","item","onSelect","Up","Down","Parse","value","index","toLowerCase","NameA","substr","NameB","NameC","Filter","c","Search","setPhrase","success","console","log","onKeyDown","keyCode","onKeyUp","call","getClosest","target","onBlur","Init","init","maxItems","Number","POSITIVE_INFINITY","onFocus","$parent","setItem","parsedItem","$item","$event","extend","$watchCollection","require","validateType","$parsers","unshift","$setValidity","String","toString","id","Guest","User","Supervisor","Admin","factory","UserRolesEnum","prototype","isAdmin","role","isUser","email","facebookId","backgroundPicture","$q","$http","Dish","Upload","Post","dish","upload","file","self","lastIndexOf","extension","uploadData","assetType","progress","uploads","JSON","stringify","response","concat","has","splice","status","progressPercentage","loaded","total","voteCount","yes","no","rating","ratingToString","votes","vote","like","deferred","defer","dishId","reject","promise","Vector","make","b","sqrt","normalize","l","incidence","angle","atan2","distance","cross","difference","towards","friction","add","copy","FacebookService","onFacebookStatus","authResponse","FB","getFacebookMe","facebook","api","fields","getPictureMe","width","height","login","isMobile","permissionUrl","logout","fbAsyncInit","appId","cookie","xfbml","version","getLoginStatus","s","js","fjs","getElementsByTagName","getElementById","createElement","parentNode","insertBefore","$httpAsync","$location","LocalStorage","_currentUser","currentUser","getCurrentUser","get","isLogged","isAuthenticated","redirect","path","isAdminOrGoTo","signup","signin","signInWithFacebook","auth","signout","detail","userRoute","Categories","categoryId","getRandomItems","uniqueId","price","floor","random","userName","TestSource","uri","paging","Posts","Dishes","DishesAutocomplete","v","offset","DataFilter","getSearchParams","search","p","getParams","infinite","page","DataSource","maxPages","filters","pages","pagination","getPages","bind","flush","PAGES_MAX","opened","responseHeader","headers","responseView","parse","refresh","more","filter","prevPage","nextPage","gotoPage","firstPage","lastPage","hasMany","hasMorePagesBehind","startingIndex","hasMorePagesNext","endingIndex","isPage","hasPages","openClose","Cookie","TIMEOUT","_set","days","date","Date","setTime","getTime","expires","toGMTString","cache","json","cookieName","ca","charAt","substring","checkCookie","elapsed","timeout","interval","isLocalStorageSupported","supported","localStorage","removeItem","isSupported","storageEvent","clearTimeout","originalEvent","t","touch","touches","changedTouches","pageX","pageY","getRelativeTouch","point","rect","getBoundingClientRect","left","top","el","selector","matchesFn","parent","some","fn","body","parentElement","func","wait","context","args","result","later","leading","getNow","apply","now","remaining","arguments","trailing","lastTime","vendors","callback","currTime","timeToCall","transformProperty","safariPropertyHack","div","style","every","prefix","props","hoverScale","currentScale","styles","cssText","transformOrigin","callbacks","Worker","onmessage","isWebWorkerSupported","transformResponse","h","eval","object","o","postMessage","wrap","getDefaults","isSuccess","createMap","Object","create","isString","parseHeaders","fillInParsed","parsed","j","line","lowercase","trim","isObject","headersGetter","headersObj","method","responseType","common","string","head","put","patch","getter","statusText","$scope","signOut","logoutBusy","goStream","goPost","goDish","goCategory","goUser","goSettings","signinOrSignup","splashBusy","showFacebookLoginButton","onFacebookLogin","signinFormError","signinFormBusy","message","me","firstName","first_name","lastName","last_name","facebookPicture","facebookToken","accessToken","signupFormError","signupFormBusy","onUploadFileSelected","newFiles","$root","pictureBase64","dataUrl","categories","dishesAutocomplete","hasPicture","pictureError","onDishSelected","isVeganFriendly","submitPost","postFormBusy","postFormError","$routeParams","category","Category","UserName","DishesTest"],"mappings":"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","file":"wwwroot/js/app.min.js","sourcesContent":["/*global angular,FB */\r\n\r\nvar LESSON = true;\r\n\r\nvar app = angular.module('ullo', ['ngRoute', 'ngMessages', 'ngAnimate', 'relativeDate', 'ngFileUpload']);\r\n\r\napp.constant('APP', {\r\n    CLIENT: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? 'http://ulloclient.wslabs.it' : 'http://dev.ullowebapp:8081',\r\n    API: (LESSON || window.location.href.indexOf('http://ulloclient.wslabs.it') === 0) ? 'http://ulloapi.wslabs.it' : 'https://localhost:44302',\r\n    FACEBOOK_APP_ID: window.location.href.indexOf('http://ulloclient.wslabs.it') === 0 ? '1054303094614120' : '1062564893787940',\r\n    assetTypeEnum: {\r\n        Unknown: 0,\r\n        Picture: 1,\r\n    },\r\n    IOS: (navigator.userAgent.match(/iPad|iPhone|iPod/g) ? true : false),\r\n});\r\n\r\napp.config(['$httpProvider', '$routeProvider', '$locationProvider', function ($httpProvider, $routeProvider, $locationProvider) {\r\n\r\n    $httpProvider.defaults.withCredentials = true;\r\n\r\n    $routeProvider.when('/test', {\r\n\r\n        title: 'Test',\r\n        templateUrl: 'templates/dishes.html',\r\n        controller: 'TestCtrl',\r\n        controllerAs: 'testCtrl',\r\n\r\n    }).when('/', {\r\n\r\n        title: 'Stream',\r\n        templateUrl: 'templates/stream.html',\r\n        controller: 'StreamCtrl',\r\n        controllerAs: 'streamCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n\r\n    }).when('/stream', {\r\n\r\n        title: 'Stream',\r\n        templateUrl: 'templates/stream.html',\r\n        controller: 'StreamCtrl',\r\n        controllerAs: 'streamCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n\r\n    }).when('/splash', {\r\n\r\n        title: 'Splash',\r\n        templateUrl: 'templates/splash.html',\r\n        controller: 'SplashCtrl',\r\n        controllerAs: 'splashCtrl',\r\n\r\n    }).when('/signin', {\r\n\r\n        title: 'Sign In',\r\n        templateUrl: 'templates/signin.html',\r\n        controller: 'SigninCtrl',\r\n        controllerAs: 'signinCtrl',\r\n\r\n    }).when('/signup', {\r\n\r\n        title: 'Sign Up',\r\n        templateUrl: 'templates/signup.html',\r\n        controller: 'SignupCtrl',\r\n        controllerAs: 'signupCtrl',\r\n\r\n    }).when('/dishes/:dishId', {\r\n\r\n        title: 'Dish',\r\n        templateUrl: 'templates/dish.html',\r\n        controller: 'DishCtrl',\r\n        controllerAs: 'dishCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/categories/:categoryId', {\r\n\r\n        title: 'Category',\r\n        templateUrl: 'templates/category.html',\r\n        controller: 'CategoryCtrl',\r\n        controllerAs: 'categoryCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/users/:userRoute', {\r\n\r\n        title: 'User',\r\n        templateUrl: 'templates/user.html',\r\n        controller: 'UserCtrl',\r\n        controllerAs: 'userCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/post', {\r\n\r\n        title: 'Add Post',\r\n        templateUrl: 'templates/post.html',\r\n        controller: 'PostCtrl',\r\n        controllerAs: 'postCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/settings', {\r\n\r\n        title: 'Settings',\r\n        templateUrl: 'templates/settings.html',\r\n        controller: 'SettingsCtrl',\r\n        controllerAs: 'settingsCtrl',\r\n        resolve: {\r\n            user: ['Users', function(Users){\r\n                return Users.isLoggedOrGoTo('/splash');\r\n            }]\r\n        },\r\n        isForward: true,\r\n\r\n    }).when('/404', {\r\n\r\n        title: 'Error 404',\r\n        templateUrl: '404.html',\r\n\r\n    });\r\n\r\n    $routeProvider.otherwise('/stream');\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(true);\r\n\r\n}]);\r\n\r\napp.run(['$rootScope', '$window', 'APP', function ($rootScope, $window, APP) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    document.ontouchmove = function (event) {\r\n        event.preventDefault();\r\n    }\r\n\r\n    window.oncontextmenu = function (event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return false;\r\n    };\r\n\r\n    function Picture(route, size) {\r\n        if (route.indexOf('http') === 0) {\r\n            return route;\r\n        } else if (size) {\r\n            return APP.API + route + '?media=' + size;\r\n        } else {\r\n            return APP.API + route;\r\n        }\r\n    }\r\n\r\n    $rootScope.getPictures = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.pictures) {\r\n            for (var i = 0; i < model.pictures.length; i++) {\r\n                var media = model.pictures[i];\r\n                if (media.route) {\r\n                    src = Picture(media.route, size);\r\n                    i = 100000;\r\n                }\r\n            }\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.getPicture = function (model, size) {\r\n        size;\r\n        var src = '/img/preview.png';\r\n        if (!model) {\r\n            return src;\r\n        }\r\n        if (model.picture && model.picture.route) {\r\n            src = Picture(model.picture.route, size);\r\n        } else if (model.route) {\r\n            src = Picture(model.route, size);\r\n        }\r\n        return src;\r\n    };\r\n\r\n    $rootScope.broadcast = function (event, params) {\r\n        $rootScope.$broadcast(event, params);\r\n    };\r\n\r\n}]);\r\n\n\r\napp.animation('.navigation', ['$rootScope', '$animate', function($rootScope, $animate) {       \r\n    var previousRoute = null;\r\n    var currentRoute = null;    \r\n    var bezierOptions = {\r\n        type: dynamics.bezier,\r\n        points: [{x:0,y:0,cp:[{x:0.509,y:0.007}]},{x:1,y:1,cp:[{x:0.566,y:0.997}]}],\r\n        duration : 500,        \r\n    }    \r\n    $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        previousRoute = previous.$$route;\r\n        currentRoute = current.$$route;\r\n    });   \r\n    function isFirstView() {\r\n        return !currentRoute;\r\n    }    \r\n    function isBackward() {\r\n        return previousRoute.isForward;\r\n    }    \r\n    return {\r\n        enter: function(element, done) {                        \r\n            if (isFirstView()) {\r\n                // FIRST ENTERING ANIMATION\r\n                dynamics.css(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 0,\r\n                    scale: 1.2,\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateY: 0,\r\n                    opacity: 1,\r\n                    scale: 1,\r\n                }, bezierOptions);            \r\n            } else if (isBackward()) {\r\n                // BACKWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: -w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions); \r\n            } else {\r\n                // FORWARD ENTERING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: w\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: 0\r\n                }, bezierOptions); \r\n            }\r\n            done();\r\n        },    \r\n        leave: function(element, done) {\r\n            if (isBackward()) {\r\n                // BACKWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: w\r\n                }, bezierOptions); \r\n            } else {\r\n                // FORWARD EXITING ANIMATION\r\n                var w = element[0].offsetWidth;\r\n                dynamics.css(element[0], {\r\n                    translateX: 0\r\n                });\r\n                dynamics.animate(element[0], {\r\n                    translateX: -w\r\n                }, bezierOptions); \r\n            }\r\n            setTimeout(done, 1000);\r\n        }\r\n    }\r\n}]);\n/*global angular,FB,dynamics*/\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name onTap\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'tapped' on element and removes it after a timeout of 500 ms\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <button type=\"button\" on-tap>Tap me!</button>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .tapped {\r\n            background: red;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('onTap', ['$timeout', function($timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         function onTap(e) {\r\n            element.addClass('tapped');\r\n            $timeout(function() {\r\n               element.removeClass('tapped');\r\n            }, 500)\r\n         };\r\n         function addListeners() {\r\n            element.on('touchstart mousedown', onTap);\r\n         };\r\n         function removeListeners() {\r\n            element.off('touchstart mousedown', onTap);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         addListeners();\r\n      }\r\n   }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name animate\r\n   * @kind function\r\n   * @requires $timeout\r\n   *\r\n   * @description\r\n   * When called, it add a class named 'animated' on element\r\n   *\r\n   * @param {string} [animate=fadeIn] a comma separated animate.css class names\r\n   * @param {string} [delay=1] a comma separated durations list in milliseconds\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div type=\"button\" animate=\"fadeInUp\" delay=\"1000\">\r\n            I'm an animated div.\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('animate', ['$timeout', function($timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         element.addClass('animated');\r\n         var animate = ['fadeIn'], delays = ['1'];\r\n         if (attributes.animate !== undefined) {\r\n            animate = attributes.animate.split(',');\r\n         }\r\n         if (attributes.delay !== undefined) {\r\n            delays = attributes.delay.split(',');\r\n         }\r\n         angular.forEach(delays, function(d, i) {\r\n            delays[i] = parseInt(d);\r\n         });\r\n         while (delays.length < animate.length) {\r\n            delays.push(delays[delays.length - 1] + 50);\r\n         }\r\n         var removeClasses = animate.join(' ');\r\n         if (animate[0].indexOf('In') !== -1) {\r\n            element.addClass('invisible');\r\n            removeClasses += ' invisible';\r\n         }\r\n         while (animate.length) {\r\n            var d = delays.shift();\r\n            var a = animate.shift();\r\n            $timeout(function() {\r\n               element.removeClass(removeClasses);\r\n               element.addClass(a);\r\n               if (animate.length === 0 && a.indexOf('Out') !== -1) {\r\n                  $timeout(function() {\r\n                     element.addClass('invisible');\r\n                  }, 1000);\r\n               }\r\n            }, d);\r\n         }\r\n      }\r\n   }\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name scrollable\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Scrollable div 3d accellerated with touch functionality and callbacks for infinite scroll\r\n   *\r\n   * @param {promise} [on-top] optional callback function that execute when reaching top\r\n   * @param {promise} [on-bottom] optional callback function that execute when reaching bottom\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div ng-controller=\"TestCtrl\">\r\n            <section class=\"scrollable content\" scrollable on-top=\"$root.doRefresh()\">\r\n               <div class=\"inner\">\r\n                  <ul>\r\n                     <li ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]\">item <span ng-bind=\"item\"></span></li>\r\n                  </ul>\r\n               </div>\r\n            </section>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.controller('TestCtrl', ['$scope', '$q', function($scope, $q) {\r\n            $scope.doRefresh = function() {\r\n               var deferred = $q.defer();\r\n               if ($scope.busy) {\r\n                  deferred.reject();\r\n               } else {\r\n                  $scope.busy = true;\r\n                  $timeout(function() {\r\n                     $scope.busy = false;\r\n                     deferred.resolve();\r\n                  }, 500);\r\n               }\r\n               return deferred.promise;\r\n            };\r\n         }]);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         .scrollable.content {\r\n            height: 200px!important;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('scrollable', ['$parse', '$compile', '$window', '$timeout', 'Utils', function($parse, $compile, $window, $timeout, Utils) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         $window.ondragstart = function() { return false; };\r\n         // CONSTS;\r\n         var padding = 150;\r\n         // FLAGS;\r\n         var dragging, wheeling, busy;\r\n         // MOUSE;\r\n         var down, move, prev, up;\r\n         // COORDS;\r\n         var sy = 0, ey = 0, cy = 0, ltop = 0, lbottom = 0, speed = 0, ix = 45, iy = 0;\r\n         // ANIMATION KEY;\r\n         var aKey;\r\n         var onTop, onBottom, showIndicatorFor;\r\n         if (attributes.onTop !== undefined) {\r\n            onTop = $parse(attributes.onTop, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         if (attributes.onBottom !== undefined) {\r\n            onBottom = $parse(attributes.onBottom, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         if (attributes.showIndicatorFor !== undefined) {\r\n            showIndicatorFor = scope.$eval(attributes.showIndicatorFor); // $parse(attributes.showIndicatorFor, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         }\r\n         // console.log('showIndicatorFor', showIndicatorFor);\r\n         // ELEMENTS & STYLESHEETS;\r\n         element.attr('unselectable', 'on').addClass('unselectable');\r\n         var inner = element.find('div');\r\n         var innerStyle = new Utils.Style();\r\n         var indicator = null, indicatorStyle;\r\n         if (showIndicatorFor) {\r\n            indicator = angular.element('<div class=\"indicator\"></div>');\r\n            indicatorStyle = new Utils.Style();\r\n            element.append(indicator);\r\n            $compile(indicator.contents())(scope);\r\n            indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n            indicatorStyle.set(indicator[0]);\r\n         }\r\n         function doTop() {\r\n            if (busy) {\r\n               return;\r\n            }\r\n            if (!onTop) {\r\n               return;\r\n            }\r\n            busy = true;\r\n            scope.$apply(onTop).then().finally(function() {\r\n               sy = ey = 0;\r\n               setTimeout(function() {\r\n                  undrag();\r\n                  busy = false;\r\n               }, 500);\r\n            });\r\n         }\r\n         function doBottom() {\r\n            if (busy) {\r\n               return;\r\n            }\r\n            if (!onBottom) {\r\n               return;\r\n            }\r\n            busy = true;\r\n            scope.$apply(onBottom).then().finally(function() {\r\n               var lbottom2 = element[0].offsetHeight - inner[0].offsetHeight;\r\n               if (lbottom2 > lbottom) {\r\n                  sy = ey = lbottom;\r\n               } else {\r\n                  sy = ey = lbottom + padding;\r\n               }\r\n               setTimeout(function() {\r\n                  undrag();\r\n                  busy = false;\r\n               }, 500);\r\n            });\r\n         }\r\n         function undrag() {\r\n            // console.log('undrag');\r\n            dragging = false;\r\n            wheeling = false;\r\n            move = null;\r\n            down = null;\r\n            removeDragListeners();\r\n         }\r\n         function bounce() {\r\n            ltop += padding;\r\n            lbottom -= padding;\r\n            if (ey > ltop) {\r\n               doTop();\r\n            } else if (ey < lbottom) {\r\n               doBottom();\r\n            }\r\n         }\r\n         function redraw(time) {\r\n            // if (!busy) {\r\n            ltop = 0;\r\n            lbottom = element[0].offsetHeight - inner[0].offsetHeight;\r\n            if (dragging) {\r\n               ey = sy + move.y - down.y;\r\n               bounce();\r\n            } else if (speed) {\r\n               ey += speed;\r\n               speed *= .75;\r\n               if (wheeling) {\r\n                  bounce();\r\n               }\r\n               if (Math.abs(speed) < 0.05) {\r\n                  speed = 0;\r\n                  ey = sy = cy;\r\n                  wheeling = false;\r\n                  pause();\r\n               }\r\n            }\r\n            // }\r\n            ey = Math.min(ltop, ey);\r\n            ey = Math.max(lbottom, ey);\r\n            cy += (ey - cy) / 4;\r\n            innerStyle.transform('translate3d(0,' + cy.toFixed(2) + 'px,0)');\r\n            innerStyle.set(inner[0]);\r\n            if (showIndicatorFor) {\r\n               if (dragging || wheeling || speed) {\r\n                  var percent = cy / (element[0].offsetHeight - inner[0].offsetHeight);\r\n                  percent = Math.max(0, Math.min(1, percent));\r\n                  iy = (element[0].offsetHeight - indicator[0].offsetHeight) * (percent);\r\n                  ix += (0 - ix) / 4;\r\n                  // var count = Math.round(inner[0].offsetHeight / 315);\r\n                  var i = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n                  indicator.html(i + '/' + showIndicatorFor.count);\r\n                  // indicator.html((percent * 100).toFixed(2).toString());\r\n               } else {\r\n                  ix += (45 - ix) / 4;\r\n               }\r\n               indicatorStyle.transform('translate3d(' + ix.toFixed(2) + 'px,' + iy.toFixed(2) + 'px,0)');\r\n               indicatorStyle.set(indicator[0]);\r\n            }\r\n         }\r\n         function play() {\r\n            function loop(time) {\r\n               redraw(time);\r\n               aKey = window.requestAnimationFrame(loop, element);\r\n            }\r\n            if (!aKey) {\r\n               loop();\r\n            }\r\n         }\r\n         function pause() {\r\n            if (aKey) {\r\n               window.cancelAnimationFrame(aKey);\r\n               aKey = null;\r\n               // console.log('Animation.paused');\r\n            }\r\n         }\r\n         function onDown(e) {\r\n            if (!busy) {\r\n               sy = ey = cy;\r\n               speed = 0;\r\n               down = Utils.getTouch(e);\r\n               wheeling = false;\r\n               // console.log(down);\r\n               addDragListeners();\r\n               play();\r\n            }\r\n         }\r\n         function onMove(e) {\r\n            prev = move;\r\n            move = Utils.getTouch(e);\r\n            dragging = true;\r\n            // console.log(move);\r\n         }\r\n         function onUp(e) {\r\n            if (move && prev) {\r\n               speed += (move.y - prev.y) * 4;\r\n            }\r\n            sy = ey = cy;\r\n            dragging = false;\r\n            move = null;\r\n            down = null;\r\n            prev = null;\r\n            up = Utils.getTouch(e);\r\n            // console.log(up);\r\n            removeDragListeners();\r\n         }\r\n         function _onWheel(e) {\r\n            if (!busy) {\r\n               if (!e) e = event;\r\n               var dir = (((e.deltaY < 0 || e.wheelDelta > 0) || e.deltaY < 0) ? 1 : -1)\r\n               /*\r\n               var evt = window.event || e;\r\n               var delta = evt.detail ? evt.detail * -120 : evt.wheelDelta\r\n               speed += delta;\r\n               */\r\n               speed += dir * 5;\r\n               wheeling = true;\r\n               play();\r\n            }\r\n         }\r\n         var onWheel = Utils.throttle(_onWheel, 25);\r\n         function addListeners() {\r\n            element.on('touchstart mousedown', onDown);\r\n            element.on('wheel', onWheel);\r\n            // element.addEventListener('DOMMouseScroll',handleScroll,false); // for Firefox\r\n            // element.addEventListener('mousewheel',    handleScroll,false); // for everyone else\r\n         };\r\n         function removeListeners() {\r\n            element.off('touchstart mousedown', onDown);\r\n            element.off('wheel', onWheel);\r\n         };\r\n         function addDragListeners() {\r\n            angular.element($window).on('touchmove mousemove', onMove);\r\n            angular.element($window).on('touchend mouseup', onUp);\r\n         };\r\n         function removeDragListeners() {\r\n            angular.element($window).off('touchmove mousemove', onMove);\r\n            angular.element($window).off('touchend mouseup', onUp);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         addListeners();\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImg\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img=\"'/img/nature-01.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('ngImg', ['$parse', '$timeout', function($parse, $timeout) {\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         var src = $parse(attributes.ngImg, /* interceptorFn */ null, /* expensiveChecks */ true);\r\n         var image = new Image();\r\n         image.onload = function() {\r\n            attributes.$set('src', this.src);\r\n            setTimeout(function() {\r\n               element.addClass('loaded');\r\n            }, 10);\r\n         }\r\n         image.load = function(src) {\r\n            element.removeClass('loaded');\r\n            this.src = src;\r\n         }\r\n         scope.$watch(src, function(newValue) {\r\n            if (!newValue) {\r\n               attributes.$set('src', null);\r\n            } else {\r\n               image.load(newValue);\r\n            }\r\n         });\r\n      }\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name ngImgWorker\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * As ngImg but using webworker. Whenever the image has loaded, a loaded class will be added to the image element\r\n   *\r\n   * @param {string} ng-img path to the image to load\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <img src=\"\" ng-img-worker=\"'/img/nature-02.jpg'\"/>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n      <file name=\"style.css\">\r\n         [ng-img] {\r\n            max-width: 100%;\r\n            opacity: 0;\r\n            transition: opacity ease-in-out 250ms;\r\n         }\r\n         [ng-img].loaded {\r\n            opacity: 1;\r\n         }\r\n      </file>\r\n\t</example>\r\n*/\r\napp.directive('ngImgWorker', ['$parse', 'WebWorker', function($parse, WebWorker) {\r\n   var worker = new WebWorker('/js/workers/loader.min.js');\r\n   return {\r\n      restrict: 'A',\r\n      link: function(scope, element, attributes, model) {\r\n         function doWork(src) {\r\n            element.removeClass('loaded');\r\n            function onImageLoaded(src) {\r\n               attributes.$set('src', src);\r\n               setTimeout(function() {\r\n                  element.addClass('loaded');\r\n               }, 100);\r\n            }\r\n            worker.post({ url: src }).then(function(data) {\r\n               onImageLoaded(data.url);\r\n            }, function(error) {\r\n               onImageLoaded(null);\r\n            });\r\n         }\r\n         var src = scope.$eval(attributes.ngImgWorker);\r\n         if (!src) {\r\n            attributes.$set('src', null);\r\n         } else {\r\n            doWork(src);\r\n         }\r\n      }\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name control\r\n   * @kind function\r\n   *\r\n   * @description\r\n   * Dinamic form control generator through templates with extended validation\r\n   *\r\n   * @param {string} model the target model of control\r\n   * @param {string} [control=text] the type of control, available types (text, password, email, number, checkbox, textarea, datetime-local, select, autocomplete)\r\n   * @param {string} [form=Form] the name of the form\r\n   * @param {string} [title=Untitled] the title of the control\r\n   * @param {string} [placeholder=title] the placeholder of the control\r\n   * @param {string} [source=null] datasource of select as array\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   * @param {string} [required=false] if the control is required\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"select\" title=\"category\" placeholder=\"select a category\" model=\"model.category\" source=\"[{name:'Main',id:1}, {name:'Second',id:2}]\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"number\" title=\"dish price\" placeholder=\"type the price of the dish\" model=\"model.dish.price\" required=\"true\"></div>\r\n                  <div class=\"form-group col-xs-12\" form=\"myForm\" control=\"checkbox\" title=\"is vegan friendly\" placeholder=\"please check if the dish is vegan friendly\" model=\"model.dish.isVeganFriendly\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('control', [function() {\r\n   return {\r\n      restrict: 'A',\r\n      replace: true,\r\n      template: function(element, attributes) {\r\n         var form = attributes.form || 'Form';\r\n         var title = attributes.title || 'Untitled';\r\n         var placeholder = attributes.placeholder || title;\r\n         var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('');\r\n         var formKey = form + '.' + name;\r\n         var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n         var required = '';\r\n         var label = (attributes.label ? attributes.label : 'name');\r\n         var key = (attributes.key ? attributes.key : 'id');\r\n         var model = attributes.model;\r\n         if (attributes.required) {\r\n            required = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + form + '.' + name + '.$error\" role=\"alert\"><span ng-message=\"required\" class=\"label-error animated flash\"> &larr; required</span>';\r\n            switch (attributes.control) {\r\n               case 'password':\r\n                  required = required + '<span ng-message=\"minlength\" class=\"label-error animated flash\"> &larr; at least 6 chars</span>';\r\n                  break;\r\n               case 'email':\r\n                  required = required + '<span ng-message=\"email\" class=\"label-error animated flash\"> &larr; incorrect</span>';\r\n                  break;\r\n               case 'number':\r\n                  required = required + '<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>';\r\n                  break;\r\n            }\r\n            if (attributes.match !== undefined) {\r\n               required = required + '<span ng-message=\"match\" class=\"label-error animated flash\"> &larr; not matching</span>';\r\n            }\r\n            required = required + '</span>';\r\n         } else {\r\n            required = ' (optional)';\r\n         }\r\n         var template = '<div ' + (attributes.readonly ? ' class=\"readonly\" ' : '') + ' ng-class=\"{ focus: ' + formKey + '.hasFocus, success: ' + formKey + '.$valid, error: ' + formKey + '.$invalid && (form.$submitted || ' + formKey + '.$touched), empty: !' + formKey + '.$viewValue }\"><label for=\"' + name + '\" class=\"control-label\">' + title + required + '</label>';\r\n         switch (attributes.control) {\r\n            case 'checkbox':\r\n               template = '<div class=\"checkbox\">';\r\n               template += '<span class=\"checkbox-label\">' + title + required + '</span>';\r\n               template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + (attributes.required ? 'required=\"true\"' : '') + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n               template += '</div>';\r\n               break;\r\n            case 'select':\r\n               var options = attributes.number\r\n                  ? 'item.' + key + ' as item.' + label + ' for item in ' + attributes.source\r\n                  : 'item.' + label + ' for item in ' + attributes.source + ' track by item.' + key;\r\n               template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + ' ' + (attributes.required ? 'required=\"true\"' : '') + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n               break;\r\n            case 'autocomplete':\r\n               var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n               var flatten = (attributes.flatten ? attributes.flatten : false);\r\n               var queryable = (attributes.queryable ? attributes.queryable : false);\r\n               var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n               template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n               template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n               break;\r\n            case 'textarea':\r\n               template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" ' + (attributes.required ? 'required' : '') + ' rows=\"' + (attributes.rows ? attributes.rows : '1') + '\"' + formFocus + '></textarea>';\r\n               break;\r\n            case 'datetime-local':\r\n               placeholder == title ? placeholder = 'yyyy-MM-ddTHH:mm:ss' : null;\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n               break;\r\n            case 'password':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"password\" ng-minlength=\"6\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n               break;\r\n            case 'email':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + (attributes.required ? 'required' : '') + formFocus + '>';\r\n               break;\r\n            case 'number':\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + ' validate-type=\"number\">'; // ' validator=\"{ number: isNumber }\">';\r\n               break;\r\n            case 'text':\r\n            default:\r\n               template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\"' + (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '') + ' placeholder=\"' + placeholder + '\" type=\"text\"' + (attributes.required ? ' required' : '') + (attributes.readonly ? ' readonly' : '') + formFocus + '>';\r\n               break;\r\n         }\r\n         return template + '</div>';\r\n      },\r\n      link: function(scope, element, attributes, model) {\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name controlAutocomplete\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom control type with autocomplete functionality. (use the shortcut version with control directive)\r\n   *\r\n   * @param {service} controlAutocomplete the datasource service\r\n   * @param {model} model the target model of control\r\n   * @param {boolean} [canCreate=false] setted on true the control can add new entities\r\n   * @param {boolean} [flatten=false] set to true to flat the value to the model\r\n   * @param {boolean} [queryable=false] set to true if is a queryable service\r\n   * @param {string} [key=id] optional key for select option\r\n   * @param {string} [label=name] optional label for select option\r\n   *\r\n   * @example\r\n   <example module=\"examples\">\r\n      <file name=\"index.html\">\r\n         <div class=\"container-fluid\">\r\n            <div class=\"row\">\r\n               <form name=\"myForm\">\r\n                  <div class=\"form-group col-xs-12 empty focus\">\r\n                     <label for=\"dishname\" class=\"control-label\">dish name<span ng-messages=\"(myForm.$submitted || myForm.dishname.$touched) &amp;&amp; myForm.dishname.$error\" role=\"alert\" class=\"ng-inactive\"></span></label>\r\n                     <input name=\"dishname\" ng-model=\"model.name\" type=\"hidden\" required=\"\">\r\n                     <div control-autocomplete=\"dishesAutocomplete\" model=\"model.name\" label=\"name\" key=\"name\" can-create=\"true\" flatten=\"true\" queryable=\"false\" placeholder=\"type the name of the dish\" on-focus=\"myForm.dishname.hasFocus=true\" on-blur=\"myForm.dishname.hasFocus=false\" on-selected=\"onDishSelected($item)\" class=\"ng-isolate-scope\"></div>\r\n               </form>\r\n            </div>\r\n         </div>\r\n      </file>\r\n      <file name=\"script.js\">\r\n         angular.module('examples', ['wsUtils']);\r\n         angular.run(['$rootScope', '$q', function($rootScope, $q) {\r\n            $rootScope.dishesAutocomplete = ;\r\n            $rootScope.onDishSelected = function($item) {\r\n               alert($item);\r\n            };\r\n         }]);\r\n      </file>\r\n   </example>\r\n*/\r\napp.directive('controlAutocomplete', ['$parse', '$window', '$timeout', function($parse, $window, $timeout) {\r\n   var MAX_ITEMS = 5;\r\n   return {\r\n      restrict: 'A',\r\n      scope: {\r\n         service: '=controlAutocomplete',\r\n         canCreate: '=',\r\n         flatten: '=',\r\n         queryable: '=',\r\n         model: '=',\r\n         label: '@',\r\n         key: '@',\r\n      },\r\n      template: function(element, attributes) {\r\n         var template = '<div>';\r\n         template += '   <input class=\"form-control\" ng-model=\"phrase\" ng-model-options=\"{ debounce: 150 }\" placeholder=\"' + attributes.placeholder + '\" type=\"text\" ng-focus=\"onFocus()\">';\r\n         template += '   <ul class=\"form-autocomplete\" ng-show=\"items.length\">';\r\n         template += '       <li ng-repeat=\"item in items\" ng-class=\"{ active: active == $index }\" ng-click=\"onSelect(item)\">';\r\n         template += '           <span>{{item.NameA}}<span class=\"token\">{{item.NameB}}</span>{{item.NameC}}</span>';\r\n         template += '       </li>';\r\n         template += '   </ul>';\r\n         template += '</div>';\r\n         return template;\r\n      },\r\n      link: function(scope, element, attributes, model) {\r\n         var onSelected = $parse(attributes.onSelected);\r\n         var input = element.find('input');\r\n         var label = (scope.label ? scope.label : 'name');\r\n         var key = (scope.key ? scope.key : 'id');\r\n         function getPhrase() {\r\n            if (scope.model) {\r\n               return scope.flatten ? scope.model : scope.model[label];\r\n            } else {\r\n               return null;\r\n            }\r\n         }\r\n         scope.phrase = getPhrase();\r\n         scope.count = 0;\r\n         scope.items = [];\r\n         scope.active = -1;\r\n         scope.maxItems = scope.maxItems || Number.POSITIVE_INFINITY;\r\n         function Clear(phrase) {\r\n            scope.items.length = 0;\r\n            scope.count = 0;\r\n            scope.phrase = phrase || null;\r\n            input.val(scope.phrase);\r\n         }\r\n         function Current() {\r\n            var current = null;\r\n            if (scope.active != -1 && scope.items.length > scope.active) {\r\n               current = scope.items[scope.active];\r\n            }\r\n            return current;\r\n         }\r\n         scope.onFocus = function() {\r\n            if (attributes.onFocus !== undefined) {\r\n               scope.$parent.$eval(attributes.onFocus);\r\n            }\r\n            if (input.val() === getPhrase()) {\r\n               input.val(null);\r\n            }\r\n         };\r\n         scope.onBlur = function() {\r\n            if (attributes.onBlur !== undefined) {\r\n               scope.$parent.$eval(attributes.onBlur);\r\n            }\r\n            Clear(getPhrase());\r\n         };\r\n         scope.onSelect = function(item) {\r\n            if (scope.queryable) {\r\n               scope.service.setItem(item).then(function(parsedItem) {\r\n                  onSelected({ $item: parsedItem }, scope.$parent, { $event: {} });\r\n                  $timeout(function() {\r\n                     if (scope.flatten) {\r\n                        scope.model = parsedItem[key];\r\n                     } else {\r\n                        scope.model = scope.model || {};\r\n                        angular.extend(scope.model, parsedItem);\r\n                     }\r\n                     scope.onBlur();\r\n                  }, 1);\r\n               });\r\n            } else {\r\n               onSelected({ $item: item }, scope.$parent, { $event: {} });\r\n               if (scope.flatten) {\r\n                  scope.model = item[key];\r\n               } else {\r\n                  scope.model = scope.model || {};\r\n                  angular.extend(scope.model, item);\r\n               }\r\n               scope.onBlur();\r\n            }\r\n         };\r\n         function onTyping(phrase) {\r\n            if (scope.canCreate) {\r\n               if (scope.flatten) {\r\n                  if (key === label) {\r\n                     scope.model = phrase;\r\n                  }\r\n               } else {\r\n                  scope.model = {};\r\n                  scope.model[label] = phrase;\r\n               }\r\n            }\r\n         };\r\n         function Enter() {\r\n            var item = Current();\r\n            if (item) {\r\n               scope.onSelect(item);\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Up() {\r\n            scope.active--;\r\n            if (scope.active < 0) {\r\n               scope.active = scope.items.length - 1;\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Down() {\r\n            scope.active++;\r\n            if (scope.items.length == 0) {\r\n               scope.active = -1;\r\n            } else if (scope.active >= scope.items.length) {\r\n               scope.active = 0;\r\n            }\r\n            scope.$apply();\r\n         }\r\n         function Parse(data) {\r\n            scope.items = data.items;\r\n            scope.count = data.count;\r\n            angular.forEach(scope.items, function(value, index) {\r\n               var name = value[label];\r\n               var i = name.toLowerCase().indexOf(scope.phrase.toLowerCase());\r\n               value.NameA = name.substr(0, i);\r\n               value.NameB = name.substr(i, scope.phrase.length);\r\n               value.NameC = name.substr(i + scope.phrase.length, name.length - (i + scope.phrase.length));\r\n            });\r\n         }\r\n         function Filter(data) {\r\n            var c = 0, i = [];\r\n            if (scope.phrase.length > 1) {\r\n               angular.forEach(data.items, function(value, index) {\r\n                  var name = value[label];\r\n                  if (name.toLowerCase().indexOf(scope.phrase.toLowerCase()) !== -1) {\r\n                     if (i.length < MAX_ITEMS) {\r\n                        i.push(value);\r\n                     }\r\n                     c++;\r\n                  }\r\n               });\r\n            }\r\n            Parse({\r\n               count: c,\r\n               items: i\r\n            });\r\n         }\r\n         function Search() {\r\n            scope.phrase = input.val();\r\n            scope.active = -1;\r\n            onTyping(scope.phrase);\r\n            if (scope.queryable) {\r\n               scope.service.setPhrase(scope.phrase).then(function(success) {\r\n                  scope.items = success.items;\r\n                  scope.count = success.count;\r\n               }, function(error) {\r\n                  console.log('Search.queryable.error', scope.phrase, error);\r\n               }).finally(function() {\r\n\r\n               });\r\n            } else {\r\n               Filter({\r\n                  count: scope.service.length,\r\n                  items: scope.service\r\n               });\r\n               scope.$apply();\r\n            }\r\n         }\r\n         function onKeyDown(e) {\r\n            switch (e.keyCode) {\r\n               case 9: // Tab\r\n               case 13: // Enter\r\n                  Enter();\r\n                  if (scope.items.length) {\r\n                     e.preventDefault ? e.preventDefault() : null;\r\n                     return false;\r\n                  }\r\n                  break;\r\n               case 38: // Up\r\n                  Up();\r\n                  break;\r\n               case 40: // Down\r\n                  Down();\r\n                  break;\r\n            }\r\n         }\r\n         function onKeyUp(e) {\r\n            switch (e.keyCode) {\r\n               case 9: // Tab\r\n               case 13: // Enter\r\n                  break;\r\n               case 39: // Right\r\n                  break;\r\n               case 37: // Left\r\n                  break;\r\n               case 38: // Up\r\n                  break;\r\n               case 40: // Down\r\n                  break;\r\n               default: // Text\r\n                  Search.call(this);\r\n                  break;\r\n            }\r\n         }\r\n         function onUp(e) {\r\n            if (Utils.getClosest(e.target, '[control-autocomplete]') === null) {\r\n               scope.$apply(function() {\r\n                  scope.onBlur();\r\n               });\r\n            }\r\n            return true;\r\n         }\r\n         function addListeners() {\r\n            input.on('keydown', onKeyDown);\r\n            input.on('keyup', onKeyUp);\r\n            angular.element($window).on('mouseup touchend', onUp);\r\n         };\r\n         function removeListeners() {\r\n            input.off('keydown', onKeyDown);\r\n            input.off('keyup', onKeyUp);\r\n            angular.element($window).off('mouseup touchend', onUp);\r\n         };\r\n         scope.$on('$destroy', function() {\r\n            removeListeners();\r\n         });\r\n         var init = false;\r\n         function Init() {\r\n            if (!init) {\r\n               addListeners();\r\n               init = true;\r\n            }\r\n         }\r\n         scope.$watch('service', function(newValue) {\r\n            if (newValue && (newValue.length || scope.queryable)) {\r\n               Init();\r\n            }\r\n         });\r\n         scope.$watchCollection('model', function(newValue) {\r\n            if (newValue) {\r\n               if (scope.flatten && label === key) {\r\n                  scope.phrase = newValue;\r\n                  input.val(scope.phrase);\r\n               } else if (newValue[label]) {\r\n                  scope.phrase = newValue[label];\r\n                  input.val(scope.phrase);\r\n               }\r\n            }\r\n         });\r\n      },\r\n   };\r\n}]);\r\n\r\n/**\r\n   * @ngdoc directive\r\n   * @name validateType\r\n   * @kind function\r\n   * @requires ngModel\r\n   *\r\n   * @description\r\n   * Custom validation type for ngModel\r\n   *\r\n   * @param {string} [validateType=number] the type of custom validation\r\n   *\r\n   * @example\r\n\t<example module=\"examples\">\r\n\t\t<file name=\"index.html\">\r\n\t\t\t<form name=\"myForm\">\r\n\t\t\t\t<input name=\"myValue\" type=\"text\" ng-model=\"model\" validate-type=\"number\" />\r\n\t\t\t\t<span ng-messages=\"(myForm.$submitted || myForm.$touched) && myForm.myValue.$error\" role=\"alert\">\r\n\t\t\t\t\t<span ng-message=\"number\" class=\"label-error animated flash\"> &larr; enter a valid number</span>\r\n\t\t\t\t</span>\r\n\t\t\t</form>\r\n\t\t</file>\r\n\t\t<file name=\"script.js\">\r\n\t\t\tangular.module('examples', ['wsUtils']);\r\n\t\t</file>\r\n\t</example>\r\n*/\r\napp.directive('validateType', function() {\r\n   return {\r\n      require: 'ngModel',\r\n      link: function(scope, element, attributes, model) {\r\n         var type = attributes.validateType;\r\n         switch (type) {\r\n            case 'number':\r\n               model.$parsers.unshift(function(value) {\r\n                  model.$setValidity(type, String(value).indexOf(Number(value).toString()) !== -1);\r\n                  return value;\r\n               });\r\n               break;\r\n         }\r\n      }\r\n   };\r\n});\r\n\n/*global angular,FB */\r\n\r\napp.value('UserRoles', [{\r\n    name: 'Guest', id: 1\r\n}, {\r\n    name: 'User', id: 2\r\n}, {\r\n    name: 'Supervisor', id: 3\r\n}, {\r\n    name: 'Admin', id: 4\r\n}]);\r\n\r\napp.value('UserRolesEnum', {\r\n    'Guest': 1,\r\n    'User': 2,\r\n    'Supervisor': 3,\r\n    'Admin': 4,\r\n});\r\n\r\napp.factory('User', ['UserRolesEnum', function (UserRolesEnum) {\r\n    function User(data) {\r\n        // Extend instance with data\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    User.prototype = {\r\n        // If user instance is in role Administrator\r\n        isAdmin: function () {\r\n            return this.role === UserRolesEnum.Admin;\r\n        },\r\n        // If user parameters equals user instance\r\n        isUser: function (user) {\r\n            return this.email === user.email;\r\n        },\r\n        picture: function (size) {\r\n          size = size || 'sm';\r\n          var w;\r\n          switch(size) {\r\n              case 'sm':\r\n                w = 50;\r\n              break;\r\n              case 'md':\r\n                w = 300;\r\n              break;\r\n              default:\r\n          }\r\n          return this.facebookId ? 'https://graph.facebook.com/'+ this.facebookId +'/picture?width=' + w + '&height=' + w + '&type=square' : '/img/avatar-default.png';\r\n        },\r\n        backgroundPicture: function(size) {\r\n            return 'background-image: url(' + this.picture(size) + ');';\r\n        },\r\n    };\r\n    return User;\r\n}]);\r\n\r\napp.factory('Post', ['$q', '$http', '$timeout', 'APP', 'User', 'Dish', 'Upload', function($q, $http, $timeout, APP, User, Dish, Upload) {\r\n\r\n\tfunction Post(data) {\r\n        data ? angular.extend(this, data) : null;\r\n        this.user = new User(this.user);\r\n        this.dish = new Dish(this.dish);\r\n    }\r\n    Post.prototype = {\r\n\t\tupload: function(file) {\r\n            console.log('Post.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function (response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function (response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function (event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Post;\r\n\r\n}]);\r\n\r\napp.factory('Dish', ['$q', '$http', '$timeout', 'APP', 'User', 'Upload', function($q, $http, $timeout, APP, User, Upload) {\r\n\r\n\tfunction Dish(data) {\r\n        this.extend(data);\r\n    }\r\n    Dish.prototype = {\r\n        extend: function(data) {\r\n            data ? angular.extend(this, data) : null;\r\n            this.user = new User(this.user);\r\n            if (this.votes) {\r\n                angular.forEach(this.votes, function(vote) {\r\n                    vote.user = new User(vote.user);\r\n                });\r\n            }\r\n        },\r\n\t\tlike: function(like) {\r\n            var self = this;\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/vote', { dishId: this.id, like: like }).then(function success(response) {\r\n                self.extend(response.data);\r\n                deferred.resolve(response);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n\t\t},\r\n\t\tupload: function(file) {\r\n            console.log('Dish.upload', this.id, file);\r\n            var self = this;\r\n            var name = file.name.substr(0, file.name.lastIndexOf('.'));\r\n            var extension = file.name.substr(file.name.lastIndexOf('.'));\r\n            console.log('onUpload', name, extension);\r\n            var uploadData = {\r\n                model: this,\r\n                id: this.id,\r\n                assetType: 1,\r\n                name: name,\r\n                extension: extension,\r\n                progress: 0,\r\n            };\r\n            this.uploads = this.uploads || [];\r\n            this.uploads.push(uploadData);\r\n            Upload.upload({\r\n                url: APP.API + 'api/assets/',\r\n                data: { file: file, uploadData: JSON.stringify(uploadData) }\r\n            }).then(function success(response) {\r\n                console.log('Success ' + response.config.data.file.name + ' uploaded. Response: ' + response.data);\r\n                self.pictures = (self.pictures || []).concat(response.data);\r\n                uploadData.progress = 100;\r\n                $timeout(function () {\r\n                    var has = -1;\r\n                    angular.forEach(self.uploads, function (upload, i) {\r\n                        if (upload === uploadData) {\r\n                            has = i;\r\n                        }\r\n                    });\r\n                    if (has != -1) {\r\n                        self.uploads.splice(has, 1);\r\n                    }\r\n                }, 2000);\r\n            }, function error(response) {\r\n                console.log('Error status: ' + response.status);\r\n                uploadData.progress = 0;\r\n            }, function progress(event) {\r\n                if (event.config.data.file) {\r\n                    var progressPercentage = Math.round(100.0 * event.loaded / event.total);\r\n                    uploadData.progress = progressPercentage;\r\n                    console.log('progress: ' + progressPercentage + '% ' + event.config.data.file.name);\r\n                }\r\n            });\r\n\t\t},\r\n\t\tvoteCount: function() {\r\n\t\t\treturn this.yes + this.no;\r\n\t\t},\r\n\t\trating: function() {\r\n\t\t\tvar count = this.voteCount();\r\n\t\t\treturn count > 0 ? this.yes / count : 0;\r\n\t\t},\r\n        ratingToString: function() {\r\n\t\t\tvar rating = this.rating();\r\n\t\t\treturn rating > 0 ? Math.round( rating * 100 ) / 10 : '0.0';\r\n\t\t},\r\n    };\r\n    return Dish;\r\n\r\n}]);\r\n\r\napp.factory('Vector', function() {\r\n\tfunction Vector(x, y) {\r\n        this.x = x || 0;\r\n        this.y = y || 0;\r\n    }\r\n    Vector.make = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.size = function (a) {\r\n        return Math.sqrt(a.x * a.x + a.y * a.y);\r\n    };\r\n    Vector.normalize = function (a) {\r\n        var l = Vector.size(a);\r\n        a.x /= l;\r\n        a.y /= l;\r\n        return a;\r\n    };\r\n    Vector.incidence = function (a, b) {\r\n        var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n        // if (angle < 0) angle += 2 * Math.PI;\r\n        // angle = Math.min(angle, (Math.PI * 2 - angle));\r\n        return angle;\r\n    };\r\n    Vector.distance = function (a, b) {\r\n        return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n    };\r\n    Vector.cross = function (a, b) {\r\n        return (a.x * b.y) - (a.y * b.x);\r\n    };\r\n    Vector.difference = function (a, b) {\r\n        return new Vector(b.x - a.x, b.y - a.y);\r\n    };\r\n    Vector.prototype = {\r\n        size: function () {\r\n            return Vector.size(this);\r\n        },\r\n        normalize: function () {\r\n            return Vector.normalize(this);\r\n        },\r\n        incidence: function (b) {\r\n            return Vector.incidence(this, b);\r\n        },\r\n        cross: function (b) {\r\n            return Vector.cross(this, b);\r\n        },\r\n        towards: function (b, friction) {\r\n            friction = friction || 0.125;\r\n            this.x += (b.x - this.x) * friction;\r\n            this.y += (b.y - this.y) * friction;\r\n            return this;\r\n        },\r\n        add: function (b) {\r\n            this.x += b.x;\r\n            this.y += b.y;\r\n            return this;\r\n        },\r\n        friction: function (b) {\r\n            this.x *= b;\r\n            this.y *= b;\r\n            return this;\r\n        },\r\n        copy: function (b) {\r\n            return new Vector(this.x, this.y);\r\n        },\r\n        toString: function () {\r\n            return '{' + this.x + ',' + this.y + '}';\r\n        },\r\n    };\r\n    return Vector;\r\n});\r\n\n/*global angular,FB */\r\n\r\napp.factory('FacebookService', ['$q', 'APP', function ($q, APP) {\r\n\r\n    function FacebookService() {\r\n\r\n    }\r\n\r\n    function onFacebookStatus(response, deferred) {\r\n        FacebookService.authResponse = null;\r\n        if (response.status === 'connected') {\r\n            FacebookService.authResponse = response.authResponse;\r\n            deferred.resolve(response);\r\n        } else if (response.status === 'not_authorized') {\r\n            deferred.reject(response);\r\n        } else {\r\n            deferred.reject(response);\r\n        }\r\n    }\r\n\r\n    FacebookService.FB = function () {\r\n        var deferred = $q.defer();\r\n        if (window['FB'] !== undefined) {\r\n            deferred.resolve(window['FB']);\r\n        } else {\r\n            FacebookService.init().then(function (success) {\r\n                deferred.resolve(window['FB']);\r\n            }, function (error) {\r\n                deferred.reject(error);\r\n            })\r\n        }\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.getFacebookMe = function () {\r\n        var deferred = $q.defer();\r\n        FacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me', { fields: 'id,name,first_name,last_name,email,gender,picture,cover,link' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.getPictureMe = function () {\r\n        var deferred = $q.defer();\r\n        FacebookService.FB().then(function (facebook) {\r\n            facebook.api('/me/picture', { width: 300, height: 300, type: 'square' }, function (response) {\r\n                if (!response || response.error) {\r\n                    deferred.reject('Error occured');\r\n                } else {\r\n                    deferred.resolve(response);\r\n                }\r\n            });\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    FacebookService.login = function () {\r\n        var deferred = $q.defer();\r\n        var isMobile = false;\r\n        try {\r\n            isMobile = window.navigator.standalone; // (window.location.href == top.location.href && window.location.href.indexOf(\"/mobile/\") !== -1);\r\n        } catch (e) { }\r\n        if (!isMobile) {\r\n            FacebookService.FB().then(function (facebook) {\r\n                facebook.login(function (response) {\r\n                    onFacebookStatus(response, deferred);\r\n                }, {\r\n                        scope: 'public_profile,email' // publish_stream,\r\n                    });\r\n            });\r\n        } else {\r\n            var permissionUrl = \"https://m.facebook.com/dialog/oauth?client_id=\" + APP.FACEBOOK_APP_ID + \"&response_type=code&redirect_uri=\" + APP.CLIENT + \"&scope=\" + 'public_profile,email';\r\n            window.location.href = permissionUrl;\r\n            return;\r\n        }\r\n        /*\r\n        FacebookService.FB().then(function(facebook) {\r\n            facebook.login(function(response) {\r\n                onFacebookStatus(response, deferred);\r\n            }, {\r\n                scope: 'public_profile,email' // publish_stream,\r\n                , redirect_uri: APP.CLIENT\r\n            });\r\n        });\r\n        */\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.logout = function () {\r\n        var deferred = $q.defer();\r\n        FacebookService.FB().then(function (facebook) {\r\n            facebook.logout(function (response) {\r\n                deferred.resolve(response);\r\n            });\r\n        });\r\n        return deferred.promise;\r\n    }\r\n\r\n    FacebookService.init = function () {\r\n        var deferred = $q.defer();\r\n        window.fbAsyncInit = function () {\r\n            FB.init({\r\n                appId: APP.FACEBOOK_APP_ID,\r\n                status: true,\r\n                cookie: true,\r\n                xfbml: true,\r\n                version: 'v2.5'\r\n            });\r\n            FB.getLoginStatus(function (response) {\r\n                onFacebookStatus(response, deferred);\r\n            });\r\n        };\r\n\r\n        try {\r\n            (function (d, s, id) {\r\n                var js, fjs = d.getElementsByTagName(s)[0];\r\n                if (d.getElementById(id)) { return; }\r\n                js = d.createElement(s); js.id = id;\r\n                js.src = \"//connect.facebook.net/en_US/sdk.js\";\r\n                fjs.parentNode.insertBefore(js, fjs);\r\n            } (document, 'script', 'facebook-jssdk'));\r\n        } catch (e) {\r\n            deferred.reject(e);\r\n        }\r\n        return deferred.promise;\r\n    }\r\n\r\n    return FacebookService;\r\n\r\n}]);\r\n\r\n/** USERS SERVICE **/\r\napp.factory('Users', ['$q', '$http', '$httpAsync', '$location', '$timeout', 'APP', 'LocalStorage', 'User', function ($q, $http, $httpAsync, $location, $timeout, APP, LocalStorage, User) {\r\n\r\n    // PRIVATE VARIABLE FOR CURRENT USER\r\n    var _currentUser = null;\r\n\r\n    function Users() {\r\n    }\r\n\r\n    Users.prototype = {\r\n    };\r\n\r\n    // STATIC CLASS METHODS\r\n    Users.currentUser = function () {\r\n        return _currentUser;\r\n    };\r\n\r\n    Users.getCurrentUser = function () {\r\n        var deferred = $q.defer();\r\n        if (_currentUser) {\r\n            deferred.resolve(_currentUser);\r\n        } else {\r\n            $http.get(APP.API + '/api/users/current/').then(function success(response) {\r\n                if (response && response.data) {\r\n                    _currentUser = new User(response.data);\r\n                    deferred.resolve(_currentUser);\r\n                } else {\r\n                    deferred.resolve(null); // deferred.reject(null);\r\n                }\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n        }\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isLogged = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            user && user.isAuthenticated ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isAdmin = function () {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            user && user.isAuthenticated && user.isAdmin ? deferred.resolve(user) : deferred.reject();\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isLoggedOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.isAdminOrGoTo = function(redirect) {\r\n        var deferred = $q.defer();\r\n        Users.getCurrentUser().then(function (user) {\r\n            // console.log('Users.isLogged.success', user);\r\n            if (user && user.isAuthenticated && user.isAdmin) {\r\n                deferred.resolve(user);\r\n            } else {\r\n                deferred.reject();\r\n                $location.path(redirect);\r\n            }\r\n        }, function error(response) {\r\n            // console.log('Users.isLogged.error', data);\r\n            deferred.reject(response);\r\n            $location.path(redirect);\r\n        })\r\n        return deferred.promise;\r\n    },\r\n\r\n    /** LOGIN METHODS **/\r\n    Users.signup = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signup/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signin = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signin/', model).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signInWithFacebook = function (auth) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/users/signinwithfacebook/', auth).then(function success(response) {\r\n            _currentUser = new User(response.data);\r\n            deferred.resolve(_currentUser);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.signout = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/signout/').then(function success(response) {\r\n            _currentUser = null;\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Users.detail = function (userRoute) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/users/route/' + userRoute).then(function success(response) {\r\n            deferred.resolve(new User(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Users;\r\n}]);\r\n\r\napp.factory('Categories', ['$http', '$q', 'APP', function ($http, $q, APP) {\r\n\r\n    function Categories() {\r\n    }\r\n\r\n    Categories.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/').then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Categories.detail = function (categoryId) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/categories/' + categoryId).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Categories;\r\n}]);\r\n\r\napp.factory('DishesTest', ['APP', 'Dish', function (APP, Dish) {\r\n\r\n    var uniqueId = 100;\r\n\r\n    function getRandomItems() {\r\n        var items = [];\r\n        while (items.length < 10) {\r\n            items.push({\r\n                id: uniqueId,\r\n                name: 'dish ' + uniqueId,\r\n                price: 3.20,\r\n                yes: Math.floor(Math.random() * 999),\r\n                no: Math.floor(Math.random() * 999),\r\n                pictures: [{\r\n                    route: 'http://lorempixel.com/750/375/food/' + (1 + uniqueId % 10), // 'http://placehold.it/750x375',\r\n                }],\r\n                user: {\r\n                    userName: 'User',\r\n                }\r\n            });\r\n            uniqueId++;\r\n        }\r\n        return items;\r\n    }\r\n\r\n    function TestSource() {\r\n    }\r\n    TestSource.uri = {\r\n        paging: false,\r\n    };\r\n    TestSource.resolve = function (rows) {\r\n        var items = getRandomItems();\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n\r\n    return TestSource;\r\n}]);\r\n\r\napp.factory('Posts', ['$http', '$q', 'APP', 'Post', function ($http, $q, APP, Post) {\r\n\r\n    function Posts() {\r\n    }\r\n    Posts.uri = {\r\n        paging: APP.API + '/api/stream/paged',\r\n    };\r\n    Posts.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Post(item));\r\n        }, rows);\r\n    };\r\n\r\n    Posts.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/post/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Posts;\r\n}]);\r\n\r\napp.factory('Dishes', ['$http', '$q', 'APP', 'Dish', function ($http, $q, APP, Dish) {\r\n\r\n    function Dishes() {\r\n    }\r\n    Dishes.uri = {\r\n        paging: APP.API + '/api/dishes/paged',\r\n    };\r\n    Dishes.resolve = function (items, rows) {\r\n        angular.forEach(items, function (item) {\r\n            this.push(new Dish(item));\r\n        }, rows);\r\n    };\r\n\r\n    Dishes.detail = function (id) {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/' + id).then(function success(response) {\r\n            deferred.resolve(new Dish(response.data));\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Dishes.add = function (model) {\r\n        var deferred = $q.defer();\r\n        $http.post(APP.API + '/api/dishes/', model).then(function success(response) {\r\n            deferred.resolve(response.data);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    Dishes.get = function () {\r\n        var deferred = $q.defer();\r\n        $http.get(APP.API + '/api/dishes/').then(function success(response) {\r\n            var rows = [];\r\n            angular.forEach(response.data, function (item) {\r\n                this.push(new Dish(item));\r\n            }, rows);\r\n            deferred.resolve(rows);\r\n        }, function error(response) {\r\n            deferred.reject(response);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n\r\n    return Dishes;\r\n}]);\r\n\r\napp.factory('DishesAutocomplete', ['$q', '$http', '$timeout', 'APP', function ($q, $http, $timeout, APP) {\r\n\r\n    var MAX_ITEMS = 5;\r\n\r\n    function DishesAutocomplete() {\r\n    }\r\n\r\n    DishesAutocomplete.prototype = {\r\n        setPhrase: function (phrase) {\r\n            // console.log('DishesAutocomplete.setPhrase', phrase);\r\n            var deferred = $q.defer();\r\n            $http.post(APP.API + '/api/dishes/autocomplete', { phrase: phrase }).then(function success(response) {\r\n                var data = {\r\n                    items: [],\r\n                    count: response.data.length,\r\n                };\r\n                angular.forEach(response.data, function (v, i) {\r\n                    if (i < MAX_ITEMS) {\r\n                        var value = {\r\n                            id: v.id,\r\n                            name: v.name,\r\n                        };\r\n                        var offset = v.name.toLowerCase().indexOf(phrase.toLowerCase());\r\n                        var length = phrase.length;\r\n                        value.NameA = value.name.substr(0, offset);\r\n                        value.NameB = value.name.substr(offset, length);\r\n                        value.NameC = value.name.substr(offset + length, value.name.length - (offset + length));\r\n                        data.items.push(value);\r\n                    }\r\n                });\r\n                deferred.resolve(data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n        setItem: function (item) {\r\n            var deferred = $q.defer();\r\n            $http.get(APP.API + '/api/dishes/' + item.id).then(function success(response) {\r\n                console.log('autoComplete.setItem', response.data);\r\n                deferred.resolve(response.data);\r\n            }, function error(response) {\r\n                deferred.reject(response);\r\n            });\r\n            return deferred.promise;\r\n        },\r\n    };\r\n\r\n    return DishesAutocomplete;\r\n\r\n}]);\r\n\r\napp.factory('DataFilter', [function () {\r\n    function DataFilter(data) {\r\n        /*\r\n        this.dateFrom = null;\r\n        this.dateTo = null;\r\n        this.search = null;\r\n        this.status = null;\r\n        */\r\n        data ? angular.extend(this, data) : null;\r\n    }\r\n    DataFilter.prototype = {\r\n        getSearchParams: function (search) {\r\n            var a = [];\r\n            if (search) {\r\n                for (var p in search) {\r\n                    a.push({ name: p, value: search[p] });\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        getParams: function (source, infinite) {\r\n            var post = {}, value;\r\n            for (var p in this) {\r\n                if (p === 'dateFrom' ||\r\n                    p === 'dateTo' ||\r\n                    p === 'status') {\r\n                    value = this[p];\r\n                    if (value !== undefined) {\r\n                        post[p] = value;\r\n                    }\r\n                } else if (p === 'search') {\r\n                    post[p] = JSON.stringify(this.getSearchParams(this[p]), null, '');\r\n                }\r\n            }\r\n            post.page = source.page;\r\n            post.size = source.size;\r\n            post.infinite = infinite;\r\n            return post;\r\n        },\r\n    };\r\n    return DataFilter;\r\n}]);\r\n\r\napp.factory('DataSource', ['$q', '$http', '$httpAsync', '$timeout', '$rootScope', 'DataFilter', function ($q, $http, $httpAsync, $timeout, $rootScope, DataFilter) {\r\n\r\n    var PAGES_MAX = Number.POSITIVE_INFINITY;\r\n\r\n    function DataSource(data) {\r\n        this.busy = false;\r\n        this.error = false;\r\n        this.size = 10;\r\n        this.maxPages = 10;\r\n        this.rows = [];\r\n        this.filters = {};\r\n        this.service = {\r\n            url: '/api/items/paging',\r\n            resolve: function (items, rows) {\r\n                angular.forEach(items, function (item) {\r\n                    this.push(item);\r\n                }, rows);\r\n            },\r\n        };\r\n        data ? angular.extend(this, data) : null;\r\n        this.filters = new DataFilter(this.filters);\r\n        // FAKE SERVICE FOR TEST !!!\r\n        if (this.service.uri.paging === false) {\r\n            this.get = function (deferred, infinite) {\r\n                this.busy = true;\r\n                this.error = false;\r\n                $timeout(function () {\r\n                    infinite ? null : this.rows.length = 0;\r\n                    this.service.resolve(this.rows);\r\n                    this.page = 1;\r\n                    this.pages = 2;\r\n                    this.count = this.rows.length;\r\n                    this.pagination = this.getPages();\r\n                    this.busy = false;\r\n                    $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                    deferred.resolve(this.rows);\r\n                    // console.log('DataSource.get');\r\n                }.bind(this), 1000);\r\n            };\r\n        }\r\n        this.flush();\r\n    }\r\n    DataSource.prototype = {\r\n        flush: function () {\r\n            this.pages = PAGES_MAX;\r\n            this.page = 1;\r\n            this.count = 0;\r\n            this.opened = null;\r\n        },\r\n        resolve: function (response) {\r\n            var responseHeader = response.headers('X-Pagination');\r\n            var responseView = responseHeader ? JSON.parse(responseHeader) : null;\r\n            // console.log('response', response, 'responseHeader', responseHeader, 'responseView', responseView);\r\n            if (responseView) {\r\n                this.page = responseView.page;\r\n                this.size = responseView.size;\r\n                this.pages = responseView.pages;\r\n                this.count = responseView.count;\r\n            } else {\r\n                this.page = 0;\r\n                this.size = responseView.size;\r\n                this.pages = 0;\r\n                this.count = 0;\r\n            }\r\n            this.pagination = this.getPages();\r\n        },\r\n        get: function (deferred, infinite) {\r\n            this.busy = true;\r\n            this.error = false;\r\n            $httpAsync.get(this.service.uri.paging, { params: this.filters.getParams(this) }).then(function success(response) {\r\n                this.resolve(response);\r\n                infinite ? null : this.rows.length = 0;\r\n                this.service.resolve(response.data, this.rows);\r\n                $rootScope.$broadcast('onDataSourceUpdate', this);\r\n                deferred.resolve(this.rows);\r\n            }.bind(this), function error(response) {\r\n                console.log('error.response', response);\r\n                this.error = true;\r\n                deferred.reject(response);\r\n            }.bind(this))\r\n                .finally(function () {\r\n                    // console.log('DataSource.get');\r\n                    $timeout(function () {\r\n                        this.busy = false;\r\n                    }.bind(this), 1000);\r\n                }.bind(this));\r\n        },\r\n        paging: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.paging');\r\n                this.opened = null;\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        refresh: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.refresh');\r\n                this.flush();\r\n                this.get(deferred);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        more: function () {\r\n            var deferred = $q.defer();\r\n            if (this.busy || this.page + 1 > this.pages) {\r\n                deferred.reject();\r\n            } else {\r\n                // console.log('DataSource.more');\r\n                this.page++;\r\n                this.get(deferred, true);\r\n            }\r\n            return deferred.promise;\r\n        },\r\n        filter: function () {\r\n            this.page = 1;\r\n            this.pages = PAGES_MAX;\r\n            this.paging();\r\n        },\r\n        prevPage: function () {\r\n            var page = this.page - 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        nextPage: function () {\r\n            var page = this.page + 1;\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        gotoPage: function (page) {\r\n            if (page > 0 && page <= this.pages) {\r\n                this.page = page;\r\n                this.paging();\r\n            }\r\n        },\r\n        firstPage: function () {\r\n            if (this.page !== 1) {\r\n                this.page = 1;\r\n                this.paging();\r\n            }\r\n        },\r\n        lastPage: function () {\r\n            if (this.page !== this.pages) {\r\n                this.page = this.pages;\r\n                this.paging();\r\n            }\r\n        },\r\n        hasMany: function () {\r\n            return this.count > 0 && this.pages > this.maxPages;\r\n        },\r\n        hasMorePagesBehind: function () {\r\n            var startingIndex = Math.max(0, this.page - this.maxPages);\r\n            return startingIndex > 0;\r\n        },\r\n        hasMorePagesNext: function () {\r\n            var endingIndex = Math.max(0, this.page - this.maxPages) + this.maxPages;\r\n            return endingIndex < this.pages;\r\n        },\r\n        isPage: function (number) {\r\n            return this.page === number;\r\n        },\r\n        hasPages: function () {\r\n            return this.pages > 0 && this.pages < PAGES_MAX;\r\n        },\r\n        getPages: function () {\r\n            var a = [], i;\r\n            if (this.hasPages()) {\r\n                var startingIndex = Math.max(0, this.page - this.maxPages);\r\n                var endingIndex = Math.min(this.pages, startingIndex + this.maxPages);\r\n                i = startingIndex;\r\n                while (i < endingIndex) {\r\n                    a.push({ number: (i + 1) });\r\n                    i++;\r\n                }\r\n            }\r\n            return a;\r\n        },\r\n        openClose: function (index) {\r\n            if (this.opened === index) {\r\n                this.opened = null;\r\n            } else {\r\n                this.opened = index;\r\n            }\r\n        }\r\n    };\r\n    return DataSource;\r\n}]);\r\n\r\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\r\n    function Cookie() {\r\n    }\r\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\r\n    Cookie._set = function (name, value, days) {\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n            var expires = \"; expires=\" + date.toGMTString();\r\n        } else {\r\n            var expires = \"\";\r\n        }\r\n        $window.document.cookie = name + \"=\" + value + expires + \"; path=/\";\r\n    }\r\n    Cookie.set = function (name, value, days) {\r\n        try {\r\n            var cache = [];\r\n            var json = JSON.stringify(value, function (key, value) {\r\n                if (key === 'pool') {\r\n                    return;\r\n                }\r\n                if (typeof value === 'object' && value !== null) {\r\n                    if (cache.indexOf(value) !== -1) {\r\n                        // Circular reference found, discard key\r\n                        return;\r\n                    }\r\n                    cache.push(value);\r\n                }\r\n                return value;\r\n            });\r\n            cache = null;\r\n            Cookie._set(name, json, days);\r\n        } catch (e) {\r\n            console.log('Cookie.set.error serializing', name, value, e);\r\n        }\r\n    };\r\n    Cookie.get = function (name) {\r\n        var cookieName = name + \"=\";\r\n        var ca = $window.document.cookie.split(';');\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) == ' ') {\r\n                c = c.substring(1, c.length);\r\n            }\r\n            if (c.indexOf(cookieName) == 0) {\r\n                var value = c.substring(cookieName.length, c.length);\r\n                var data = null;\r\n                try {\r\n                    data = JSON.parse(value);\r\n                } catch (e) {\r\n                    console.log('Cookie.get.error parsing', key, e);\r\n                };\r\n                return data;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    Cookie.delete = function (name) {\r\n        Cookie._set(name, \"\", -1);\r\n    };\r\n    Cookie.on = function (name) {\r\n        var deferred = $q.defer();\r\n        var i, interval = 1000, elapsed = 0, timeout = Cookie.TIMEOUT;\r\n        function checkCookie() {\r\n            if (elapsed > timeout) {\r\n                deferred.reject('timeout');\r\n            } else {\r\n                var c = Cookie.get(name);\r\n                if (c) {\r\n                    deferred.resolve(c);\r\n                } else {\r\n                    elapsed += interval;\r\n                    i = setTimeout(checkCookie, interval);\r\n                }\r\n            }\r\n        }\r\n        checkCookie();\r\n        return deferred.promise;\r\n    };\r\n    return Cookie;\r\n}]);\r\n\r\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\r\n    function LocalStorage() {\r\n    }\r\n    function isLocalStorageSupported() {\r\n        var supported = false;\r\n        try {\r\n            supported = 'localStorage' in $window && $window['localStorage'] !== null;\r\n            if (supported) {\r\n                $window.localStorage.setItem('test', '1');\r\n                $window.localStorage.removeItem('test');\r\n            } else {\r\n                supported = false;\r\n            }\r\n        } catch (e) {\r\n            supported = false;\r\n        }\r\n        return supported;\r\n    }\r\n    LocalStorage.isSupported = isLocalStorageSupported();\r\n    if (LocalStorage.isSupported) {\r\n        LocalStorage.set = function (name, value) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function (key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                $window.localStorage.setItem(name, json);\r\n            } catch (e) {\r\n                console.log('LocalStorage.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        LocalStorage.get = function (name) {\r\n            var value = null;\r\n            if ($window.localStorage[name] !== undefined) {\r\n                try {\r\n                    value = JSON.parse($window.localStorage[name]);\r\n                } catch (e) {\r\n                    console.log('LocalStorage.get.error parsing', name, e);\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        LocalStorage.delete = function (name) {\r\n            $window.localStorage.removeItem(name);\r\n        };\r\n        LocalStorage.on = function (name) {\r\n            var deferred = $q.defer();\r\n            var i, timeout = Cookie.TIMEOUT;\r\n            function storageEvent(e) {\r\n                // console.log('LocalStorage.on', name, e);\r\n                clearTimeout(i);\r\n                if (e.originalEvent.key == name) {\r\n                    try {\r\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                        deferred.resolve(value);\r\n                    } catch (e) {\r\n                        console.log('LocalStorage.on.error parsing', name, e);\r\n                        deferred.reject('error parsing ' + name);\r\n                    }\r\n                }\r\n            }\r\n            angular.element($window).on('storage', storageEvent);\r\n            i = setTimeout(function () {\r\n                deferred.reject('timeout');\r\n            }, timeout);\r\n            return deferred.promise;\r\n        };\r\n    } else {\r\n        console.log('LocalStorage.unsupported switching to cookies');\r\n        LocalStorage.set = Cookie.set;\r\n        LocalStorage.get = Cookie.get;\r\n        LocalStorage.delete = Cookie.delete;\r\n        LocalStorage.on = Cookie.on;\r\n    }\r\n    return LocalStorage;\r\n}]);\r\n\r\napp.factory('Utils', ['Vector', function (Vector) {\r\n    (function () {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n                                       || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame) {\r\n            window.requestAnimationFrame = function (callback, element) {\r\n                var currTime = new Date().getTime();\r\n                var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n                var id = window.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\r\n                lastTime = currTime + timeToCall;\r\n                return id;\r\n            };\r\n        }\r\n        if (!window.cancelAnimationFrame) {\r\n            window.cancelAnimationFrame = function (id) {\r\n                clearTimeout(id);\r\n            };\r\n        }\r\n    }());\r\n\r\n    var transformProperty = function detectTransformProperty() {\r\n        var transformProperty = 'transform',\r\n            safariPropertyHack = 'webkitTransform';\r\n\t\tvar div = document.createElement(\"DIV\");\r\n        if (typeof div.style[transformProperty] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\r\n                var e = '-' + prefix + '-transform';\r\n                if (typeof div.style[e] !== 'undefined') {\r\n                    transformProperty = e;\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        } else if (typeof div.style[safariPropertyHack] !== 'undefined') {\r\n            transformProperty = '-webkit-transform';\r\n        } else {\r\n            transformProperty = undefined;\r\n        }\r\n        return transformProperty;\r\n    } ();\r\n\r\n    var _isTouch;\r\n    function isTouch() {\r\n        if (!_isTouch) {\r\n            _isTouch = {\r\n                value: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n            }\r\n        }\r\n        // console.log(_isTouch);\r\n        return _isTouch.value;\r\n    }\r\n\r\n    function getTouch(e, previous) {\r\n        var t = new Vector();\r\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\r\n            var touch = null;\r\n            var event = e.originalEvent ? e.originalEvent : e;\r\n            var touches = event.touches.length ? event.touches : event.changedTouches;\r\n            if (touches && touches.length) {\r\n                touch = touches[0];\r\n            }\r\n            if (touch) {\r\n                t.x = touch.pageX;\r\n                t.y = touch.pageY;\r\n            }\r\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\r\n            t.x = e.pageX;\r\n            t.y = e.pageY;\r\n        }\r\n        if (previous) {\r\n            t.s = Vector.difference(previous, t);\r\n        }\r\n        t.type = e.type;\r\n        return t;\r\n    }\r\n\r\n    function getRelativeTouch(element, point) {\r\n        var rect = element[0].getBoundingClientRect();\r\n        var e = new Vector(rect.left,  rect.top);\r\n        return Vector.difference(e, point);\r\n    }\r\n\r\n    function getClosest(el, selector) {\r\n        var matchesFn, parent;\r\n        ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n            if (typeof document.body[fn] == 'function') {\r\n                matchesFn = fn;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        while (el !== null) {\r\n            parent = el.parentElement;\r\n            if (parent !== null && parent[matchesFn](selector)) {\r\n                return parent;\r\n            }\r\n            el = parent;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    var getNow = Date.now || function() {\r\n        return new Date().getTime();\r\n    };\r\n\r\n    function throttle(func, wait, options) {\r\n        // Returns a function, that, when invoked, will only be triggered at most once\r\n        // during a given window of time. Normally, the throttled function will run\r\n        // as much as it can, without ever going more than once per `wait` duration;\r\n        // but if you'd like to disable the execution on the leading edge, pass\r\n        // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n        var context, args, result;\r\n        var timeout = null;\r\n        var previous = 0;\r\n        if (!options) options = {};\r\n        var later = function () {\r\n            previous = options.leading === false ? 0 : getNow();\r\n            timeout = null;\r\n            result = func.apply(context, args);\r\n            if (!timeout) context = args = null;\r\n        };\r\n        return function () {\r\n            var now = getNow();\r\n            if (!previous && options.leading === false) previous = now;\r\n            var remaining = wait - (now - previous);\r\n            context = this;\r\n            args = arguments;\r\n            if (remaining <= 0 || remaining > wait) {\r\n                if (timeout) {\r\n                    clearTimeout(timeout);\r\n                    timeout = null;\r\n                }\r\n                previous = now;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            } else if (!timeout && options.trailing !== false) {\r\n                timeout = setTimeout(later, remaining);\r\n            }\r\n            return result;\r\n        };\r\n    }\r\n\r\n    var Style = function() {\r\n        function Style() {\r\n            this.props = {\r\n                scale: 1,\r\n                hoverScale: 1,\r\n                currentScale: 1,\r\n            }\r\n        }\r\n        Style.prototype = {\r\n            set: function (element) {\r\n                var styles = [];\r\n                angular.forEach(this, function (value, key) {\r\n                    if (key !== 'props')\r\n                        styles.push(key + ':' + value);\r\n                });\r\n                element.style.cssText = styles.join(';') + ';';\r\n            },\r\n            transform: function (transform) {\r\n                this[Utils.transformProperty] = transform;\r\n            },\r\n            transformOrigin: function (x, y) {\r\n                this[Utils.transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n                this[Utils.transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n            },\r\n        };\r\n        return Style;\r\n    }();\r\n\r\n    function Utils() {\r\n    }\r\n\r\n\tUtils.transformProperty = transformProperty;\r\n    Utils.getTouch = getTouch;\r\n    Utils.getRelativeTouch = getRelativeTouch;\r\n    Utils.getClosest = getClosest;\r\n    Utils.throttle = throttle;\r\n    Utils.Style = Style;\r\n\r\n    return Utils;\r\n}]);\r\n\n/*global angular*/\r\n\r\napp.factory('WebWorker', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        window.Worker = function () {\r\n            function Worker(src) {\r\n                var self = this;\r\n                $http.get(src, { transformResponse: function (d, h) { return d } }).then(function success(response) {\r\n                    try {\r\n                        eval('self.o = function(){ function postMessage(e) { self.onmessage({data:e}); }\\n ' + response.data + ' };');\r\n                        self.object = new self.o();\r\n                        self.object.postMessage = function (e) {\r\n                            self.onmessage({data:e});\r\n                        }\r\n                    } catch(e) {\r\n                        console.log(\"Worker error \", e);\r\n                    }\r\n                }, function error(response) {\r\n                    console.log(\"Worker not found\");\r\n                });\r\n            }\r\n            Worker.prototype = {\r\n                onmessage: function (e) {\r\n                    console.log('Worker not implemented');\r\n                },\r\n                postMessage: function (e) {\r\n                    this.object.onmessage({ data: e });\r\n                }\r\n            }\r\n            return Worker;\r\n        } ();\r\n    }\r\n    function WebWorker(src) {\r\n        var self = this;\r\n        this.callbacks = {};\r\n        this.id = 0;\r\n        this.worker = new Worker(src);\r\n        this.worker.onmessage = function (e) {\r\n            self.onmessage(e);\r\n        };\r\n    }\r\n    WebWorker.prototype = {\r\n        parse: function (e) {\r\n            return JSON.parse(e.data);\r\n        },\r\n        stringify: function (data) {\r\n            return JSON.stringify(data);\r\n        },\r\n        onmessage: function (e) {\r\n            var data = this.parse(e);\r\n            var deferred = this.callbacks[data.id];\r\n            if (data.status !== -1) {\r\n                deferred.resolve(data);\r\n            } else {\r\n                deferred.reject(data);\r\n            }\r\n            delete this.callbacks[data.id];\r\n        },\r\n        post: function (data) {\r\n            var deferred = $q.defer();\r\n            data.id = this.id;\r\n            this.callbacks[this.id.toString()] = deferred;\r\n            this.id++;\r\n            this.worker.postMessage(this.stringify(data));\r\n            return deferred.promise;\r\n        },\r\n    };\r\n    WebWorker.isSupported = isWebWorkerSupported;\r\n    return WebWorker;\r\n}]);\r\n\r\napp.factory('$httpAsync', ['$q', '$http', function ($q, $http) {\r\n    var isWebWorkerSupported = (typeof (Worker) !== \"undefined\");\r\n    if (!isWebWorkerSupported) {\r\n        return $http;\r\n    }\r\n    var worker = new Worker('/js/workers/http.min.js');\r\n    var callbacks = {};\r\n    var id = 0;\r\n    var lowercase = function (string) { return isString(string) ? string.toLowerCase() : string; };\r\n    var trim = function (value) {\r\n        return isString(value) ? value.trim() : value;\r\n    };\r\n    function $httpAsync(options) {\r\n        var deferred = $q.defer();\r\n        var wrap = getDefaults(options);\r\n        wrap.id = id.toString();\r\n        console.log('wrap', wrap);\r\n        callbacks[wrap.id] = deferred;\r\n        id++;\r\n        worker.postMessage($httpAsync.stringify(wrap));\r\n        return deferred.promise;\r\n    }\r\n    $httpAsync.get = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'GET',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.delete = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'DELETE',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.head = function (url, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'HEAD',\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.post = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'POST',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.put = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PUT',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.patch = function (url, data, config) {\r\n        return $httpAsync(angular.extend({}, config || {}, {\r\n            method: 'PATCH',\r\n            data: data,\r\n            url: url\r\n        }));\r\n    };\r\n    $httpAsync.parse = function (e) {\r\n        return JSON.parse(e.data);\r\n    };\r\n    $httpAsync.stringify = function (data) {\r\n        return JSON.stringify(data);\r\n    };\r\n    $httpAsync.isSupported = isWebWorkerSupported;\r\n    worker.onmessage = function (e) {\r\n        var wrap = $httpAsync.parse(e);\r\n        console.log('onmessage', wrap);\r\n        var deferred = callbacks[wrap.id];\r\n        var status = wrap.status >= -1 ? wrap.status : 0;\r\n        var getter = headersGetter(wrap.response.headers);\r\n        (isSuccess(status) ? deferred.resolve : deferred.reject)({\r\n            data: wrap.response.data, // !!!! JSON.parse(wrap.response.data),\r\n            headers: getter,\r\n            status: wrap.response.status,\r\n            statusText: wrap.response.statusText,\r\n            config: wrap.config,\r\n        });\r\n        delete callbacks[wrap.id];\r\n    }\r\n    return $httpAsync;\r\n    function isSuccess(status) {\r\n        return 200 <= status && status < 300;\r\n    }\r\n    function createMap() {\r\n        return Object.create(null);\r\n    }\r\n    function isString(value) { return typeof value === 'string'; }\r\n    function parseHeaders(headers) {\r\n        var parsed = createMap(), i;\r\n        function fillInParsed(key, val) {\r\n            if (key) {\r\n                parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;\r\n            }\r\n        }\r\n        if (isString(headers)) {\r\n            var a = headers.split('\\n');\r\n            for (var j = 0; j < a.length; j++) {\r\n                var line = a[j];\r\n                i = line.indexOf(':');\r\n                fillInParsed(lowercase(trim(line.substr(0, i))), trim(line.substr(i + 1)));\r\n            }\r\n        } else if (isObject(headers)) {\r\n            for (var p in headers) {\r\n                fillInParsed(lowercase(p), trim(headers[p]));\r\n            }\r\n        }\r\n        return parsed;\r\n    }\r\n    function headersGetter(headers) {\r\n        var headersObj;\r\n        return function (name) {\r\n            if (!headersObj) headersObj = parseHeaders(headers);\r\n            if (name) {\r\n                var value = headersObj[lowercase(name)];\r\n                if (value === void 0) {\r\n                    value = null;\r\n                }\r\n                return value;\r\n            }\r\n            return headersObj;\r\n        };\r\n    }\r\n    function getDefaults(options) {\r\n        var defaults = {\r\n            method: 'GET',\r\n            withCredentials: false,\r\n            responseType: 'json',\r\n            headers: {},\r\n            config: {}\r\n        }\r\n        defaults.withCredentials = $http.defaults.withCredentials;\r\n        angular.extend(defaults.headers, $http.defaults.headers.common);\r\n        var method = (options.method || defaults.method).toLowerCase();\r\n        if ($http.defaults.headers[method]) {\r\n            angular.extend(defaults.headers, $http.defaults.headers[method]);\r\n        }\r\n        console.log('defaults', $http.defaults);\r\n        // defaults = angular.extend(defaults, $http.defaults);\r\n        /*\r\n    method{string}:                     HTTP method (e.g. 'GET', 'POST', etc)\r\n    url:{string}:                       Absolute or relative URL of the resource that is being requested.\r\n    params:{Object.<string|Object>}:    Map of strings or objects which will be serialized with the paramSerializer and appended as GET parameters.\r\n\r\n    data:{string|Object}:               Data to be sent as the request message data.\r\n    headers:{Object}:                   Map of strings or functions which return strings representing HTTP headers to send to the server. If the return value of a function is null, the header will not be sent. Functions accept a config object as an argument.\r\n\r\n    xsrfHeaderName:{string}:            Name of HTTP header to populate with the XSRF token.\r\n    xsrfCookieName:{string}:            Name of cookie containing the XSRF token.\r\n    transformRequest:{function(data, headersGetter)|Array.<function(data, headersGetter)>}:         transform function or an array of such functions. The transform function takes the http request body and headers and returns its transformed (typically serialized) version. See Overriding the Default Transformations\r\n\r\n    transformResponse:{function(data, headersGetter, status)|Array.<function(data, headersGetter, status)>}:    transform function or an array of such functions. The transform function takes the http response body, headers and status and returns its transformed (typically deserialized) version. See Overriding the Default TransformationjqLiks\r\n\r\n    paramSerializer:{string|function(Object<string,string>):string}:        A function used to prepare the string representation of request parameters (specified as an object). If specified as string, it is interpreted as function registered with the $injector, which means you can create your own serializer by registering it as a service. The default serializer is the $httpParamSerializer; alternatively, you can use the $httpParamSerializerJQLike\r\n\r\n    cache:{boolean|Cache}:              If true, a default $http cache will be used to cache the GET request, otherwise if a cache instance built with $cacheFactory, this cache will be used for caching.\r\n\r\n    timeout:{number|Promise}:           timeout in milliseconds, or promise that should abort the request when resolved.\r\n    withCredentials:{boolean}:          whether to set the withCredentials flag on the XHR object. See requests with credentials for more information.\r\n\r\n    responseType:{string}:              see XMLHttpRequest.responseType.\r\n        */\r\n        options ? options = angular.extend(defaults, options) : defaults;\r\n        return options;\r\n    }\r\n}]);\r\n\n/*global angular,FB */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\r\n    \r\n    $scope.Users = Users;\r\n\r\n    $scope.signOut = function () {\r\n        if ($scope.logoutBusy) {\r\n            return;\r\n        }\r\n        $scope.logoutBusy = true;\r\n        Users.signout().then(function () {\r\n            /*\r\n            FacebookService.logout().then(function(success) {\r\n            }, function(error) {\r\n            }).finally(function() {\r\n                $scope.logoutBusy = false;\r\n                $location.path('/splash');\r\n            });\r\n            */\r\n            $location.path('/splash');\r\n        }).finally(function() {\r\n            $scope.logoutBusy = false;\r\n        });\r\n    };\r\n    \r\n    $scope.goStream = function () {\r\n        $location.path('/stream');\r\n    };\r\n\r\n    $scope.goPost = function () {\r\n        $location.path('/post');\r\n    };\r\n\r\n    $scope.goDish = function (dishId) {\r\n        $location.path('/dishes/' + dishId);\r\n    };\r\n        \r\n    $scope.goCategory = function (categoryId) {\r\n        $location.path('/categories/' + categoryId);\r\n    };\r\n    \r\n    $scope.goUser = function (userRoute) {\r\n        $location.path('/users/' + userRoute);\r\n    };\r\n    \r\n    $scope.goSettings = function () {\r\n        $location.path('/settings');\r\n    };\r\n    \r\n    /**\r\n    $scope.goBack = function () {\r\n        if ($scope.previousPath) {\r\n            $location.path($scope.previousPath);\r\n        }\r\n    };    \r\n    $scope.$root.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        $scope.previousPath = previous.$$route.originalPath;\r\n    });   \r\n    */\r\n    \r\n}]);\r\n\r\napp.controller('SplashCtrl', ['$scope', '$location', '$timeout', '$window', 'FacebookService', 'Users', function ($scope, $location, $timeout, $window, FacebookService, Users) {\r\n\r\n    $scope.splashBusy = true;\r\n    $scope.showFacebookLoginButton = true;\r\n    \r\n    /*            \r\n    Users.getCurrentUser().then(function(success) {\r\n        $location.path('/stream');\r\n        \r\n    }, function(error) {     \r\n        \r\n        FacebookService.init().then(function(success) {\r\n            signinOrSignup(success.authResponse);\r\n        }, function(error) {\r\n        \r\n            $timeout(function() {\r\n                $scope.showFacebookLoginButton = true;\r\n            }, 1000);\r\n                \r\n        }).finally(function() {\r\n            $timeout(function(){\r\n                $scope.splashBusy = false;  \r\n            }, 100);\r\n        });\r\n            \r\n    }).finally(function(){\r\n        $timeout(function(){\r\n            $scope.splashBusy = false;        \r\n        }, 1000);        \r\n    });\r\n    */\r\n    \r\n    function signinOrSignup(auth) {\r\n        $scope.splashBusy = true;\r\n        Users.signInWithFacebook(auth).then(function(success) {\r\n            $location.path('/stream');\r\n        }, function(error) {\r\n            $location.path('/signup');\r\n        }).finally(function() {\r\n            $scope.splashBusy = false;\r\n        });\r\n    }\r\n\r\n    $scope.onFacebookLogin = function() {\r\n        $scope.splashBusy = true;\r\n        FacebookService.login().then(function(success) {\r\n            signinOrSignup(success.authResponse);\r\n        }, function(error) {\r\n            console.log('onFacebookLogin', error);\r\n        }).finally(function() {            \r\n            $scope.splashBusy = false;\r\n        });\r\n    };\r\n    \r\n    /*\r\n    FacebookService.init().then(function(success) {\r\n        // signinOrSignup(success.authResponse);\r\n    }, function(error) {\r\n        // $scope.showFacebookLoginButton = true;\r\n    }).finally(function() {\r\n        $timeout(function(){\r\n            $scope.splashBusy = false;  \r\n        }, 100);\r\n    });\r\n    */\r\n    \r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', 'Users', 'FacebookService', function ($scope, $location, Users, FacebookService) {\r\n\r\n    $scope.model = {};\r\n\r\n    $scope.signin = function () {\r\n        $scope.signinFormError = null;\r\n        $scope.signinFormBusy = true;\r\n        Users.signin($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signinFormError = error.message;\r\n        }).finally(function () {\r\n            $scope.signinFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', 'FacebookService', 'Users', function ($scope, $location, FacebookService, Users) {\r\n\r\n    FacebookService.getFacebookMe().then(function(me) {\r\n        console.log('SignupCtrl.getFacebookMe', me);\r\n        $scope.model = {\r\n            userName : me.name,\r\n            email : me.email,\r\n            firstName : me.first_name,\r\n            lastName : me.last_name,\r\n            facebookId : me.id,\r\n            facebookPicture : me.picture.data.url,\r\n            facebookToken : FacebookService.authResponse.accessToken,\r\n        };\r\n    }, function(error) {\r\n        console.log('SignupCtrl.getFacebookMe.error', error);\r\n    });\r\n\r\n    $scope.signup = function () {\r\n        console.log('SignupCtrl.signup', $scope.model);\r\n        $scope.signupFormError = null;\r\n        $scope.signupFormBusy = true;\r\n        Users.signup($scope.model).then(function (user) {\r\n            $location.path('/stream');\r\n        }, function (error) {\r\n            $scope.signupFormError = error.data.message;\r\n        }).finally(function () {\r\n            $scope.signupFormBusy = false;\r\n        });\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('StreamCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'Posts', 'Upload', function ($scope, $location, $timeout, DataSource, Posts, Upload) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n    \r\n    $scope.source = new DataSource({\r\n        service: Posts,\r\n        filters: $scope.filters\r\n    });\r\n    \r\n    $scope.source.paging();\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {       \r\n        if (!file) {\r\n            return;\r\n        } \r\n        $scope.$root.pictureBase64 = null;        \r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.$root.pictureBase64 = url;\r\n            $location.path('/post');\r\n        });\r\n    };\r\n    \r\n}]);\r\n\r\napp.controller('PostCtrl', ['$scope', '$timeout', '$location', 'Upload', 'Categories', 'Posts', 'DishesAutocomplete', function ($scope, $timeout, $location, Upload, Categories, Posts, DishesAutocomplete) {\r\n\r\n    Categories.get().then(function(categories) {\r\n        $scope.categories = categories;\r\n    })\r\n\r\n    $scope.dishesAutocomplete = new DishesAutocomplete();    \r\n\r\n    $scope.model = {\r\n        pictureBase64: $scope.$root.pictureBase64 || null,\r\n        dish: {\r\n            categories: [],            \r\n        }\r\n    };\r\n\r\n    $scope.onUploadFileSelected = function(file, newFiles) {        \r\n        $scope.model.pictureBase64 = null;        \r\n        Upload.dataUrl(file, true).then(function (url) {\r\n            $scope.model.pictureBase64 = url;\r\n        });\r\n    };\r\n    \r\n    $scope.hasPicture = function () {\r\n        var has = $scope.model.pictureBase64 !== null;\r\n        $scope.pictureError = true;\r\n        $timeout(function () {\r\n            $scope.pictureError = false;\r\n        }, 1000);\r\n        return has;\r\n    };\r\n        \r\n    $scope.onDishSelected = function(item) {\r\n        console.log('onDishSelected', item);\r\n        $scope.model.dish.id = item.id;\r\n        $scope.model.dish.price = item.price;\r\n        $scope.model.dish.categories = item.categories;\r\n        $scope.model.dish.isVeganFriendly = item.isVeganFriendly;\r\n    };\r\n    \r\n    $scope.submitPost = function () {\r\n        console.log('PostCtrl.submitPost', $scope.model);\r\n        $scope.postFormBusy = true;\r\n        $scope.postFormError = null;\r\n        $timeout(function () {\r\n            Posts.add($scope.model).then(function(post) {\r\n                $scope.model.id = post.id;\r\n                $location.path('/stream');\r\n            }, function(error) {\r\n                $scope.postFormError = error.config.url + ' ' + error.status + ' ' + error.statusText;\r\n            }).finally(function(){\r\n                $scope.postFormBusy = false;\r\n            });\r\n        }, 1); \r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DishCtrl', ['$scope', '$routeParams', 'Dishes', function ($scope, $routeParams, Dishes) {\r\n\r\n    Dishes.detail($routeParams.dishId).then(function(item) {\r\n       $scope.item = item;\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('CategoryCtrl', ['$scope', '$routeParams', 'Categories', 'DataSource', 'Dishes', function ($scope, $routeParams, Categories, DataSource, Dishes) {\r\n\r\n    Categories.detail($routeParams.categoryId).then(function(category) {\r\n       $scope.category = category;\r\n       \r\n       $scope.filters = {\r\n            search: {\r\n                Category: category.name\r\n            }\r\n        };\r\n        \r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n        \r\n        $scope.source.paging();\r\n\r\n    });\r\n    \r\n}]);\r\n\r\napp.controller('UserCtrl', ['$scope', '$routeParams', 'Users', 'DataSource', 'Dishes', function ($scope, $routeParams, Users, DataSource, Dishes) {\r\n\r\n    Users.detail($routeParams.userRoute).then(function(user) {\r\n       $scope.user = user;\r\n       \r\n       $scope.filters = {\r\n            search: {\r\n                UserName: user.userName\r\n            }\r\n        };\r\n        \r\n        $scope.source = new DataSource({\r\n            service: Dishes,\r\n            filters: $scope.filters\r\n        });\r\n        \r\n        $scope.source.paging();\r\n\r\n    });\r\n    \r\n}]);\r\n\r\napp.controller('SettingsCtrl', ['$scope', '$routeParams', 'Users', function ($scope, $routeParams, Users) {\r\n\r\n    $scope.user = Users.currentUser();\r\n    \r\n}]);\r\n\r\napp.controller('TestCtrl', ['$scope', '$location', '$timeout', 'DataSource', 'DishesTest', function ($scope, $location, $timeout, DataSource, DishesTest) {\r\n\r\n    $scope.filters = {\r\n        search: {\r\n        }\r\n    };\r\n    \r\n    $scope.source = new DataSource({\r\n        service: DishesTest,\r\n        filters: $scope.filters\r\n    });\r\n\r\n    $timeout(function() {            \r\n        $scope.source.paging();\r\n    }, 1000);\r\n\r\n}]);"],"sourceRoot":"/source/"}